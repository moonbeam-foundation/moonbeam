# PR #3811 Analysis: Implicit chill when full unbonding in pallet_staking

## PR Information
- **PR Doc**: [pr_3811.prdoc](/Users/manuelmauro/.substrate-mcp/moonbeam/releases/stable2506/pr-docs/pr_3811.prdoc)
- **GitHub PR**: [#3811](https://github.com/paritytech/polkadot-sdk/pull/3811)
- **PR Title**: Full Unbond in Staking
- **Labels**: T2-pallets

## Impact Assessment
- **Initial Sentiment**: INHERITED
- **Confidence Level**: HIGH

## Analysis

**Affected Components**:
- Relay chain staking behavior (not Moonbeam runtime directly)
- User-facing behavior through RelayEncoder precompile

**Changes Detected**:
- `pallet-staking::unbond()` extrinsic now automatically chills validators/nominators when unbonding the full bonded amount
- Weight calculation updated to include `T::WeightInfo::chill()` in worst-case scenario
- No signature changes - still accepts a single balance parameter
- New internal helper function `do_unbond()` extracts core unbonding logic

**Project Impact**:
Moonbeam does **not** use `pallet-staking` in its runtime. The project only encodes relay chain staking calls through:
- `/Users/manuelmauro/Workspace/moonbeam/runtime/relay-encoder/src/polkadot.rs`
- `/Users/manuelmauro/Workspace/moonbeam/precompiles/relay-encoder/src/lib.rs`

Since the encoding signature hasn't changed (unbond still takes a balance parameter), **no code changes are required** in Moonbeam. The behavioral change happens on the relay chain side when the encoded call is executed.

## Evidence & References

**From PR (polkadot-sdk)**:
- `substrate/frame/staking/src/pallet/mod.rs:L137-L139` - Unbond extrinsic now calls implicit chill logic when `value >= ledger.total`
- `substrate/frame/staking/src/pallet/impls.rs` - New `do_unbond()` helper function added
- `substrate/frame/staking/src/tests.rs` - New test `unbond_with_chill_works()` validates automatic chill behavior
- `substrate/frame/election-provider-multi-phase/test-staking-e2e/src/lib.rs` - Test updated to remove explicit chill call requirement
- `substrate/frame/nomination-pools/test-delegate-stake/src/lib.rs` - Test simplified by removing separate chill operations

**From Project (moonbeam)**:
- `/Users/manuelmauro/Workspace/moonbeam/runtime/relay-encoder/src/polkadot.rs:L50-L51` - Encodes `Unbond` with balance parameter (unchanged)
- `/Users/manuelmauro/Workspace/moonbeam/precompiles/relay-encoder/src/lib.rs:L103-L123` - `encode_unbond()` precompile function (no changes needed)
- `/Users/manuelmauro/Workspace/moonbeam/test/suites/smoke/test-relay-indices.ts:L192` - Test validates encoding matches relay chain (will continue to work)

**Migration Guide**:
No migration needed for Moonbeam code. However, users should be aware:
- When calling relay chain staking through Moonbeam's RelayEncoder precompile, full unbonds will now automatically chill the validator/nominator
- Previously, users had to manually call `chill()` before unbonding their full stake
- This improves UX by reducing the number of required transactions

**Additional Resources**:
- Closes issue: https://github.com/paritytech/polkadot-sdk/issues/414
- Community tip awarded: Referendum #1534 (80 DOT)

## Rationale for INHERITED Classification

This PR is classified as **INHERITED** because:

1. **No API Changes**: The `unbond()` function signature remains unchanged - it still accepts a balance parameter
2. **No Encoding Changes**: SCALE encoding for the call is identical; Moonbeam's relay-encoder requires no updates
3. **Not Used in Runtime**: Moonbeam doesn't include pallet-staking in its runtime configuration
4. **Relay Chain Behavior**: This is an internal improvement to relay chain staking logic that will automatically apply when the relay chain upgrades
5. **Backward Compatible**: The change is backward compatible - partial unbonds work as before, full unbonds just skip the manual chill step

The behavioral improvement (automatic chill on full unbond) will be inherited when Polkadot/Kusama relay chains upgrade to this version, without requiring any changes to Moonbeam's codebase.
