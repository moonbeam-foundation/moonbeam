# PR #5884 Analysis: Set PoV size limit to 10 Mb

## PR Information
- **PR Doc**: [pr_5884.prdoc](/Users/manuelmauro/.substrate-mcp/moonbeam/releases/stable2506/pr-docs/pr_5884.prdoc)
- **GitHub PR**: [#5884](https://github.com/paritytech/polkadot-sdk/pull/5884)
- **PR Title**: Set PoV size limit to 10 Mb
- **PR Labels**: T17-primitives
- **Affected Crate**: polkadot-primitives (minor bump)

## Impact Assessment
- **Initial Sentiment**: INHERITED (Alignment Change)
- **Confidence Level**: HIGH

## Summary
This PR increases the default maximum Proof of Validity (PoV) size from 5 MB to 10 MB in `polkadot-primitives`. **Moonbeam has already proactively implemented this change** in March-April 2025 (PRs #3228 and #3261), setting their own `MAX_POV_SIZE` constant to 10 MB across all runtimes. When upgrading to stable2506, this change simply aligns the relay chain default with Moonbeam's current configuration.

## Analysis

### Background: PoV Size and Its Impact

The PoV (Proof of Validity) size limit determines:
1. **Maximum parachain block size**: The amount of state proof data that can be submitted to the relay chain
2. **EVM execution capacity**: Larger PoV allows more contract storage reads/writes per block
3. **Gas limits**: Related to PoV through `GasLimitPovSizeRatio` configuration

### Changes in polkadot-sdk

**stable2503 (current)**:
```rust
// polkadot/primitives/src/v8/mod.rs
pub const MAX_POV_SIZE: u32 = 5 * 1024 * 1024; // 5 MB
```

**stable2506 (new)**:
```rust
// polkadot/primitives/src/v8/mod.rs
pub const MAX_POV_SIZE: u32 = 10 * 1024 * 1024; // 10 MB
```

### Moonbeam's Proactive Implementation

Moonbeam already upgraded to 10 MB PoV limits before this PR:

**Timeline:**
- **March 26, 2025** (PR #3228): Enabled 10 MB PoV for moonbase and moonriver
- **April 24, 2025** (PR #3261): Enabled 10 MB PoV for moonbeam

**Current Configuration (all runtimes)**:

```rust
// /Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/src/lib.rs:173
/// Maximum PoV size we support right now.
// Reference: https://github.com/polkadot-fellows/runtimes/pull/553
pub const MAX_POV_SIZE: u32 = 10 * 1024 * 1024;

/// Maximum weight per block
pub const MAXIMUM_BLOCK_WEIGHT: Weight = Weight::from_parts(
    WEIGHT_REF_TIME_PER_SECOND.saturating_mul(2),
    MAX_POV_SIZE as u64,
);
```

```rust
// /Users/manuelmauro/Workspace/moonbeam/runtime/moonriver/src/lib.rs:180
/// Maximum PoV size we support right now.
// Kusama relay already supports 10Mb maximum PoV
pub const MAX_POV_SIZE: u32 = 10 * 1024 * 1024;
```

```rust
// /Users/manuelmauro/Workspace/moonbeam/runtime/moonbeam/src/lib.rs:172
/// Maximum PoV size we support right now.
pub const MAX_POV_SIZE: u32 = 10 * 1024 * 1024;
```

**Before PR #3228**, Moonbeam used:
```rust
// Previous implementation (before March 2025)
pub const MAXIMUM_BLOCK_WEIGHT: Weight = Weight::from_parts(
    WEIGHT_REF_TIME_PER_SECOND,
    u64::MAX
).saturating_mul(2)
.set_proof_size(relay_chain::MAX_POV_SIZE as u64); // Referenced relay chain default (5 MB)
```

### Related Configuration: GasLimitPovSizeRatio

All runtimes have coordinated gas limit configuration:

```rust
// /Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/src/lib.rs:447
/// The amount of gas per pov. A ratio of 8 if we convert ref_time to gas and we compare
/// it with the pov_size for a block. E.g.
/// ceil(
///     (max_extrinsic.ref_time() / max_extrinsic.proof_size()) / WEIGHT_PER_GAS
/// )
/// We should re-check `xcm_config::Erc20XcmBridgeTransferGasLimit` when changing this value
pub const GasLimitPovSizeRatio: u64 = 8;
```

This ratio is used in:
- `pallet_evm::Config::GasLimitPovSizeRatio` - Controls EVM gas consumption based on PoV usage
- Gas limit calculations for Ethereum transactions
- XCM bridge operations

### Test Infrastructure Already Updated

Tests already validate 10 MB PoV limits:

```typescript
// /Users/manuelmauro/Workspace/moonbeam/test/suites/dev/moonbase/test-pov/test-pov-limit.ts:17
// The goal of this test is to fill the max PoV limit with normal transactions (75% of 10MB)
const MAX_POV_LIMIT = 10 * 1024 * 1024 * 0.75;
```

```typescript
// /Users/manuelmauro/Workspace/moonbeam/test/helpers/constants.ts:104-107
// Maximum Gas to PoV ratio used in the gasometer
GAS_PER_POV_BYTES: new RuntimeConstant({ 3600: 8n, 2900: 16n, 0: 4n }),
// Maximum PoV size in bytes allowed by the gasometer for one ethereum transaction
MAX_ETH_POV_PER_TX: new RuntimeConstant({ 3600: 6_500_000n, 0: 3_250_000n }),
```

## Evidence & References

### From PR (polkadot-sdk)

**Motivation** (from PR description):
> "10 Mb PoVs have been enacted on Polkadot"

**Implementation Stages**:
1. New chains starting from genesis support 10 MB PoVs immediately
2. Runtime upgrade enables theoretical 10 MB support (code level)
3. Governance action updates the `max_pov_size` config to fully enable 10 MB PoVs on-chain

**Safety Mechanism**:
Collators remain constrained by relay chain validation data limits until governance enables the increase, preventing malicious collators from exceeding absolute PoV size limits.

### From Project (moonbeam)

**No References to relay_chain::MAX_POV_SIZE**:
```bash
# Search confirms Moonbeam no longer uses relay chain constant
$ grep -r "relay_chain::MAX_POV_SIZE" /Users/manuelmauro/Workspace/moonbeam
# No matches found
```

All runtimes now define their own constant, eliminating dependency on the relay chain default.

**Git History**:
```bash
$ git log --oneline --all -S "MAX_POV_SIZE" -- "runtime/*/src/lib.rs"
6045df64ac feat(Moonbeam): Increase PoV limit to 10 MB (#3261)
10be70a18a Enable 10 Mb PoV for moonbase and moonriver (#3228)
```

## Impact on Moonbeam

### No Code Changes Required

✅ **Already Implemented**: Moonbeam proactively upgraded all runtimes to 10 MB PoV limits

✅ **No Breaking Changes**: This PR simply aligns the relay chain default with Moonbeam's existing configuration

✅ **Tests Passing**: All PoV-related tests already validate 10 MB limits

✅ **No Migration Needed**: The change is transparent when upgrading from stable2503 to stable2506

### Benefits of Alignment

1. **Consistency**: Runtime constants now match relay chain defaults
2. **Future-Proofing**: No need to maintain custom PoV limits separate from upstream
3. **Governance Alignment**: When relay chain governance enables 10 MB PoVs, Moonbeam is ready
4. **Improved Capacity**: Benefits already realized through PRs #3228 and #3261:
   - Larger EVM contract operations
   - More storage reads/writes per block
   - Enhanced XCM operation capacity

### Theoretical Considerations

While Moonbeam's code supports 10 MB PoVs, actual usage is constrained by:
1. **Relay Chain Governance**: Until `max_pov_size` config is updated via governance
2. **Network Bandwidth**: Practical limits on block propagation and validation
3. **Collator Resources**: Hardware and network capacity of collators

## Migration Guide

**No migration required** - this is an alignment change that Moonbeam has already implemented.

### Verification Steps (Post-Upgrade to stable2506)

1. ✅ Verify `MAX_POV_SIZE` constant remains 10 MB in all runtimes
2. ✅ Confirm `GasLimitPovSizeRatio` stays at 8 in all runtimes
3. ✅ Run PoV-related tests to ensure continued functionality:
   ```bash
   cd test
   pnpm moonwall test dev_moonbase "test-pov"
   ```

### Optional Actions

Consider adding a note to documentation:
- Moonbeam's PoV configuration is now aligned with relay chain defaults
- Historical context: Moonbeam upgraded to 10 MB ahead of relay chain default change

## Additional Context

### Why This is INHERITED

1. **Proactive Implementation**: Moonbeam already set MAX_POV_SIZE to 10 MB
2. **No Dependency**: Moonbeam doesn't use `relay_chain::MAX_POV_SIZE` anymore
3. **Alignment Only**: PR #5884 brings relay chain default in line with Moonbeam's existing setting
4. **Zero Code Impact**: No changes needed in Moonbeam codebase

### Historical Context

**Before March 2025**:
- Relay chain default: 5 MB
- Moonbeam: Used `relay_chain::MAX_POV_SIZE` (5 MB)

**March-April 2025** (PRs #3228, #3261):
- Relay chain default: Still 5 MB
- Moonbeam: Upgraded to own constant (10 MB), ahead of relay chain

**After stable2506**:
- Relay chain default: 10 MB ← **PR #5884**
- Moonbeam: Already at 10 MB (no change needed)

### Network Status

According to PR #5884 discussion:
- **Polkadot**: 10 MB PoVs already enacted
- **Kusama**: Already supports 10 MB PoVs (referenced in moonriver runtime comments)
- **Westend**: Expected to support 10 MB PoVs

## Conclusion

PR #5884 is a **positive alignment change** for Moonbeam. The project proactively increased PoV limits to 10 MB in March-April 2025, ahead of this upstream change. When upgrading to stable2506, Moonbeam will benefit from having runtime constants that match relay chain defaults, eliminating any potential configuration mismatch. No code changes, migrations, or special actions are required.

**Impact Category**: INHERITED (Alignment)
**Action Required**: None - already implemented
**Risk Level**: None - backward compatible improvement
