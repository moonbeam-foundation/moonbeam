# PR #5884: Set PoV Size Limit to 10 MB

## Overview
This PR increases the `MAX_POV_SIZE` constant from 5 MB to 10 MB in polkadot-sdk primitives and adjusts related bridge constants.

**PR Link**: https://github.com/paritytech/polkadot-sdk/pull/5884
**Labels**: T17-primitives
**Audience**: Runtime Dev

## Changes Made

### 1. Core Primitive Change
- **File**: `polkadot/primitives/src/v8/mod.rs`
- **Change**: `MAX_POV_SIZE` increased from `5 * 1024 * 1024` (5 MB) to `10 * 1024 * 1024` (10 MB)

### 2. Bridge Configuration Updates
- **Files**: Bridge hub runtime configurations (Rococo, Westend, Bulletin)
- **Change**: `PriorityBoostPerMessage` doubled from `182_044_444_444_444` to `364_088_888_888_888`
- **Reason**: This constant scales with PoV size for bridge message prioritization

### 3. Affected Crates
- polkadot-primitives (minor bump)
- bridge-hub-rococo-runtime (minor bump)
- bridge-hub-westend-runtime (minor bump)
- polkadot-omni-node (minor bump)
- polkadot-omni-node-lib (minor bump)
- polkadot-parachain-bin (minor bump)

## Technical Context

### Phased Rollout
This is a **preparatory change** that won't immediately affect existing parachains:
1. New chains starting from genesis can immediately use 10 MB PoVs
2. Existing parachains won't exceed 5 MB until relay chain governance updates the `max_pov_size` parameter
3. Collators remain constrained by relay chain validation data until governance acts

### Safety Guarantees
The actual enforcement happens at the relay chain level via runtime configuration, not the SDK constant. This decouples SDK capability from active network limits, allowing for safe, gradual rollout.

## Impact on Moonbeam

### Current State Analysis

#### Production Runtimes - ALREADY UPDATED ‚úÖ
All three Moonbeam production runtimes have already been updated to 10 MB:

**Moonbase Runtime** (`/Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/src/lib.rs:173`):
```rust
/// Maximum PoV size we support right now.
// Reference: https://github.com/polkadot-fellows/runtimes/pull/553
pub const MAX_POV_SIZE: u32 = 10 * 1024 * 1024;
```

**Moonbeam Runtime** (`/Users/manuelmauro/Workspace/moonbeam/runtime/moonbeam/src/lib.rs:172`):
```rust
/// Maximum PoV size we support right now.
// Reference: https://github.com/polkadot-fellows/runtimes/pull/553
pub const MAX_POV_SIZE: u32 = 10 * 1024 * 1024;
```

**Moonriver Runtime** (`/Users/manuelmauro/Workspace/moonbeam/runtime/moonriver/src/lib.rs:180`):
```rust
/// Maximum PoV size we support right now.
// Kusama relay already supports 10Mb maximum PoV
// Reference: https://github.com/polkadot-fellows/runtimes/pull/553
pub const MAX_POV_SIZE: u32 = 10 * 1024 * 1024;
```

**Update History**:
- Moonbase/Moonriver: Commit `10be70a18a` - "Enable 10 Mb PoV for moonbase and moonriver (#3228)"
- Moonbeam: Commit `6045df64ac` - "feat(Moonbeam): Increase PoV limit to 10 MB (#3261)" (April 2025)

#### GasLimitPovSizeRatio Configuration
All runtimes use a consistent ratio of 8:
- Moonbase: `pub const GasLimitPovSizeRatio: u64 = 8;`
- Moonbeam: `pub const GasLimitPovSizeRatio: u64 = 8;`
- Moonriver: `pub const GasLimitPovSizeRatio: u64 = 8;`

This ratio determines how PoV consumption translates to gas costs in the EVM (approximately 1 byte per 4 gas units).

#### Test/Mock Files - OUTDATED ‚ö†Ô∏è
The following mock files still use the old 5 MB limit:

**Precompiles (24 files)**:
- `/Users/manuelmauro/Workspace/moonbeam/precompiles/xcm-utils/src/mock.rs:239`
- `/Users/manuelmauro/Workspace/moonbeam/precompiles/xcm-transactor/src/mock.rs:175`
- `/Users/manuelmauro/Workspace/moonbeam/precompiles/balances-erc20/src/mock.rs:111`
- `/Users/manuelmauro/Workspace/moonbeam/precompiles/relay-encoder/src/mock.rs:343`
- `/Users/manuelmauro/Workspace/moonbeam/precompiles/author-mapping/src/mock.rs:110`
- `/Users/manuelmauro/Workspace/moonbeam/precompiles/gmp/src/mock.rs:255`
- `/Users/manuelmauro/Workspace/moonbeam/precompiles/crowdloan-rewards/src/mock.rs:165`
- `/Users/manuelmauro/Workspace/moonbeam/precompiles/conviction-voting/src/mock.rs:112`
- `/Users/manuelmauro/Workspace/moonbeam/precompiles/relay-data-verifier/src/mock.rs:173`
- `/Users/manuelmauro/Workspace/moonbeam/precompiles/batch/src/mock.rs:126`
- `/Users/manuelmauro/Workspace/moonbeam/precompiles/referenda/src/mock.rs:133`
- `/Users/manuelmauro/Workspace/moonbeam/precompiles/xtokens/src/mock.rs:143`
- `/Users/manuelmauro/Workspace/moonbeam/precompiles/collective/src/mock.rs:127`
- `/Users/manuelmauro/Workspace/moonbeam/precompiles/parachain-staking/src/mock.rs:116`
- `/Users/manuelmauro/Workspace/moonbeam/precompiles/preimage/src/mock.rs:104`
- `/Users/manuelmauro/Workspace/moonbeam/precompiles/identity/src/mock.rs:113`
- `/Users/manuelmauro/Workspace/moonbeam/precompiles/proxy/src/mock.rs:153`

**Pallets (2 files)**:
- `/Users/manuelmauro/Workspace/moonbeam/pallets/erc20-xcm-bridge/src/mock.rs:112`
- `/Users/manuelmauro/Workspace/moonbeam/pallets/ethereum-xcm/src/mock.rs:152`

Pattern in all these files:
```rust
const MAX_POV_SIZE: u64 = 5 * 1024 * 1024;
```

#### Bridge Configuration
Moonbeam has bridge configurations for Moonbeam ‚Üî Moonriver communication:
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonriver/src/bridge_config.rs`
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbeam/src/bridge_config.rs`

**Key Finding**: Moonbeam does NOT use the `PriorityBoostPerMessage` constant that was updated in the polkadot-sdk PR. Moonbeam's bridge implementation uses a different architecture with `pallet_xcm_bridge`, `pallet_bridge_messages`, and `pallet_bridge_grandpa`, which don't require this constant.

## Impact Assessment

### üü¢ Direct Impact: MINIMAL

**Why?**
1. **Production runtimes already aligned**: All Moonbeam runtimes (moonbase, moonbeam, moonriver) have been updated to use 10 MB MAX_POV_SIZE since April 2025
2. **This PR is SDK housekeeping**: The change to polkadot-primitives simply aligns the SDK's default constant with what Moonbeam is already using
3. **No bridge constant conflict**: Moonbeam's bridge implementation doesn't use `PriorityBoostPerMessage`
4. **Gradual enforcement**: The actual 10 MB limit won't be enforced until relay chain governance updates runtime parameters

### ‚ö†Ô∏è Recommended Actions

#### 1. Update Mock Files (Low Priority, Technical Debt)
Consider updating all test/mock files from 5 MB to 10 MB to match production runtime configuration. This would:
- Ensure test environments accurately reflect production
- Prevent potential confusion when debugging PoV-related issues
- Align with the SDK's new default

**Files to update**: 26 mock files (see list above)

**Example change**:
```rust
// Before
const MAX_POV_SIZE: u64 = 5 * 1024 * 1024;

// After
const MAX_POV_SIZE: u64 = 10 * 1024 * 1024;
```

#### 2. Monitor Relay Chain Updates
Watch for relay chain governance proposals to increase the actual `max_pov_size` parameter from 5 MB to 10 MB. This is when the change will actually take effect in production.

#### 3. Review GasLimitPovSizeRatio (Optional)
Consider whether the current ratio of 8 remains appropriate with the increased PoV size. The current configuration means:
- 1 byte of PoV ‚âà 4 gas units
- 10 MB PoV ‚âà 40M gas worth of PoV consumption

### üìä Verification Checklist

- ‚úÖ Production runtimes use 10 MB MAX_POV_SIZE
- ‚úÖ MAXIMUM_BLOCK_WEIGHT uses MAX_POV_SIZE in proof_size component
- ‚úÖ GasLimitPovSizeRatio is configured consistently across runtimes
- ‚ö†Ô∏è Mock files still use 5 MB (technical debt, not critical)
- ‚úÖ Bridge configurations don't depend on changed constants

## Conclusion

**This PR has MINIMAL DIRECT IMPACT on Moonbeam** because:
1. Moonbeam already updated to 10 MB PoV size in April 2025
2. The polkadot-sdk change simply catches up to what Moonbeam is already using
3. No code changes are required in Moonbeam's production runtimes
4. Bridge constant changes don't apply to Moonbeam's architecture

**Optional follow-up**: Update mock/test files from 5 MB to 10 MB to align with production configuration and prevent future confusion.

**Compatibility**: ‚úÖ Fully compatible - no breaking changes, no action required
