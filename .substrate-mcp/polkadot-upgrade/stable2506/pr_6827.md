# PR #6827 Analysis: Introduction of Approval Slashes

## PR Information
- **PR Doc**: [pr_6827.prdoc](/Users/manuelmauro/.substrate-mcp/moonbeam/releases/stable2506/pr-docs/pr_6827.prdoc)
- **GitHub PR**: [#6827](https://github.com/paritytech/polkadot-sdk/pull/6827)
- **PR Title**: Introduction of Approval Slashes [Disabling Strategy Stage 4]
- **Labels**: I1-security, T8-polkadot, A4-backport-stable2503

## Impact Assessment
- **Initial Sentiment**: INHERITED
- **Confidence Level**: HIGH

## Analysis

**Affected Components**:
- Relay chain dispute resolution and validator slashing logic (Polkadot/Kusama only)
- `polkadot-primitives` types (used by Moonbeam but not the slashing-related types)
- `polkadot-runtime-parachains` (used as dev-dependency only)

**Changes Detected**:
- Introduces new `polkadot_primitives::vstaging::DisputeOffenceKind` enum with three variants:
  - `ForInvalidBacked` - 100% slash for validators who backed invalid blocks
  - `ForInvalidApproved` - 2% slash for validators who approved invalid blocks (NEW)
  - `AgainstValid` - 0% slash (disable only) for validators disputing valid blocks
- Deprecates `polkadot_primitives::v8::slashing::SlashingOffenceKind` in favor of expanded types
- Adds bidirectional conversion traits between old and new types (fallible in one direction)
- Updates `PendingSlashes` and `DisputeProof` structs in `vstaging` module
- Implements phased rollout: runtime-only updates first, node-side updates in Phase 2

**Project Impact**:
Moonbeam has **NO DIRECT IMPACT** from this PR. Analysis shows:

1. **No Usage in Rust Code**:
   - Searched entire Moonbeam codebase - zero usages of `SlashingOffenceKind`, `DisputeOffenceKind`, `DisputeProof`, or `PendingSlashes` types
   - No imports from `polkadot_primitives::vstaging` or slashing modules
   - No dispute resolution logic in parachain runtime

2. **Dependency Usage**:
   - `polkadot-primitives` is imported in `/Users/manuelmauro/Workspace/moonbeam/node/service/src/lib.rs` but only for: `AbridgedHostConfiguration, AsyncBackingParams, Slot, UpgradeGoAhead`
   - `polkadot-runtime-parachains` is only a dev-dependency in `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/Cargo.toml` and `/Users/manuelmauro/Workspace/moonbeam/runtime/relay-encoder/Cargo.toml`

3. **TypeScript API Types**:
   - Types `DisputeProof`, `PendingSlashes`, and `SlashingOffenceKind` appear in TypeScript API files:
     - `/Users/manuelmauro/Workspace/moonbeam/typescript-api/src/moonbase/interfaces/augment-types.ts:709`
     - `/Users/manuelmauro/Workspace/moonbeam/typescript-api/src/moonriver/interfaces/augment-types.ts`
     - `/Users/manuelmauro/Workspace/moonbeam/typescript-api/src/moonbeam/interfaces/augment-types.ts`
   - These are auto-generated from chain metadata and include all relay chain primitives
   - No actual runtime code uses these types

## Evidence & References

**From PR (polkadot-sdk)**:
- `polkadot/primitives/src/vstaging/mod.rs` - New `DisputeOffenceKind` enum with three variants and conversion implementations
- `polkadot/primitives/src/v8/slashing.rs` - Documentation added marking types as deprecated
- `polkadot/runtime/parachains/src/disputes.rs` - Updated `SlashingHandler` trait documentation
- `polkadot/runtime/parachains/src/disputes/slashing.rs` - Implementation of new slashing logic
- Crate bumps: `polkadot-primitives` (minor), `polkadot-runtime-parachains` (major)

**From Project (moonbeam)**:
- Grep search for slashing types: No Rust files found using these types
- Dependency check: `polkadot-primitives` used but not slashing/dispute modules
- Current version: `moonbeam-polkadot-stable2503` branch
- Upgrading to: `stable2506` release

**Security Context**:
This PR is labeled `I1-security` because it introduces more aggressive slashing for lazy validators:
- Previously only backing validators were slashed
- Now approval voters who approve invalid blocks face 2% slash
- Validators disputing valid blocks get disabled (0% slash but lose era points)

This security improvement is **relay chain specific** and does not affect parachain operations.

**Migration Guide**:
No migration needed for Moonbeam. This is purely relay chain validator behavior.

**Additional Context**:
- Part of "Disabling Strategy Stage 4" roadmap
- Depends on Stage 3 (PR #5724) being deployed first
- Closes issue: https://github.com/paritytech/polkadot-sdk/issues/4746
- Phased rollout minimizes breaking changes during transition

## Rationale for INHERITED Classification

This PR is classified as **INHERITED** because:

1. **Relay Chain Only**: Slashing and dispute resolution are relay chain validator concerns. Parachains do not implement or participate in validator dispute resolution logic.

2. **No API Usage**: Moonbeam's codebase does not import, reference, or use any of the modified slashing types (`SlashingOffenceKind`, `DisputeOffenceKind`, `DisputeProof`, `PendingSlashes`).

3. **No Runtime Integration**: The affected modules (`polkadot-runtime-parachains` disputes/slashing) are not included in Moonbeam's runtime configuration. These are relay chain runtime pallets.

4. **Dependency Isolation**: While Moonbeam depends on `polkadot-primitives` and `polkadot-runtime-parachains`, it only uses parachain-specific functionality (async backing, slots, host configuration), not validator slashing primitives.

5. **TypeScript Types are Metadata**: The presence of these types in TypeScript API is automatic from chain metadata exposure and doesn't indicate actual usage or impact.

6. **Security Improvement**: The security enhancement (more aggressive validator slashing) operates entirely at the relay chain consensus layer and will automatically apply when Polkadot/Kusama upgrade, without requiring any changes to Moonbeam's codebase.

7. **Backward Compatible**: The phased rollout approach ensures backward compatibility during transition. Conversion traits handle interoperability between old and new types.

The improved slashing mechanism will be inherited automatically when the relay chain upgrades to stable2506, benefiting Moonbeam's security posture through better relay chain validator behavior, without requiring any code changes in the Moonbeam parachain.
