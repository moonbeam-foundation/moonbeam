# PR #7229 Impact Analysis: Deprecate RuntimeEvent Associated Type from Config Trait

## Executive Summary

**Impact Level:** üü¢ **LOW** - Code Simplification / Non-Breaking Deprecation

**Category:** Developer Experience Enhancement

PR #7229 simplifies FRAME pallet development by removing the need to explicitly define `RuntimeEvent` in pallet `Config` traits. The macro expansion now automatically applies the necessary type bounds, reducing boilerplate code. This change is **non-breaking** but generates deprecation warnings for pallets still using explicit `RuntimeEvent` definitions.

## PR Overview

### What Changed
- **Automatic Type Bounds**: The `#[pallet::config]` macro now automatically applies the `RuntimeEvent` type bound when a pallet defines an `Event` type
- **Deprecation Path**: Explicit `type RuntimeEvent` definitions in Config traits are now deprecated but continue to work
- **Simplified Syntax**: Pallets with events no longer need to declare the `RuntimeEvent` associated type

### Before & After

**Before:**
```rust
#[pallet::config]
pub trait Config: frame_system::Config {
    type RuntimeEvent: From<Event<Self>> + IsType<<Self as frame_system::Config>::RuntimeEvent>;
}
```

**After:**
```rust
#[pallet::config]
pub trait Config: frame_system::Config {
    // RuntimeEvent automatically bounded when Event is defined
}
```

## Impact on Moonbeam

### Affected Components

#### 1. Custom Production Pallets (7 affected)

All seven Moonbeam custom pallets that emit events are affected:

| Pallet | File Path | Lines | Impact |
|--------|-----------|-------|--------|
| **parachain-staking** | `/pallets/parachain-staking/src/lib.rs:119` | ~18,923 | Core staking logic - high visibility |
| **ethereum-xcm** | `/pallets/ethereum-xcm/src/lib.rs:126` | - | XCM-Ethereum bridge events |
| **xcm-transactor** | `/pallets/xcm-transactor/src/lib.rs:122` | - | Cross-chain transaction events |
| **moonbeam-foreign-assets** | `/pallets/moonbeam-foreign-assets/src/lib.rs:219` | - | Asset management events |
| **moonbeam-orbiters** | `/pallets/moonbeam-orbiters/src/lib.rs:70` | - | Collator rotation events |
| **xcm-weight-trader** | `/pallets/xcm-weight-trader/src/lib.rs:94` | - | XCM weight trading events |
| **crowdloan-rewards** | `/pallets/crowdloan-rewards/src/lib.rs:75` | - | Reward distribution events |

**Evidence:**
```rust
// Current pattern in all 7 pallets
#[pallet::config]
pub trait Config: frame_system::Config {
    type RuntimeEvent: From<Event<Self>> + IsType<<Self as frame_system::Config>::RuntimeEvent>;
    // ... other config items
}
```

#### 2. Test Mock Pallets (12 affected)

XCM integration test mocks across all three runtimes:

- **Moonbase Runtime Tests**: 4 mock pallets
  - `/runtime/moonbase/tests/xcm_mock/parachain.rs:413` (mock_msg_queue)
  - `/runtime/moonbase/tests/xcm_mock/parachain.rs:569` (mock_msg_queue variant)
  - `/runtime/moonbase/tests/xcm_mock/statemint_like.rs:401` (mock_msg_queue)
  - `/runtime/moonbase/tests/xcm_mock/statemint_like.rs:561` (mock_msg_queue variant)

- **Moonriver Runtime Tests**: 4 mock pallets
  - `/runtime/moonriver/tests/xcm_mock/parachain.rs:396` (mock_msg_queue)
  - `/runtime/moonriver/tests/xcm_mock/parachain.rs:552` (mock_msg_queue variant)
  - `/runtime/moonriver/tests/xcm_mock/statemine_like.rs:403` (mock_msg_queue)
  - `/runtime/moonriver/tests/xcm_mock/statemine_like.rs:563` (mock_msg_queue variant)

- **Moonbeam Runtime Tests**: 4 mock pallets
  - `/runtime/moonbeam/tests/xcm_mock/parachain.rs:405` (mock_msg_queue)
  - `/runtime/moonbeam/tests/xcm_mock/parachain.rs:561` (mock_msg_queue variant)
  - `/runtime/moonbeam/tests/xcm_mock/statemint_like.rs:403` (mock_msg_queue)
  - `/runtime/moonbeam/tests/xcm_mock/statemint_like.rs:563` (mock_msg_queue variant)

**Evidence:**
```rust
// Pattern in XCM test mocks
#[frame_support::pallet]
pub mod mock_msg_queue {
    #[pallet::config]
    pub trait Config: frame_system::Config {
        type RuntimeEvent: From<Event<Self>> + IsType<<Self as frame_system::Config>::RuntimeEvent>;
        type XcmExecutor: ExecuteXcm<Self::RuntimeCall>;
    }
}
```

#### 3. Unaffected Pallets (4 pallets)

These pallets do not define events and are not affected:
- `moonbeam-lazy-migrations` - No events
- `precompile-benchmarks` - No events
- `proxy-genesis-companion` - No events
- `erc20-xcm-bridge` - No events

### Runtime Configurations

All three Moonbeam runtimes configure the affected pallets with explicit `RuntimeEvent` assignments:

**Moonbase Runtime** (`/runtime/moonbase/src/lib.rs:829`):
```rust
impl pallet_parachain_staking::Config for Runtime {
    type RuntimeEvent = RuntimeEvent;  // ‚Üê Can be removed
    type Currency = Balances;
    // ... rest of config
}
```

Similar patterns exist in:
- `/runtime/moonbeam/src/lib.rs:823`
- `/runtime/moonriver/src/lib.rs:827`

## Technical Analysis

### Why This Works

The `#[pallet::config]` macro now automatically expands to include the RuntimeEvent bound when a pallet defines an Event type:

```rust
// Manual definition (old way)
#[pallet::config]
pub trait Config: frame_system::Config {
    type RuntimeEvent: From<Event<Self>> + IsType<<Self as frame_system::Config>::RuntimeEvent>;
}

// Automatic expansion (new way)
#[pallet::config]
pub trait Config: frame_system::Config + frame_system::Config<RuntimeEvent: From<Event<Self>>> {
    // No explicit RuntimeEvent needed
}
```

### Deprecation Warnings

After the upgrade, compilation will produce deprecation warnings like:
```
warning: associated type `RuntimeEvent` is deprecated
  --> pallets/parachain-staking/src/lib.rs:119
   |
119|     type RuntimeEvent: From<Event<Self>> + IsType<<Self as frame_system::Config>::RuntimeEvent>;
   |     ^^^^^^^^^^^^^^^^^^
```

### Benefits

1. **Less Boilerplate**: Removes redundant type definitions from Config traits
2. **Consistency**: All pallets with events automatically get proper bounds
3. **Maintenance**: Reduces code that needs to be maintained
4. **No Breaking Changes**: Existing code continues to work

## Migration Strategy

### Phase 1: Immediate (Post-Upgrade)
**Priority:** Low (Non-blocking)

The code will continue to work with deprecation warnings. No immediate action required.

### Phase 2: Cleanup (Recommended within 1-2 releases)
**Priority:** Low (Code Quality)

1. **Remove deprecated RuntimeEvent types from pallet Config traits** (7 pallets):
   ```diff
   #[pallet::config]
   pub trait Config: frame_system::Config {
   -   type RuntimeEvent: From<Event<Self>> + IsType<<Self as frame_system::Config>::RuntimeEvent>;
       type Currency: Currency<Self::AccountId>;
       // ... other config
   }
   ```

2. **Update runtime configurations** (3 runtimes):

   The `type RuntimeEvent = RuntimeEvent;` lines can remain in runtime configs as they're still valid, but they're now technically redundant. Consider whether to keep them for explicitness or remove for consistency.

3. **Clean up test mocks** (12 mock pallets):
   ```diff
   #[pallet::config]
   pub trait Config: frame_system::Config {
   -   type RuntimeEvent: From<Event<Self>> + IsType<<Self as frame_system::Config>::RuntimeEvent>;
       type XcmExecutor: ExecuteXcm<Self::RuntimeCall>;
   }
   ```

### Testing Requirements

- **Unit Tests**: All existing pallet tests should pass unchanged
- **Integration Tests**: XCM mock tests should continue working
- **Compilation**: Verify deprecation warnings are resolved
- **Runtime Upgrade**: Standard upgrade testing on testnets

### Effort Estimation

- **Lines to Change**: ~19 lines (7 pallets + 12 test mocks)
- **Complexity**: Trivial (simple deletion of type definitions)
- **Risk**: Minimal (macro handles the logic)
- **Time Estimate**: 1-2 hours (including testing)

## Risk Assessment

### Risks: MINIMAL

| Risk | Likelihood | Impact | Mitigation |
|------|-----------|--------|------------|
| Compilation errors after cleanup | Very Low | Low | Macro guarantees correctness |
| Runtime behavior changes | None | None | No functional changes |
| Event emission broken | None | None | Macro preserves semantics |
| Breaking compatibility | None | None | Deprecated path still works |

### Considerations

1. **Backward Compatibility**: ‚úÖ Fully maintained - old code continues to work
2. **Forward Compatibility**: ‚úÖ New code is cleaner and more maintainable
3. **Migration Complexity**: ‚úÖ Trivial - just remove deprecated lines
4. **Testing Requirements**: ‚úÖ Standard - no special tests needed
5. **Documentation Updates**: ‚ö†Ô∏è May need to update developer docs referencing Config traits

## Recommendations

### Priority: LOW - Code Quality Enhancement

**Recommended Actions:**

1. ‚úÖ **Accept the upgrade** - No blocking issues
2. üìÖ **Schedule cleanup** - Plan for next maintenance window
3. üìù **Track deprecations** - Add to technical debt backlog
4. üß™ **Test on devnet** - Verify clean compilation after cleanup
5. üìö **Update docs** - Refresh pallet development guides

### Implementation Timeline

- **Immediate**: Upgrade to stable2506 (no code changes needed)
- **Within 1 month**: Clean up parachain-staking and high-visibility pallets
- **Within 2 months**: Clean up all remaining pallets and test mocks
- **Before next release**: Ensure all deprecation warnings are resolved

## Related PRs

- **Issue #3743**: Broader initiative to deprecate other runtime types (RuntimeCall, RuntimeOrigin, etc.)
- **Future PRs**: Similar deprecations coming for other associated types

## References

### Code Locations

**Production Pallets:**
- `/Users/manuelmauro/Workspace/moonbeam/pallets/parachain-staking/src/lib.rs:119`
- `/Users/manuelmauro/Workspace/moonbeam/pallets/ethereum-xcm/src/lib.rs:126`
- `/Users/manuelmauro/Workspace/moonbeam/pallets/xcm-transactor/src/lib.rs:122`
- `/Users/manuelmauro/Workspace/moonbeam/pallets/moonbeam-foreign-assets/src/lib.rs:219`
- `/Users/manuelmauro/Workspace/moonbeam/pallets/moonbeam-orbiters/src/lib.rs:70`
- `/Users/manuelmauro/Workspace/moonbeam/pallets/xcm-weight-trader/src/lib.rs:94`
- `/Users/manuelmauro/Workspace/moonbeam/pallets/crowdloan-rewards/src/lib.rs:75`

**Runtime Configs:**
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/src/lib.rs:829`
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbeam/src/lib.rs:823`
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonriver/src/lib.rs:827`

**Test Mocks:**
- All files in `/runtime/*/tests/xcm_mock/` directories

### External Links

- **GitHub PR**: https://github.com/paritytech/polkadot-sdk/pull/7229
- **PRDoc**: `/Users/manuelmauro/.substrate-mcp/moonbeam/releases/stable2506/pr-docs/pr_7229.prdoc`

## Conclusion

PR #7229 is a **low-impact developer experience improvement** that simplifies pallet development by removing boilerplate code. The change is non-breaking and Moonbeam can safely upgrade without immediate modifications. A follow-up cleanup task should be scheduled to remove deprecated RuntimeEvent definitions from the 7 custom pallets and 12 test mocks, ensuring a clean codebase and eliminating deprecation warnings.

**Decision:** ‚úÖ **APPROVE** - Safe to upgrade with optional cleanup scheduled for maintenance window.
