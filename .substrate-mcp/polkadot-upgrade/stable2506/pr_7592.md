# PR #7592 Impact Analysis: Add Paras authorize_code_hash + apply_authorized_code feature

## Overview
- **PR Title**: Add `Paras` `authorize_code_hash` + `apply_authorized_code` feature
- **GitHub**: https://github.com/paritytech/polkadot-sdk/pull/7592
- **Labels**: T14-system_parachains
- **Crates Modified**: polkadot-runtime-parachains (major), polkadot-runtime-common (patch), rococo-runtime (minor), westend-runtime (minor)

## Description
This PR adds two new extrinsics to the `Paras` pallet for cross-chain parachain code updates without transferring large Wasm blobs between chains:

1. **`authorize_force_set_current_code_hash`**: Root-only call that authorizes a code hash with an expiration block
2. **`apply_authorized_force_set_current_code`**: Anyone can apply a previously authorized code hash to update parachain code

### Motivation
This feature enables triggering `Paras` pallet calls from different chains (like AssetHub or Collectives) to the relay chain. Rather than transmitting entire Wasm code between chains, only the code hash is authorized via governance, significantly reducing bandwidth and complexity. This is particularly useful for the AssetHub Migration (AHM) scenario where relay chain governance will be migrated to AssetHub.

## Impact Assessment

### Impact Category: **NO IMPACT / TEST-ONLY**

### Evidence

#### 1. Dependency Analysis
**File**: `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/Cargo.toml` (line 190)
```toml
[dev-dependencies]
polkadot-runtime-parachains = { workspace = true }
```

**File**: `/Users/manuelmauro/Workspace/moonbeam/runtime/relay-encoder/Cargo.toml` (line 36)
```toml
[dev-dependencies]
polkadot-runtime-parachains = { workspace = true }
```

The `polkadot-runtime-parachains` crate is used **ONLY as a dev-dependency** in Moonbeam, meaning it's only used for testing and not in the production runtime.

#### 2. Usage Analysis

**Test-Only Usage Locations**:

1. **XCM Mock Relay Chains** - `/Users/manuelmauro/Workspace/moonbeam/runtime/*/tests/xcm_mock/relay_chain.rs`:
   ```rust
   use polkadot_runtime_parachains::{
       configuration, dmp, hrmp,
       inclusion::{AggregateMessageOrigin, UmpQueueId},
       origin, paras, shared,
   };

   impl paras::Config for Runtime {
       type RuntimeEvent = RuntimeEvent;
       type WeightInfo = paras::TestWeightInfo;
       type UnsignedPriority = ParasUnsignedPriority;
       type NextSessionRotation = TestNextSessionRotation;
       type QueueFootprinter = ();
       type OnNewHead = ();
       type AssignCoretime = ();
   }
   ```

2. **XCM Test Setup** - `/Users/manuelmauro/Workspace/moonbeam/runtime/*/tests/xcm_mock/mod.rs`:
   ```rust
   use polkadot_runtime_parachains::paras::{
       GenesisConfig as ParasGenesisConfig, ParaGenesisArgs, ParaKind,
   };
   ```

3. **Relay Encoder Tests** - `/Users/manuelmauro/Workspace/moonbeam/runtime/relay-encoder/src/westend.rs`:
   ```rust
   let mut expected = polkadot_runtime_parachains::hrmp::Call::<
       moonbase_runtime::Runtime,
   >::hrmp_init_open_channel(para_id, max_capacity, max_message_size)
   .encode();
   ```

**Key Finding**: Moonbeam only uses the `Paras` pallet in test mock relay chains for XCM integration testing. The new extrinsics added by this PR are not used anywhere in the codebase.

#### 3. Relay Chain Interaction Analysis

**File**: `/Users/manuelmauro/Workspace/moonbeam/runtime/relay-encoder/src/kusama.rs` (lines 28-36)
```rust
pub enum RelayCall {
    #[codec(index = 6u8)]
    Stake(StakeCall),
    #[codec(index = 24u8)]
    Utility(UtilityCall),
    #[codec(index = 60u8)]
    Hrmp(HrmpCall),
}
```

**Evidence**: The relay encoder, which is used to encode relay chain calls that Moonbeam can execute via XCM, only supports:
- Staking calls
- Utility calls
- HRMP (Horizontal Relay-chain Message Passing) calls

There is **NO** support for Paras pallet calls, meaning Moonbeam cannot and does not interact with the new `authorize_force_set_current_code_hash` or `apply_authorized_force_set_current_code` functions.

#### 4. Search for New Functionality

**Search performed**:
```bash
grep -r "authorize_force_set_current_code" /Users/manuelmauro/Workspace/moonbeam/
grep -r "apply_authorized" /Users/manuelmauro/Workspace/moonbeam/
```

**Results**:
- No matches for `authorize_force_set_current_code` (the new PR functions)
- Matches for `apply_authorized_upgrade` are related to `frame_system`, not the Paras pallet
- The only reference to the PR is in the tracking file itself

#### 5. Version Information

**File**: `/Users/manuelmauro/Workspace/moonbeam/Cargo.lock`
```toml
name = "polkadot-runtime-parachains"
version = "19.2.1"
source = "git+https://github.com/moonbeam-foundation/polkadot-sdk?branch=moonbeam-polkadot-stable2503#f1c87aa3"
```

The current version will receive a **major bump** as part of the upgrade to stable2506, but this affects only test code.

## Detailed Findings

### What This PR Does NOT Affect

1. **Runtime Code**: Moonbeam's production runtime does not use or depend on the Paras pallet
2. **XCM Functionality**: The XCM transactor functionality is unaffected as it doesn't support Paras pallet calls
3. **Relay Chain Interactions**: Moonbeam's relay chain interactions through the relay encoder are limited to Staking, Utility, and HRMP calls
4. **Upgrade Mechanisms**: Moonbeam uses its own upgrade mechanisms via `frame_system` and governance, not the Paras pallet functions

### What This PR Does Affect

1. **Test Dependencies**: The `polkadot-runtime-parachains` dev-dependency will receive a major version bump
2. **Test Compilation**: Test code that creates mock relay chains will compile against the new version with the added functionality
3. **XCM Mock Tests**: Mock relay chain tests will have the new extrinsics available in the Paras pallet mock, though they are not used

## Action Items

### Required Actions: **NONE**

This PR has no impact on Moonbeam's production runtime or functionality.

### Optional Actions

1. **Update dev-dependencies**: When upgrading to stable2506, the `polkadot-runtime-parachains` dev-dependency will be automatically updated
2. **Test Verification**: Existing tests should continue to pass without modifications

## Risk Assessment

**Risk Level**: **NONE**

### Why No Risk?

1. **Dev-only Dependency**: The affected crate is only used for testing
2. **No Production Usage**: Moonbeam's runtime doesn't use or interact with the Paras pallet
3. **No Breaking Changes to Used APIs**: The test code only uses genesis configuration and basic pallet setup, which are unchanged
4. **Backwards Compatible**: The PR adds new functionality without modifying existing APIs

## Test Impact Analysis

### Tests That Need Review: **NONE**

The XCM integration tests use the Paras pallet mock for relay chain simulation, but they only interact with:
- Genesis configuration (`ParasGenesisConfig`, `ParaGenesisArgs`)
- HRMP functionality (handled by separate pallet)
- Basic relay chain setup

None of these test scenarios involve the new authorization functions.

### Example Test Files (No Changes Needed):
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/tests/xcm_tests.rs`
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbeam/tests/xcm_tests.rs`
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonriver/tests/xcm_tests.rs`

## Related PRs

- **PR #9202**: "apply_authorized_force_set_current_code does not need to consume the whole block"
  - This is an optimization follow-up to PR #7592
  - Also has no impact on Moonbeam (same reasoning as above)

## Conclusion

This PR adds new functionality to the relay chain's `Paras` pallet that is specifically designed for relay chain governance operations. Since Moonbeam is a **parachain** and only uses `polkadot-runtime-parachains` as a test dependency:

1. **No production code changes are needed**
2. **No new functionality is available to Moonbeam**
3. **No risks are introduced**
4. **No tests need modification**

The PR is transparent to Moonbeam's operation and the upgrade will proceed smoothly without any required adaptations.

## Recommendation

**Status**: âœ… **APPROVED - NO ACTION REQUIRED**

This PR can be included in the stable2506 upgrade without any concerns or modifications to Moonbeam's codebase.
