# PR #7597: Introduce CreateBare, deprecated CreateInherent

## PR Summary

**Title:** Introduce CreateBare, deprecated CreateInherent
**GitHub:** https://github.com/paritytech/polkadot-sdk/pull/7597
**Labels:** T1-FRAME
**Status:** Merged
**Polkadot SDK Release:** stable2506

### Changes Overview

This PR addresses a naming inconsistency in the Polkadot SDK where the `CreateInherent` trait was misleadingly named despite being used to generate unsigned transactions rather than inherents. Since both unsigned transactions and inherents use the `Bare` extrinsic type, the trait has been renamed to `CreateBare` for clarity.

**Key Changes:**
- Renamed `CreateInherent` trait to `CreateBare`
- Renamed `create_inherent()` method to `create_bare()`
- Deprecated old names with backward-compatible type aliases and default implementations
- Updated all polkadot-sdk internal usage to the new naming

**Affected Crates (Major Bumps):**
- frame-system
- pallet-babe, pallet-beefy, pallet-grandpa, pallet-im-online
- pallet-election-provider-multi-block, pallet-election-provider-multi-phase
- pallet-mixnet, pallet-offences-benchmarking
- polkadot-runtime-common, polkadot-runtime-parachains
- rococo-runtime, westend-runtime

## Impact Analysis

### Impact Category: **MINOR**

**Rationale:**
- Changes affect only test code in XCM mock implementations
- No production runtime code uses this trait
- Breaking changes are mitigated by deprecation warnings and type aliases
- Simple mechanical refactoring with clear upgrade path

---

## Concrete Evidence

### 1. Direct Usage in Moonbeam Codebase

#### Test Code Implementations (3 occurrences)

All three Moonbeam runtimes have identical implementations in their XCM mock relay chain test files:

**File:** `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/tests/xcm_mock/relay_chain.rs:318-325`
```rust
impl<C> frame_system::offchain::CreateInherent<C> for Runtime
where
	RuntimeCall: From<C>,
{
	fn create_inherent(call: RuntimeCall) -> UncheckedExtrinsic {
		UncheckedExtrinsic::new_bare(call)
	}
}
```

**File:** `/Users/manuelmauro/Workspace/moonbeam/runtime/moonriver/tests/xcm_mock/relay_chain.rs:318-325`
```rust
impl<C> frame_system::offchain::CreateInherent<C> for Runtime
where
	RuntimeCall: From<C>,
{
	fn create_inherent(call: RuntimeCall) -> UncheckedExtrinsic {
		UncheckedExtrinsic::new_bare(call)
	}
}
```

**File:** `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbeam/tests/xcm_mock/relay_chain.rs:318-325`
```rust
impl<C> frame_system::offchain::CreateInherent<C> for Runtime
where
	RuntimeCall: From<C>,
{
	fn create_inherent(call: RuntimeCall) -> UncheckedExtrinsic {
		UncheckedExtrinsic::new_bare(call)
	}
}
```

#### Context

These implementations are part of XCM mock relay chain configurations used for testing XCM (Cross-Chain Messaging) functionality. The test files are imported and used in:
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/tests/xcm_tests.rs`
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonriver/tests/xcm_tests.rs`
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbeam/tests/xcm_tests.rs`

### 2. Scope Verification

**Production Code:** ✅ **NOT AFFECTED**
```bash
# No usage in production runtime code
$ rg "CreateInherent" runtime/*/src/lib.rs
# No results

# No usage in custom pallets
$ rg "CreateInherent" pallets/
# No results
```

**Node Service Code:** ✅ **NOT AFFECTED**
The occurrences in `node/service/src/lazy_loading/manual_sealing.rs` use a different trait:
```rust
use sp_inherents::{CreateInherentDataProviders, InherentDataProvider};
```
This is `CreateInherentDataProviders` from `sp_inherents`, which is unrelated to the `frame_system::offchain::CreateInherent` being renamed.

### 3. Dependencies

Moonbeam uses `frame-system v40.2.0` from the moonbeam-foundation/polkadot-sdk fork:
```bash
$ cargo tree -p frame-system
frame-system v40.2.0 (https://github.com/moonbeam-foundation/polkadot-sdk?branch=moonbeam-polkadot-stable2503#f1c87aa3)
```

All three runtimes (moonbase, moonriver, moonbeam) and 30+ pallets/precompiles depend on frame-system.

---

## Required Changes

### Files Requiring Updates: **3 files**

1. **`/Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/tests/xcm_mock/relay_chain.rs`**
2. **`/Users/manuelmauro/Workspace/moonbeam/runtime/moonriver/tests/xcm_mock/relay_chain.rs`**
3. **`/Users/manuelmauro/Workspace/moonbeam/runtime/moonbeam/tests/xcm_mock/relay_chain.rs`**

### Migration Steps

For each file, update the implementation block:

**Before:**
```rust
impl<C> frame_system::offchain::CreateInherent<C> for Runtime
where
	RuntimeCall: From<C>,
{
	fn create_inherent(call: RuntimeCall) -> UncheckedExtrinsic {
		UncheckedExtrinsic::new_bare(call)
	}
}
```

**After:**
```rust
impl<C> frame_system::offchain::CreateBare<C> for Runtime
where
	RuntimeCall: From<C>,
{
	fn create_bare(call: RuntimeCall) -> UncheckedExtrinsic {
		UncheckedExtrinsic::new_bare(call)
	}
}
```

**Changes per file:**
1. Line 318: Change `CreateInherent` → `CreateBare`
2. Line 322: Change `create_inherent` → `create_bare`

---

## Testing Requirements

### Affected Test Suites

The changes affect XCM integration tests that use the mock relay chain environments:

```bash
# Test commands for affected runtimes
cargo test --package moonbase-runtime --test xcm_tests
cargo test --package moonriver-runtime --test xcm_tests
cargo test --package moonbeam-runtime --test xcm_tests
```

### Test Coverage

The XCM test suites exercise cross-chain messaging scenarios including:
- Asset transfers between relay chain and parachains
- XCM transactor functionality
- Remote staking operations
- Asset registration and management
- Sovereign account interactions

All tests must pass after the refactoring to confirm no behavioral changes.

---

## Compatibility Notes

### Backward Compatibility

The PR provides deprecation warnings and backward compatibility through:
1. **Type Alias:** `CreateInherent` is aliased to `CreateBare`
2. **Default Implementation:** `create_inherent()` delegates to `create_bare()`

However, **Moonbeam should update immediately** because:
- The old trait/method are deprecated and will be removed in future releases
- Compiler warnings will be present until updated
- The migration is straightforward and mechanical

### Breaking Change Impact

This is a **major breaking change** in frame-system, but the impact on Moonbeam is:
- **Limited to test code** - No production runtime changes needed
- **Compile-time detection** - Missing implementations will fail compilation
- **Clear migration path** - Simple rename with no logic changes

---

## Additional Context

### Purpose of the Trait

The `CreateBare` (formerly `CreateInherent`) trait is used to create unsigned extrinsics with bare format. In the XCM mock tests, it's implemented to support the test infrastructure's need to create unsigned transactions for simulating relay chain operations.

### Why Tests Need This Trait

XCM mock tests simulate multi-chain environments where:
- Relay chains need to process unsigned inherents and transactions
- The trait implementation allows test infrastructure to construct proper extrinsic formats
- `UncheckedExtrinsic::new_bare()` creates the correct extrinsic type for test scenarios

The production Moonbeam runtimes don't need this implementation because they use the real runtime execution environment where extrinsic creation is handled by the Substrate framework itself.

---

## Risk Assessment

**Overall Risk: LOW**

| Risk Factor | Level | Notes |
|------------|-------|-------|
| Compilation | Low | Missing implementations will cause compile errors |
| Runtime Impact | None | No production runtime code affected |
| Test Impact | Low | Tests will fail if not updated, but fixes are straightforward |
| Migration Complexity | Low | Simple mechanical refactoring |
| Behavioral Changes | None | Pure naming refactoring with identical logic |

---

## Recommendations

1. **Priority: Medium** - Update during the next stable2506 upgrade cycle
2. **Approach:** Mechanical refactoring across 3 test files
3. **Validation:** Run full XCM test suite after changes
4. **Timeline:** Can be batched with other stable2506 test updates

The changes are isolated to test infrastructure and present minimal risk to production operations. The deprecated names will continue working but should be updated to avoid future warnings and ensure long-term maintainability.
