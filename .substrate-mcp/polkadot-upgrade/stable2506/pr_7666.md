# PR #7666: Migrate 0009-approval-voting-coalescing.zndsl to zombienet-sdk

## Metadata
- **PR URL**: https://github.com/paritytech/polkadot-sdk/pull/7666
- **Labels**: T10-tests
- **Audience**: Node Dev
- **Affected Crates**: None (`crates: []`)

## Summary
This PR migrates a Polkadot relay chain approval voting test from the legacy zombienet format (`.zndsl` and `.toml`) to the modern zombienet-sdk Rust-based test framework. The test verifies that approval voting coalescing doesn't cause finality lag in the relay chain.

## Changes Overview

### Files Modified
1. **New Test Implementation** (`polkadot/zombienet-sdk-tests/tests/functional/approval_voting_coalescing.rs`)
   - 107-line Rust test replacing legacy declarative test
   - Configures relay chain with 12 validators and 8 parachains
   - Asserts finality lag and no-show metrics

2. **CI/CD Updates**
   - `.github/workflows/zombienet_polkadot.yml`: Updated workflow to use SDK-based test runner
   - `.gitlab/pipeline/zombienet/polkadot.yml`: Updated GitLab CI configuration

3. **Removed Legacy Files**
   - `polkadot/zombienet_tests/functional/0009-approval-voting-coalescing.toml` (115 lines)
   - `polkadot/zombienet_tests/functional/0009-approval-voting-coalescing.zndsl` (32 lines)

4. **Module Declaration**
   - `polkadot/zombienet-sdk-tests/tests/functional/mod.rs`: Added module reference

## Impact Analysis on Moonbeam

### Direct Impact: **NONE**

**Rationale:**
1. **Test Infrastructure Only**: This PR exclusively modifies test infrastructure with no production code changes. The PRDoc confirms `crates: []`, meaning no crates were affected.

2. **Relay Chain Specific**: The approval voting mechanism being tested is relay chain validator functionality. Moonbeam is a parachain and does not implement or depend on relay chain approval voting logic.

3. **Different Test Framework**:
   - **Moonbeam uses**: Legacy zombienet with native provider (`.zndsl` format)
   - **This PR affects**: Polkadot SDK's zombienet-sdk migration (Rust-based tests)
   - Evidence: Moonbeam's zombienet configs in `/zombienet/configs/moonbeam-polkadot.toml` use `provider = "native"` and legacy `.zndsl` test files exist in `/zombienet/integration-tests/bridges/`

4. **No API Changes**: No runtime APIs, RPC methods, or pallet interfaces were modified. The test uses existing public APIs from:
   - `cumulus_zombienet_sdk_helpers`
   - `polkadot_primitives`
   - `zombienet_sdk`

### Verification Evidence

**Codebase Search Results:**
```bash
# Search for zombienet-sdk usage in Moonbeam
grep -ri "zombienet[-_]sdk" /Users/manuelmauro/Workspace/moonbeam
# Result: No files found

# Search for approval voting references
grep -ri "approval.*voting|approval.*coalescing" /Users/manuelmauro/Workspace/moonbeam
# Result: Only found in Cargo.lock and chain spec JSON files (dependency declarations)

# Moonbeam's zombienet test files
find /Users/manuelmauro/Workspace/moonbeam -name "*.zndsl"
# Result: 6 legacy .zndsl files in bridges integration tests
```

**Moonbeam Zombienet Configuration:**
- Uses native provider with legacy format
- Configures parachain (id: 2_004) with Polkadot relay chain
- No zombienet-sdk dependencies

## Conclusion

**Impact Level**: NO IMPACT

This PR is a pure test infrastructure migration within the Polkadot SDK repository. It does not:
- Modify any runtime or client code
- Change any public APIs or crate interfaces
- Affect parachain functionality or relay chain interaction
- Require any action from Moonbeam maintainers

The change is internal to Polkadot SDK's testing strategy and has zero functional impact on downstream consumers like Moonbeam.

## Recommended Actions
**None required.** This PR can be safely ignored for Moonbeam upgrade planning.
