# PR #7857 Impact Analysis: Add new host APIs set_storage_or_clear and get_storage_or_zero

## Basic Information

- **PR Number**: #7857
- **Title**: Add new host APIs set_storage_or_clear and get_storage_or_zero
- **GitHub**: https://github.com/paritytech/polkadot-sdk/pull/7857
- **Labels**: T7-smart_contracts
- **Audience**: Runtime Dev

## PR Summary

This PR introduces two new storage API functions for pallet-revive that provide fixed-size (32-byte) storage operations designed to match Ethereum's SSTORE semantics:

1. **set_storage_or_clear**: Sets storage at a fixed 256-bit key with a fixed 256-bit value. If the provided value is all zeros, the key is cleared.
2. **get_storage_or_zero**: Reads storage at a fixed 256-bit key and writes back a fixed 256-bit value. If the key does not exist, 32 bytes of zero are written back.

### Affected Crates

- `pallet-revive-fixtures` (patch bump)
- `pallet-revive` (patch bump)
- `pallet-revive-uapi` (minor bump)

### Purpose

These APIs are an attempt to match Ethereum's SSTORE semantics, providing additional functionality for setting and retrieving storage values in pallet-revive contracts.

## Impact Assessment: NO IMPACT

### Verdict: NOT APPLICABLE

**Moonbeam is NOT affected by this PR.**

### Evidence

#### 1. Pallet Usage Analysis

Moonbeam does not use pallet-revive or any of its related crates. Search results confirm:

```bash
# Search for pallet-revive in Cargo.toml files
grep -r "pallet-revive" /Users/manuelmauro/Workspace/moonbeam/**/*.toml
# Result: No matches found
```

#### 2. Runtime Configuration

Analysis of Moonbeam's runtime configurations shows the use of different smart contract pallets:

**File**: `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/src/lib.rs`

From the `construct_runtime!` macro:
```rust
EVM: pallet_evm::{Pallet, Config<T>, Call, Storage, Event<T>} = 10,
Ethereum: pallet_ethereum::{Pallet, Call, Storage, Event, Origin, Config<T>} = 11,
```

**No pallet-revive or pallet-contracts pallets are configured in any Moonbeam runtime variant (moonbeam, moonriver, moonbase).**

#### 3. Architecture Difference

**Moonbeam's Smart Contract Architecture**:
- Uses **pallet-evm** for EVM execution
- Uses **pallet-ethereum** for Ethereum compatibility layer
- Provides Ethereum-style smart contracts using the Frontier stack
- Is a fully Ethereum-compatible parachain

**Pallet-revive Architecture**:
- Substrate-native smart contracts pallet (successor to pallet-contracts)
- Uses PolkaVM instead of EVM
- Provides EVM-like compatibility through translation layer
- Used in Asset Hub and other Substrate-native chains

These are fundamentally different smart contract execution environments.

#### 4. Project Context

From Moonbeam's README:
> "An Ethereum compatible Parachain built with the Polkadot-SDK"

Moonbeam is explicitly designed as an Ethereum-compatible parachain using native EVM support through pallet-evm, not through Substrate contracts pallets.

## Technical Details

### What This PR Does

The PR adds two new host functions to the pallet-revive runtime interface:

```rust
// Example usage from the PR
let existing = api::set_storage_or_clear(StorageFlags::empty(), &KEY, &VALUE_A);
assert_eq!(existing, None);

let mut stored: [u8; 32] = [0u8; 32];
let _ = api::get_storage_or_zero(StorageFlags::empty(), &KEY, &mut stored);
assert_eq!(stored, VALUE_A);
```

These functions operate with:
- Fixed 256-bit (32-byte) keys
- Fixed 256-bit (32-byte) values
- Special handling for zero values (clearing on set, returning zeros on missing keys)

### Why Moonbeam Is Not Affected

1. **Different Execution Environment**: Moonbeam uses a real EVM (through pallet-evm), not the PolkaVM-based execution that pallet-revive provides.

2. **No Code Dependencies**: None of Moonbeam's crates depend on pallet-revive or pallet-revive-uapi.

3. **Different Storage APIs**: Moonbeam's smart contracts interact with storage through EVM opcodes (SLOAD/SSTORE), not through Substrate host functions.

4. **Architectural Separation**: The host APIs added in this PR are specific to pallet-revive's execution environment and have no impact on pallet-evm's operation.

## Related PRs

The stable2506 release includes multiple pallet-revive PRs, none of which affect Moonbeam:
- #8103: [pallet-revive] Add genesis config
- #8148: [revive] eth-rpc refactoring
- #8197: [pallet-revive] add fee_history
- #8212: [pallet-revive] fix bn128 benchmark
- #8262: pallet_revive: Replace adhoc pre-compiles with pre-compile framework
- #8273: pallet-revive: Add net-listening rpc
- #8274: [pallet-revive] add get_storage_var_key for variable-sized keys
- #8311: [pallet-revive] update tracing rpc methods parameters
- And others...

## Action Items

### Required Actions
- **NONE** - No changes needed

### Testing Requirements
- **NONE** - This PR does not affect Moonbeam

### Migration Requirements
- **NONE** - No migrations needed

### Documentation Updates
- **NONE** - No documentation changes needed

## Conclusion

PR #7857 introduces new storage host APIs specifically for pallet-revive to provide Ethereum SSTORE-like semantics in Substrate smart contracts. **Moonbeam is completely unaffected** because it uses an entirely different smart contract execution architecture based on pallet-evm and pallet-ethereum, not pallet-revive.

**Impact Level**: None
**Priority**: N/A
**Risk**: None

---

**Analysis Date**: 2025-10-22
**Analyzed By**: Claude Code
**Confidence Level**: High
