# PR #7857 Impact Analysis: Add new host APIs set_storage_or_clear and get_storage_or_zero

## PR Overview

**Title:** Add new host APIs set_storage_or_clear and get_storage_or_zero

**GitHub URL:** https://github.com/paritytech/polkadot-sdk/pull/7857

**Labels:** T7-smart_contracts

**Modified Crates:**
- pallet-revive-fixtures (patch)
- pallet-revive (patch)
- pallet-revive-uapi (minor)

## Summary

This PR introduces two new storage API functions for pallet-revive that provide fixed-size (32-byte) storage operations matching Ethereum's SSTORE semantics:

1. **set_storage_or_clear**: Sets storage at a fixed 256-bit key with a 256-bit value; automatically clears the entry if the value is all zeros
2. **get_storage_or_zero**: Reads storage at a fixed 256-bit key, returning 32 bytes of zeros if the key doesn't exist

## Technical Changes

### Core Implementation
- **substrate/frame/revive/src/wasm/runtime.rs**: Added new `StorageValue` enum and `StorageReadMode` enum to support fixed-size storage operations
- **substrate/frame/revive/uapi/src/host.rs**: Added trait methods for the two new host APIs
- **substrate/frame/revive/fixtures/contracts/**: New test contract for validating the APIs

### Key Features
- Fixed 256-bit key/value pairs (32 bytes each)
- Automatic storage clearing when zero values are written
- Zero-byte returns for non-existent keys
- Support for both regular and transient storage flags

## Impact Assessment: INHERITED

### Evidence from Moonbeam Codebase

**pallet-revive Usage Search:**
```bash
# Search for pallet-revive or pallet_revive in all files
grep -r "pallet-revive\|pallet_revive" /Users/manuelmauro/Workspace/moonbeam
# Result: No matches found (except in documentation files)

# Search for revive in Cargo.toml files
grep "revive" /Users/manuelmauro/Workspace/moonbeam/**/Cargo.toml
# Result: No dependencies found
```

**Moonbeam's Smart Contract Platform:**

From `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbeam/Cargo.toml`:
- Lines 145-156: Moonbeam uses **Frontier** (pallet-evm, pallet-ethereum, fp-evm, fp-rpc)
- Lines 56-77: Moonbeam has extensive EVM precompiles for Ethereum compatibility
- No pallet-revive, pallet-contracts, or PolkaVM dependencies

**Smart Contract Architecture:**
- **Moonbeam:** Ethereum-compatible parachain using pallet-evm (Frontier)
- **pallet-revive:** New WASM/PolkaVM-based smart contract platform
- These are completely separate smart contract runtimes with different execution environments

### Why INHERITED

1. **No Direct Usage:** Moonbeam does not use pallet-revive in any of its runtimes (moonbeam, moonriver, moonbase)

2. **Different Contract Platforms:**
   - Moonbeam: EVM-based smart contracts via Frontier
   - pallet-revive: WASM/PolkaVM-based smart contracts
   - These are mutually exclusive platforms

3. **Additive Changes Only:** The PR adds new optional host APIs without modifying existing functionality

4. **No Breaking Changes:** All changes are backward compatible; existing pallet-revive users are unaffected if they don't use the new APIs

## Action Required

**None.** This change will be inherited through the Polkadot SDK dependency update but has zero impact on Moonbeam's functionality.

## Recommendations

1. **No Code Changes Needed:** Moonbeam does not need to modify any code
2. **No Testing Required:** The changes are isolated to pallet-revive which Moonbeam doesn't use
3. **No Migration Required:** No storage or runtime changes affecting Moonbeam

## Related Components

**Moonbeam's Smart Contract Stack:**
- pallet-evm (Frontier EVM implementation)
- pallet-ethereum (Ethereum block/transaction format)
- EVM precompiles (Substrate-to-EVM bridges)
- pallet-ethereum-xcm (XCM integration for EVM)

**Not Used by Moonbeam:**
- pallet-revive (WASM/PolkaVM contracts)
- pallet-contracts (ink! contracts)

## Conclusion

PR #7857 has **no functional impact** on Moonbeam. The changes are specific to pallet-revive's contract execution environment, which Moonbeam does not utilize. The PR will be inherited as part of the Polkadot SDK upgrade but requires no action from the Moonbeam team.

**Impact Level:** INHERITED
**Action Required:** None
**Risk Level:** None
