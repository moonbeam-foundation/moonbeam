# PR #7882 Impact Analysis: Add poke_deposit Extrinsic to pallet-recovery

## Executive Summary

**Impact Level: NO IMPACT**

PR #7882 adds a new `poke_deposit` extrinsic to `pallet-recovery` for re-adjusting deposits after runtime upgrades. This PR has **NO IMPACT** on Moonbeam because the `pallet-recovery` is not used in any Moonbeam runtime.

## PR Overview

### Metadata
- **PR Number**: [#7882](https://github.com/paritytech/polkadot-sdk/pull/7882)
- **Title**: add poke_deposit extrinsic to pallet-recovery
- **Author**: UtkarshBhardwaj007
- **Merged**: April 22, 2025
- **Labels**: T1-FRAME, T2-pallets
- **Audience**: Runtime Dev

### Changes Summary

#### What Changed
1. **New Extrinsic**: Adds `poke_deposit` to `pallet-recovery` for re-adjusting deposits made in the pallet after AHM (After Hybrid Migration)
2. **New Event**: `DepositPoked` event to signal successful deposit adjustment
3. **New Enum**: `DepositKind` to distinguish between Friend and Recovery deposit types
4. **Bug Fix**: Fixed issue in `insert_recovery_config` benchmark helper where funds were being reserved from the wrong account
5. **Migration**: Migrated pallet-recovery to FRAME umbrella crate

#### Technical Details
- **Purpose**: Enable flexible deposit adjustment (both increases and decreases) within pallet-recovery
- **Fee Structure**: Calls that modify deposits are fee-free; calls with no adjustment incur normal fees
- **Performance**: Benchmarking shows approximately 299-330 microseconds execution time
- **Bump Type**: Major version bump for pallet-recovery, rococo-runtime, and westend-runtime

## Moonbeam-Specific Analysis

### Current Usage

**pallet-recovery is NOT used in Moonbeam**

Comprehensive codebase analysis confirms:
- ✓ NOT in moonbase-runtime
- ✓ NOT in moonbeam-runtime
- ✓ NOT in moonriver-runtime
- ✓ NOT in any runtime Cargo.toml dependencies
- ✓ NOT in any `construct_runtime!` macro configurations

### Dependency Chain

pallet-recovery appears in Moonbeam's `Cargo.lock` only as a **transitive dependency**:

```
westend-runtime (dev-dependency)
└── pallet-recovery (transitive)

rococo-runtime (dev-dependency)
└── pallet-recovery (transitive)
```

**Context**: `westend-runtime` is only used as a dev-dependency in the `relay-encoder` module:
- **Location**: `/runtime/relay-encoder/Cargo.toml`
- **Purpose**: Encoding XCM calls to relay chains (Staking, Utility, HRMP operations)
- **Usage**: Does NOT use any recovery functionality
- **Scope**: Dev-dependency only, not included in production runtimes

### Evidence Files Checked

| File Path | Recovery Usage |
|-----------|---------------|
| `/runtime/moonbase/Cargo.toml` | Not found |
| `/runtime/moonbeam/Cargo.toml` | Not found |
| `/runtime/moonriver/Cargo.toml` | Not found |
| `/runtime/moonbase/src/lib.rs` | Not in construct_runtime! |
| `/runtime/moonbeam/src/lib.rs` | Not in construct_runtime! |
| `/runtime/moonriver/src/lib.rs` | Not in construct_runtime! |
| `/runtime/relay-encoder/src/*.rs` | No recovery calls encoded |

**Network Verification**: Queried Moonbase Alpha network metadata - pallet-recovery not present.

### Terminology Clarification

**Important**: The term "recovery" in Moonbeam codebase refers to **cryptographic signature recovery** (ecrecover), NOT the social recovery pallet:

- `ECContracts.sol`: Contains `RecoveryChecker` contract using `ecrecover` precompile (address 0x01)
- EVM precompile functionality for recovering addresses from signatures
- Completely different from `pallet-recovery` (social account recovery)

## Impact Assessment

### Direct Impact
- **Runtime Changes**: None - pallet not used
- **Storage Migrations**: None required
- **API Changes**: None - no RPC or runtime APIs affected
- **Breaking Changes**: None for Moonbeam

### Indirect Impact
- **Dependency Updates**: pallet-recovery version bump in upstream dependencies
- **Relay Chain Compatibility**: No concerns - Moonbeam doesn't interact with recovery functionality
- **Build System**: No impact - transitive dependency only

### Testing Requirements
**None** - No testing required as the pallet is not used in Moonbeam.

## Action Items

### Required Actions
None

### Recommended Actions
None

### Migration Steps
Not applicable

## Risk Assessment

**Risk Level: NONE**

- **Compatibility Risk**: None - pallet not used
- **Runtime Upgrade Risk**: None - no runtime changes needed
- **User Impact**: None - no user-facing changes
- **Performance Impact**: None

## Verification

### Pre-merge Checklist
- [x] Confirmed pallet-recovery not in any Moonbeam runtime
- [x] Verified no usage in construct_runtime! macros
- [x] Checked relay-encoder module (dev-dependency only)
- [x] Confirmed no recovery-related functionality in Moonbeam
- [x] Verified on-chain metadata (Moonbase Alpha)

### Post-merge Checklist
Not applicable - no changes required

## Related Context

### What is pallet-recovery?
`pallet-recovery` is a Substrate pallet that provides **social account recovery** functionality:
- Allows users to designate trusted "friends" who can help recover an account
- Requires deposits for both the recovery configuration and friend vouches
- The new `poke_deposit` extrinsic allows adjusting these deposits after runtime parameter changes

### Why Moonbeam Doesn't Use It
Moonbeam is primarily Ethereum-compatible and focuses on:
- EVM-based account model (externally owned accounts controlled by private keys)
- Ethereum-style signature schemes
- Smart contract-based recovery solutions (if needed)

Social recovery pallets are more commonly used in:
- Polkadot relay chains (Polkadot, Kusama, Westend, Rococo)
- Identity-focused parachains
- Chains with complex on-chain governance models

## References

### Documentation
- [PR #7882](https://github.com/paritytech/polkadot-sdk/pull/7882)
- [PRDoc](/Users/manuelmauro/.substrate-mcp/moonbeam/releases/stable2506/pr-docs/pr_7882.prdoc)
- [Related Issue #5591](https://github.com/paritytech/polkadot-sdk/issues/5591) - Deposit reconsideration mechanisms

### Code Locations
- Pallet: `polkadot-sdk/substrate/frame/recovery`
- Moonbeam relay-encoder: `/runtime/relay-encoder/`
- Cargo.lock references: Lines 10457, 13387, 18988

## Conclusion

PR #7882 has **no impact** on Moonbeam. The `pallet-recovery` is not used in any Moonbeam runtime and only appears as a transitive dependency through relay chain runtimes used for development purposes. No action is required from the Moonbeam team.

The PR improves deposit management for chains that do use pallet-recovery (primarily relay chains), but this functionality is not relevant to Moonbeam's Ethereum-compatible architecture and account model.
