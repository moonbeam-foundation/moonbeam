# PR #7936: Replace Validator FullIdentification from `Exposure` to `Existence`

## Metadata
- **PR**: https://github.com/paritytech/polkadot-sdk/pull/7936
- **Labels**: I4-refactor, T2-pallets
- **Crate Bumps**:
  - pallet-staking: **major** (40.1.1 → 41.0.0)
  - pallet-babe, pallet-beefy, pallet-grandpa, pallet-offences-benchmarking, pallet-root-offences, pallet-session-benchmarking: **patch**
  - westend-runtime: **minor**

## Summary

This PR refactors how validators are identified in Polkadot SDK's staking system, specifically for historical session data. Instead of using full `Exposure` data (which contains detailed stake information about validators and their nominators), it introduces a lightweight `Existence` type that simply confirms a validator's presence in a session.

### Key Changes

1. **New Types Introduced**:
   - `Existence`: Type alias for `()`, representing minimal validator identification
   - `ExistenceOf<T>`: Converter that returns `Some(())` if validator exists in active era
   - `ExistenceOrLegacyExposure<A, B>`: Enum with custom codec for backward compatibility
   - `ExistenceOrLegacyExposureOf<T>`: Backward-compatible converter supporting both formats

2. **Deprecated**:
   - `ExposureOf<T>`: Replaced by the new types above

3. **Configuration Changes**:
   - Affects `pallet_session::historical::Config` implementation
   - Runtimes can now configure `FullIdentification = pallet_staking::Existence`
   - For backward compatibility with stored offence data, use `ExistenceOrLegacyExposureOf`

4. **Motivation**:
   - Post-AHM (After Hosting Module), validator exposure data moves to Asset Hub
   - Relay chains no longer need full exposure information for validator identification
   - Reduces storage bloat in `pallet_offences::Reports` which was never cleaned up

## Impact Assessment: **INHERITED**

### Analysis

**Moonbeam is NOT directly affected** by this change because:

1. **No Runtime Configuration Impact**:
   - Moonbeam does NOT use `pallet-staking` in its runtime
   - Moonbeam uses `pallet-parachain-staking` for its staking logic
   - Moonbeam does NOT configure `pallet_session::historical::Config`
   - Moonbeam does NOT use `pallet_offences`
   - Confirmed by examining all three runtimes (moonbase, moonbeam, moonriver)

2. **Limited Dependency Usage**:
   - The only references to `pallet_staking` are in the `relay-encoder` module
   - These references are for encoding staking calls to relay chains via XCM
   - Specifically uses: `pallet_staking::RewardDestination` and `pallet_staking::ValidatorPrefs`
   - **These types were NOT modified by this PR**

3. **Verified Locations**:
   ```
   /Users/manuelmauro/Workspace/moonbeam/runtime/relay-encoder/src/westend.rs
   /Users/manuelmauro/Workspace/moonbeam/runtime/relay-encoder/src/kusama.rs
   /Users/manuelmauro/Workspace/moonbeam/runtime/relay-encoder/src/polkadot.rs
   /Users/manuelmauro/Workspace/moonbeam/primitives/xcm/src/transactor_traits.rs
   ```

4. **Example Usage** (from `relay-encoder/src/westend.rs`):
   ```rust
   pub enum StakeCall {
       Bond(
           #[codec(compact)] cumulus_primitives_core::relay_chain::Balance,
           pallet_staking::RewardDestination<AccountId32>,
       ),
       Validate(pallet_staking::ValidatorPrefs),
       SetPayee(pallet_staking::RewardDestination<AccountId32>),
       // ... other calls
   }
   ```

### Why INHERITED?

The changes will be inherited when Moonbeam updates its polkadot-sdk dependency, but they are **completely transparent** because:
- No runtime configuration changes needed
- No pallet additions or removals required
- The types Moonbeam imports remain unchanged and backward compatible
- The relay-encoder functionality continues to work identically

## Action Items

**None required.**

This is a transparent refactor that doesn't impact Moonbeam's functionality:
- ✅ No code changes needed
- ✅ No migration required
- ✅ No runtime configuration updates
- ✅ No testing beyond standard integration tests

## Technical Details

### Changed Pallets (Not Used by Moonbeam)
- `pallet-babe`: Consensus mechanism (not used by parachains)
- `pallet-beefy`: Bridge authority discovery (not used by Moonbeam)
- `pallet-grandpa`: Finality gadget (not used by parachains)
- `pallet-offences`: Offence handling (not configured in Moonbeam)
- `pallet-session-benchmarking`: Benchmarking only
- `pallet-staking`: Relay chain staking (Moonbeam uses `pallet-parachain-staking`)

### Moonbeam's Staking Architecture
Moonbeam uses **`pallet-parachain-staking`** (index 12 in construct_runtime!), which is a completely separate implementation designed for parachain collator selection and delegation, unrelated to `pallet-staking`.

### Relay Encoder Context
The relay-encoder module allows Moonbeam users to execute staking operations on relay chains (Polkadot/Kusama/Westend) through XCM. It only imports stable, public types from `pallet_staking` that were not affected by this refactor.

## References

- PRDoc: `/Users/manuelmauro/.substrate-mcp/moonbeam/releases/stable2506/pr-docs/pr_7936.prdoc`
- Moonbeam Runtime: `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/src/lib.rs` (lines 1414-1484)
- Relay Encoder: `/Users/manuelmauro/Workspace/moonbeam/runtime/relay-encoder/src/`
- Current Dependency: `pallet-staking v40.1.1` (moonbeam-polkadot-stable2503 branch)

## Conclusion

This PR represents an internal optimization of Polkadot SDK's validator identification system that does not affect Moonbeam's functionality. The changes are backward compatible and require no action from the Moonbeam team. The relay-encoder functionality continues to work as expected since the types it uses (`RewardDestination`, `ValidatorPrefs`) were not modified.

**Recommendation**: Accept as-is when updating to stable2506. No code changes, migrations, or special testing required beyond standard integration test suite.
