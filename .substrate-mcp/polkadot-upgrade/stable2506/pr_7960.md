# PR #7960: Stabilize Pallet View Functions

**GitHub PR**: https://github.com/paritytech/polkadot-sdk/pull/7960
**Labels**: T1-FRAME, T4-runtime_API
**Impact Level**: **INHERITED** (No action required)

## Summary

This PR removes the experimental status from pallet view functions by renaming the macro attribute from `#[pallet::view_functions_experimental]` to `#[pallet::view_functions]`. This is a stabilization effort that promotes view functions as a recommended feature for runtime development.

## Changes Overview

### Core Changes
- **Macro Attribute Renamed**: `view_functions_experimental` â†’ `view_functions`
- **Crates Affected**:
  - `frame-support-procedural`: **major bump** (breaking change to macro name)
  - `frame-support`: **minor bump** (API addition)
- **Documentation Updated**: All references now reflect stable, production-ready status

### What Are View Functions?

View functions are read-only query methods that pallets can expose directly without requiring boilerplate runtime API declarations. They provide:

1. **Simplified Queries**: Define read-only functions directly on pallets
2. **Automatic Query IDs**: Unique identification based on pallet name and function signature
3. **External Execution**: Available via `ViewFunctionsApi` runtime trait
4. **Future Smart Contract Integration**: Potential for calling from EVM contracts

**Example Usage**:
```rust
#[pallet::view_functions]
impl<T: Config> Pallet<T> {
    /// Query a single value
    pub fn get_value() -> Option<u32> {
        SomeValue::<T>::get()
    }

    /// Query with arguments
    pub fn get_value_for_key(key: u32) -> Option<u32> {
        SomeMap::<T>::get(key)
    }
}
```

## Impact on Moonbeam

### Evidence of Current Usage

**Search Results**:
```bash
# Searching for any view_functions usage
$ rg "view_functions" /Users/manuelmauro/Workspace/moonbeam
# No matches found

$ rg "view_functions_experimental" /Users/manuelmauro/Workspace/moonbeam
# No matches found

$ rg "#\[pallet::view_functions" /Users/manuelmauro/Workspace/moonbeam
# No matches found
```

**Conclusion**: Moonbeam does not currently use pallet view functions (neither experimental nor stable).

### Custom Pallets Analysis

Moonbeam has 11 custom pallets that could potentially benefit from view functions:
- `pallet-parachain-staking`
- `pallet-moonbeam-orbiters`
- `pallet-crowdloan-rewards`
- `pallet-xcm-transactor`
- `pallet-ethereum-xcm`
- `pallet-moonbeam-foreign-assets`
- `pallet-erc20-xcm-bridge`
- `pallet-xcm-weight-trader`
- `pallet-moonbeam-lazy-migrations`
- `pallet-proxy-genesis-companion`
- `pallet-precompile-benchmarks`

Currently, these pallets likely expose queries through:
1. Traditional runtime APIs (in `/runtime/common/src/apis`)
2. Direct storage access via RPC
3. Precompile interfaces for EVM access

### Required Actions

**None**. This is a stabilization PR that:
- Renames an experimental feature to stable
- Does not affect Moonbeam since the feature is not currently in use
- Will be inherited through dependency updates automatically

### Optional Considerations

**Future Adoption**: Moonbeam could optionally adopt view functions for:

1. **Simplified Query Layer**: Reduce boilerplate compared to runtime APIs
2. **Better Developer Experience**: Cleaner pallet code organization
3. **Potential EVM Integration**: Future work may enable calling view functions from smart contracts

**Example Use Case** - `pallet-parachain-staking` could expose:
```rust
#[pallet::view_functions]
impl<T: Config> Pallet<T> {
    pub fn get_delegator_total_staked(delegator: T::AccountId) -> Balance {
        // Query delegator state without runtime API boilerplate
    }

    pub fn get_candidate_delegation_count(candidate: T::AccountId) -> u32 {
        // Quick delegation metrics
    }
}
```

However, this is **purely optional** and not required for the upgrade.

## Verification

### Codebase Search Commands
```bash
# Verify no usage of view_functions
rg "view_functions" /Users/manuelmauro/Workspace/moonbeam

# Verify no usage of experimental variant
rg "view_functions_experimental" /Users/manuelmauro/Workspace/moonbeam

# Check custom pallets
ls /Users/manuelmauro/Workspace/moonbeam/pallets
```

### Test Impact
- **Rust Tests**: No impact (feature not used)
- **TypeScript Tests**: No impact (feature not used)
- **Runtime Tests**: No impact (feature not used)

## Conclusion

**Impact Level**: **INHERITED**

This PR has **zero impact** on Moonbeam's current functionality. The macro rename is a breaking change at the Polkadot SDK level (hence the major bump to `frame-support-procedural`), but since Moonbeam doesn't use view functions, no code changes are required.

The stabilization makes view functions a recommended feature for future development, but adoption remains entirely optional.

### Checklist
- [x] Verified no current usage in codebase
- [x] Confirmed no migration required
- [x] Identified optional future opportunities
- [x] No test updates needed
- [x] No runtime version bump required
