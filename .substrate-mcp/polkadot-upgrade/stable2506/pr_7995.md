# PR #7995 Impact Analysis: Add `PureKilled` event to `pallet-proxy`

## PR Overview

**Title:** Add `PureKilled` event to `pallet-proxy`
**GitHub URL:** https://github.com/paritytech/polkadot-sdk/pull/7995
**Status:** Merged
**Labels:** T2-pallets, T10-tests, T14-system_parachains
**Pallet:** pallet-proxy
**Bump:** Major

### Description

This PR adds a new `PureKilled` event that is emitted when the `kill_pure` extrinsic is called on pallet-proxy. Previously, destroying pure proxies did not emit any event, making it difficult to track the lifecycle of pure proxy accounts through event logs.

**Key Changes:**
- New event `PureKilled` with fields: `pure`, `spawner`, `proxy_type`, `disambiguation_index`
- Event is emitted after successful removal of a pure proxy via `kill_pure` extrinsic
- Unit tests updated to verify event emission

## Impact Assessment

**Impact Level:** **INHERITED**

### Rationale

1. **Moonbeam uses pallet-proxy:** All three Moonbeam runtimes (moonbase, moonriver, moonbeam) include pallet-proxy with standard configuration
   - Location: `/Users/manuelmauro/Workspace/moonbeam/runtime/*/src/lib.rs`
   - Configuration: Standard setup with custom ProxyType enum and weight functions

2. **Pure proxy functionality is enabled:** Recent commit [33724e08b8](https://github.com/moonbeam-foundation/moonbeam/commit/33724e08b8414a1145d3ae3c7bdb61dbfb869204) (Oct 21, 2025) explicitly allowed `create_pure` and `kill_pure` calls through NormalFilter
   - Previously these calls were blocked
   - Integration tests verify these calls are allowed
   - Location: `/Users/manuelmauro/Workspace/moonbeam/runtime/*/tests/integration_test.rs`

3. **No EVM precompile exposure:** The proxy precompile (`/Users/manuelmauro/Workspace/moonbeam/precompiles/proxy/`) does NOT expose `create_pure` or `kill_pure` functionality
   - Only standard proxy operations (addProxy, removeProxy, proxy, etc.) are available via EVM
   - Pure proxy functionality is accessible only through Substrate API (polkadotJs)

4. **Change is backward compatible:** The new event is purely additive
   - No breaking changes to existing functionality
   - No changes to call signatures or parameters
   - No impact on weights (already benchmarked)

## Affected Components

### Runtime Components
- **pallet-proxy:** Direct dependency in all three runtimes
  - `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/src/lib.rs:1161`
  - `/Users/manuelmauro/Workspace/moonbeam/runtime/moonriver/src/lib.rs`
  - `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbeam/src/lib.rs`

### Weight Files
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/src/weights/pallet_proxy.rs`
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonriver/src/weights/pallet_proxy.rs`
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbeam/src/weights/pallet_proxy.rs`

Note: Weight functions for `kill_pure` already exist and should not require updates.

### TypeScript API
- `/Users/manuelmauro/Workspace/moonbeam/typescript-api/src/*/interfaces/augment-api-events.ts`
- `/Users/manuelmauro/Workspace/moonbeam/typescript-api/src/*/interfaces/lookup.ts`
- `/Users/manuelmauro/Workspace/moonbeam/typescript-api/src/*/interfaces/types-lookup.ts`

Current state: Only `PureCreated` event is defined. `PureKilled` will be added upon regeneration.

### Integration Tests
- `/Users/manuelmauro/Workspace/moonbeam/runtime/*/tests/integration_test.rs`
  - Test `verify_normal_filter_allow_pure_proxy` verifies `kill_pure` is allowed
  - No tests currently verify event emission

## Required Actions

### 1. TypeScript Bindings Regeneration (REQUIRED)

**Priority:** High
**Timeline:** During stable2506 upgrade

After upgrading to stable2506, regenerate TypeScript API bindings to include the new `PureKilled` event:

```bash
cd /Users/manuelmauro/Workspace/moonbeam
pnpm i
pnpm build
```

This will ensure the TypeScript API includes type definitions for:
```typescript
PureKilled: AugmentedEvent<ApiType, [
  pure: AccountId20,
  spawner: AccountId20,
  proxyType: ProxyType,
  disambiguationIndex: u16
]>
```

### 2. Event Monitoring/Indexing (OPTIONAL)

**Priority:** Low
**Timeline:** Post-upgrade

If Moonbeam operates any monitoring systems, indexers, or analytics tools that track proxy-related events, consider:
- Adding `PureKilled` event to monitoring dashboards
- Updating indexers to capture pure proxy deletion events
- Enhancing analytics to track the full lifecycle of pure proxies (creation via `PureCreated` + deletion via `PureKilled`)

### 3. Test Coverage Enhancement (OPTIONAL)

**Priority:** Low
**Timeline:** Post-upgrade

Consider adding integration tests to verify the `PureKilled` event is properly emitted:

```rust
// Example test pattern (in runtime/*/tests/integration_test.rs)
#[test]
fn verify_pure_killed_event() {
    ExtBuilder::default().build().execute_with(|| {
        // Create pure proxy
        assert_ok!(Proxy::create_pure(origin, ProxyType::Any, 0, 0));

        // Kill pure proxy
        assert_ok!(Proxy::kill_pure(origin, spawner, ProxyType::Any, 0, height, ext_index));

        // Verify PureKilled event
        System::assert_last_event(Event::Proxy(pallet_proxy::Event::PureKilled {
            pure: /* ... */,
            spawner: /* ... */,
            proxy_type: ProxyType::Any,
            disambiguation_index: 0,
        }));
    });
}
```

### 4. Documentation Updates (OPTIONAL)

**Priority:** Low
**Timeline:** Post-upgrade

If Moonbeam maintains documentation about proxy functionality, consider:
- Documenting the new `PureKilled` event
- Updating event reference documentation
- Adding examples of monitoring pure proxy lifecycle events

## Migration Considerations

**No runtime migration required.** This change only adds a new event variant and does not affect storage, state, or existing logic.

## Testing Strategy

### Pre-Upgrade Testing
1. Verify existing proxy functionality works on stable2503
2. Test `create_pure` and `kill_pure` calls work as expected

### Post-Upgrade Testing
1. Verify TypeScript bindings include `PureKilled` event type
2. Call `kill_pure` via polkadotJs and verify event is emitted
3. Check event structure matches expected format:
   ```javascript
   {
     pure: AccountId20,
     spawner: AccountId20,
     proxyType: ProxyType,
     disambiguationIndex: u16
   }
   ```

## Risk Assessment

**Risk Level:** **LOW**

### Justification
- **Backward compatible:** New event does not break existing functionality
- **No state changes:** No storage migrations or state modifications
- **Limited scope:** Only affects event emission in a single extrinsic
- **Well-tested:** PR includes comprehensive unit tests
- **No precompile exposure:** Change does not affect EVM interface

### Potential Issues
1. **TypeScript API out of sync:** If bindings aren't regenerated, TypeScript code won't have types for `PureKilled`
   - **Mitigation:** Include binding regeneration in upgrade checklist
   - **Impact:** Type errors in TypeScript, but runtime functionality unaffected

2. **Event monitoring gaps:** Monitoring systems may not capture the new event
   - **Mitigation:** Review and update monitoring configurations
   - **Impact:** Low - monitoring gap only, no functional impact

## Dependencies and Related PRs

No direct dependencies identified. This is a standalone enhancement to pallet-proxy.

## References

- **PR Discussion:** https://github.com/paritytech/polkadot-sdk/pull/7995
- **Pallet Proxy Docs:** https://paritytech.github.io/polkadot-sdk/master/pallet_proxy/
- **Moonbeam Proxy Integration:** Commit [33724e08b8](https://github.com/moonbeam-foundation/moonbeam/commit/33724e08b8414a1145d3ae3c7bdb61dbfb869204)
- **Current Moonbeam Version:** moonbeam-polkadot-stable2503
- **Target Version:** moonbeam-polkadot-stable2506

## Conclusion

PR #7995 is a low-risk, backward-compatible enhancement that improves observability of pure proxy management. Moonbeam will automatically inherit this change when upgrading to stable2506. The primary action item is regenerating TypeScript bindings to ensure type safety. No runtime migrations or code changes are required.

**Recommendation:** Proceed with upgrade. Include TypeScript binding regeneration in the standard upgrade process.
