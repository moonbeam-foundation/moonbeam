# PR #8102: Make min_peers_to_start_warp_sync configurable

## Overview
- **PR**: [#8102](https://github.com/paritytech/polkadot-sdk/pull/8102)
- **Title**: Make min_peers_to_start_warp_sync configurable
- **Audience**: Node Dev
- **Labels**: T0-node

## Summary
This PR makes the `min_peers_to_start_warp_sync` parameter configurable instead of using a hardcoded constant. Previously, this value was fixed, requiring developers to override the constant directly when customization was needed. The change is particularly beneficial for parachains, which only need 1 peer to start warp sync because they download the target block from the relay chain.

## Changes

### Affected Crates
- `sc-cli` (minor bump)
- `sc-network` (major bump)
- `sc-network-sync` (major bump)
- `sc-service` (minor bump)
- `cumulus-client-service` (minor bump)

### Technical Implementation
- Converted `MIN_PEERS_TO_START_WARP_SYNC` from a compile-time constant to an optional runtime-configurable field
- The `cumulus_client_service::prepare_node_config` function now automatically sets this value to 1 for parachains
- Maintains backward compatibility by preserving original defaults for non-parachain nodes

## Impact on Moonbeam

### Current State
Moonbeam uses `cumulus_client_service::prepare_node_config` in its parachain service initialization:

**Location**: `/Users/manuelmauro/Workspace/moonbeam/node/service/src/lib.rs:686`
```rust
let mut parachain_config = prepare_node_config(parachain_config);
```

Currently, Moonbeam explicitly sets `warp_sync_config: None` when building the network:
- Line 1192 in `/Users/manuelmauro/Workspace/moonbeam/node/service/src/lib.rs`
- Line 447 in `/Users/manuelmauro/Workspace/moonbeam/node/service/src/lazy_loading/mod.rs`

### Impact Assessment

**Impact Level**: LOW - Automatic Improvement

**Benefits**:
1. **Faster Sync Times**: Moonbeam will be able to start warp sync with only 1 peer instead of waiting for multiple peers
2. **Zero Code Changes Required**: The improvement happens automatically through `cumulus_client_service::prepare_node_config`
3. **Better Node Startup Experience**: Reduces the time nodes spend waiting for peers before beginning synchronization

**Why This Matters for Moonbeam**:
- As a parachain, Moonbeam gets its sync target from the relay chain (Polkadot), making multiple peers unnecessary for verifying the warp sync target
- This was a common pain point where parachain nodes would delay sync unnecessarily while waiting for additional peers
- The change allows nodes to start syncing more quickly while maintaining security guarantees

### Required Actions

**No action required**. This is an automatic improvement that Moonbeam will receive through the Cumulus framework.

### Breaking Changes

None. The PR maintains full backward compatibility:
- Default behavior is preserved for non-parachain nodes
- Parachains automatically get the optimized setting through `prepare_node_config`
- No API changes visible to Moonbeam's code

### Migration Notes

No migration needed. The change is transparent to Moonbeam's codebase.

## Testing Recommendations

While no code changes are required, consider testing:

1. **Sync Performance**: Monitor how quickly new nodes can start warp sync after this upgrade
2. **Single Peer Scenarios**: Test node startup with minimal peer connectivity to verify the reduced peer requirement works as expected
3. **Network Health**: Ensure that reduced peer requirements don't negatively impact network stability

## Verification Points

To verify this change is working after upgrade:
1. Check node logs during startup - should see warp sync starting with fewer peer requirements
2. Monitor time-to-first-sync for new nodes
3. Verify that nodes can successfully complete warp sync with just a single peer connection

## Related Configuration

Current network configuration in Moonbeam explicitly disables warp sync:
```rust
warp_sync_config: None,
```

This setting (`None`) is appropriate as Moonbeam doesn't currently enable warp sync. If Moonbeam decides to enable warp sync in the future, this PR ensures the peer requirement will be automatically optimized for parachain operation.

## Conclusion

**Verdict**: BENEFICIAL - No Action Required

This PR provides an automatic performance improvement for Moonbeam as a parachain. The change is handled transparently by the Cumulus framework through `prepare_node_config`, requiring no modifications to Moonbeam's codebase. When and if Moonbeam enables warp sync, it will automatically benefit from the optimized peer requirements.

The change improves the node operator experience by reducing unnecessary wait times during sync initialization, while maintaining all security guarantees appropriate for parachain operation.
