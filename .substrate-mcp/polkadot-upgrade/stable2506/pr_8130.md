# PR #8130: rpc v2: move archive MethodResult to the archive mod

## PR Information

- **PR Number**: #8130
- **Title**: rpc v2: move archive MethodResult to the archive mod
- **URL**: https://github.com/paritytech/polkadot-sdk/pull/8130
- **Status**: Merged (April 7, 2025)
- **Audience**: Node Dev
- **Affected Crates**:
  - `sc-rpc-spec-v2` (major bump)

## Impact Assessment

### Initial Sentiment: OPTIONAL

**Confidence: HIGH**

This PR represents a purely internal refactoring of the `sc-rpc-spec-v2` crate with no impact on Moonbeam's functionality or codebase.

### Rationale

1. **No Direct Usage**: Moonbeam does not directly depend on `sc-rpc-spec-v2` in any Cargo.toml files
2. **Transitive Dependency Only**: The crate is only present as a transitive dependency through `sc-service`
3. **Archive RPC Not Used**: Moonbeam does not use the archive RPC v2 methods that this PR modifies
4. **Internal Refactoring**: The changes are limited to moving type definitions within the crate's internal structure

## Analysis

### What Changed

This PR reorganizes code within the `sc-rpc-spec-v2` crate by:
- Moving `MethodResult`, `MethodResultOk`, and `MethodResultErr` types from the library root (`lib.rs`) to a new `archive/types.rs` module
- Updating import statements across the archive module to reference the new location
- Creating a dedicated types module within the archive submodule for better code organization

**Technical Details:**
- Added: `substrate/client/rpc-spec-v2/src/archive/types.rs` (+90 lines)
- Modified: `substrate/client/rpc-spec-v2/src/lib.rs` (-72 lines)
- Updated imports in:
  - `archive/api.rs`
  - `archive/archive.rs`
  - `archive/mod.rs`
  - `archive/tests.rs`

### Moonbeam's RPC Architecture

Moonbeam uses a different RPC stack focused on Ethereum compatibility:
- **Ethereum RPC**: `fc-rpc` (Eth, EthFilter, EthPubSub, Net, Web3, TxPool)
- **Ethereum RPC v2**: `fc-rpc-v2-api` (NOT `sc-rpc-spec-v2`) used in lazy_loading feature
- **Substrate RPC**: `substrate-frame-rpc-system` (System, TransactionPayment)
- **Custom Moonbeam RPC**: Debug, Trace, MoonbeamFinality, DevRpc

**Evidence from codebase:**
```rust
// From node/service/src/rpc.rs
io.merge(System::new(Arc::clone(&client), Arc::clone(&pool)).into_rpc())?;
io.merge(TransactionPayment::new(Arc::clone(&client)).into_rpc())?;
io.merge(Eth::<_, _, _, _, _, _, MoonbeamEthConfig<_, _>>::new(...).into_rpc())?;
// No archive RPC v2 initialization
```

### Dependency Analysis

```
sc-rpc-spec-v2
└── sc-service
    ├── cumulus-client-cli
    ├── cumulus-client-service
    ├── cumulus-relay-chain-minimal-node
    ├── fc-rpc
    └── [other substrate/polkadot components]
```

The crate is present in Moonbeam's dependency tree but:
1. Not directly imported by any Moonbeam code
2. Archive RPC methods never initialized in node setup
3. Types being moved are archive-specific and unused by Moonbeam

### Breaking Change Assessment

While the crate received a **major version bump**, this is a breaking change only for code that:
- Directly imports these types from `sc_rpc_spec_v2::{MethodResult, MethodResultOk, MethodResultErr}`
- Would need to change imports to `sc_rpc_spec_v2::archive::types::{...}`

**Moonbeam is unaffected because:**
- No Moonbeam code imports these types (verified via grep)
- No usage of archive RPC methods in any Moonbeam files
- The functionality provided by archive RPC is not utilized

## Evidence & References

### Search Results

1. **Direct dependency check**:
   ```bash
   grep -r "sc-rpc-spec-v2" **/Cargo.toml
   # Result: No matches (not a direct dependency)
   ```

2. **Type usage check**:
   ```bash
   grep -r "MethodResult|MethodResultOk|MethodResultErr"
   # Result: Only found in TRACKING.md (our analysis files)
   ```

3. **Archive RPC usage check**:
   ```bash
   grep -ri "archive.*rpc|archive_unstable|rpc.*archive"
   # Result: No usage in Moonbeam codebase
   ```

4. **Dependency tree verification**:
   ```bash
   cargo tree -i sc-rpc-spec-v2
   # Result: Transitive dependency only through sc-service
   ```

### Key Files Examined

- `/Users/manuelmauro/Workspace/moonbeam/node/service/src/rpc.rs` - No archive RPC initialization
- `/Users/manuelmauro/Workspace/moonbeam/node/service/src/lazy_loading/rpc_client.rs` - Uses `fc-rpc-v2-api`, not `sc-rpc-spec-v2`
- `/Users/manuelmauro/Workspace/moonbeam/node/service/Cargo.toml` - No direct dependency on `sc-rpc-spec-v2`

### Conclusion

This PR has **ZERO impact** on Moonbeam. It is a purely cosmetic internal refactoring of a crate that Moonbeam does not actively use. No action is required for this change, and it can be safely ignored in the upgrade process.

The major version bump is appropriate for the ecosystem (breaking API change for direct consumers) but does not affect Moonbeam as a transitive consumer that doesn't use the affected functionality.
