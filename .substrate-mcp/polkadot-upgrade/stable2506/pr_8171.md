# PR #8171 Impact Analysis: Add vested transfer event emission

## Executive Summary

**Impact Level: NONE**

PR #8171 adds a new `VestingCreated` event to `pallet-vesting` and emits it during vested transfer operations. This change has **NO IMPACT** on Moonbeam because Moonbeam does not use `pallet-vesting` in any of its runtimes.

## PR Overview

- **Title**: Add vested transfer event emission
- **GitHub URL**: https://github.com/paritytech/polkadot-sdk/pull/8171
- **Labels**: T2-pallets
- **Pallet**: pallet-vesting
- **Version Bump**: major
- **Status**: Merged on April 17, 2025

### Changes Summary

1. Added new `VestingCreated` event to `pallet-vesting`
2. Event emitted on `vested_transfer` and `force_vested_transfer` extrinsics
3. Event structure: `VestingCreated { account: T::AccountId, schedule_index: u32 }`
4. Minor documentation fixes and test enhancements

## Moonbeam Codebase Analysis

### Runtime Configuration

Examined all three Moonbeam runtime variants:
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/src/lib.rs`
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbeam/src/lib.rs`
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonriver/src/lib.rs`

**Finding**: `pallet-vesting` is NOT included in the `construct_runtime!` macro for any runtime.

### Dependency Analysis

**Direct Dependencies**: None
- `pallet-vesting` does not appear in any runtime Cargo.toml files

**Transitive Dependencies**: Yes (but unused)
- `pallet-vesting` appears in Cargo.lock only as a transitive dependency of:
  - `polkadot-runtime-common`
  - `rococo-runtime`
  - `westend-runtime`

These are relay chain runtimes from Polkadot SDK, not Moonbeam's own code.

### Code Usage Analysis

Searched entire Moonbeam codebase for `pallet-vesting` references:

```bash
# No direct imports
grep -r "use.*pallet_vesting" => No results

# No function calls
grep -r "pallet_vesting::" => No results

# Only Cargo.lock references (transitive dependencies)
grep -r "pallet-vesting" => Found only in Cargo.lock
```

**Conclusion**: Moonbeam does not use `pallet-vesting` anywhere.

### Vesting Implementation in Moonbeam

Moonbeam has its own vesting implementation in `pallet-crowdloan-rewards`:

**File**: `/Users/manuelmauro/Workspace/moonbeam/pallets/crowdloan-rewards/src/lib.rs`

```rust
// From pallet_crowdloan_rewards::Config
type VestingBlockNumber: AtLeast32BitUnsigned + Parameter + Default + ...;
type VestingBlockProvider: BlockNumberProvider<BlockNumber = Self::VestingBlockNumber>;
```

This vesting logic is:
1. **Independent** from `pallet-vesting`
2. **Custom implementation** for crowdloan reward distribution
3. **Uses relay chain block numbers** for vesting periods
4. **Configured in all runtimes** (moonbase, moonbeam, moonriver)

Example from runtime configuration:

```rust
// runtime/moonbase/src/lib.rs:929-930
impl pallet_crowdloan_rewards::Config for Runtime {
    // ... other config ...
    type VestingBlockNumber = relay_chain::BlockNumber;
    type VestingBlockProvider = RelaychainDataProvider<Self>;
    // ... other config ...
}
```

## Impact Assessment

### 1. Runtime Impact
**Level**: None

- Moonbeam does not include `pallet-vesting` in its runtime
- No storage migrations required
- No extrinsic changes
- No event subscriptions affected

### 2. Client Impact
**Level**: None

- No RPC changes related to vesting
- No client-side event parsing for `pallet-vesting` events
- Moonbeam's custom vesting in `pallet-crowdloan-rewards` is unaffected

### 3. Testing Impact
**Level**: None

- No test code uses `pallet-vesting`
- Mock runtimes do not include `pallet-vesting`
- XCM mock runtimes (relay_chain.rs, parachain.rs, etc.) may transitively include it but don't interact with vesting functionality

### 4. Documentation Impact
**Level**: None

- No user-facing documentation references standard vesting pallet
- Crowdloan rewards documentation is separate and unaffected

## Technical Details

### Event Structure (for reference only)

The new `VestingCreated` event added by this PR:

```rust
VestingCreated {
    account: T::AccountId,
    schedule_index: u32
}
```

This event is emitted when:
- `vested_transfer` extrinsic is called
- `force_vested_transfer` extrinsic is called

### Files Modified in PR #8171

1. `substrate/frame/vesting/src/lib.rs` - Added event definition and emission
2. `substrate/frame/vesting/src/tests.rs` - Added event verification tests
3. `substrate/frame/vesting/src/mock.rs` - Added test helpers
4. `substrate/frame/staking/src/pallet/mod.rs` - Minor doc fix (unrelated)
5. `prdoc/pr_8171.prdoc` - PR documentation

## Recommendations

### Required Actions
**NONE** - No changes needed to Moonbeam codebase.

### Optional Considerations
1. **Documentation**: Consider documenting that Moonbeam uses a custom vesting implementation (`pallet-crowdloan-rewards`) rather than the standard `pallet-vesting`
2. **Future Reference**: If Moonbeam ever considers adding standard vesting functionality, this event will already be available in the SDK

## Verification Evidence

### Search Results Summary

| Search Pattern | Location | Results |
|----------------|----------|---------|
| `pallet-vesting` in Cargo.toml | All runtime directories | 0 direct dependencies |
| `Vesting` in construct_runtime! | All runtime lib.rs files | 0 occurrences |
| `use pallet_vesting` | Entire codebase | 0 imports |
| `pallet_vesting::` | Entire codebase | 0 function calls |
| `VestingBlockNumber` config | Runtime configurations | Only in `pallet_crowdloan_rewards::Config` |

### Runtime Pallets (Moonbase Example)

The complete list of pallets in `construct_runtime!` for moonbase-runtime includes:
- System, Utility, Timestamp, Balances, Sudo
- ParachainSystem, ParachainInfo, TransactionPayment
- EthereumChainId, EVM, Ethereum
- ParachainStaking, Scheduler, Treasury
- AuthorInherent, AuthorFilter, AuthorMapping
- CrowdloanRewards (with custom vesting)
- Proxy, MaintenanceMode, Identity
- XcmpQueue, CumulusXcm, PolkadotXcm, XcmTransactor
- EthereumXcm, Randomness, ConvictionVoting, Referenda
- And 20+ other pallets...

**Notable Absence**: `pallet-vesting` is NOT in this list.

## Conclusion

PR #8171 has **zero impact** on Moonbeam. The changes are isolated to `pallet-vesting`, which is not used by any Moonbeam runtime. Moonbeam's vesting functionality is implemented through the custom `pallet-crowdloan-rewards` pallet, which is independent from the Substrate vesting pallet and remains unaffected by this change.

No action is required from the Moonbeam team regarding this PR.
