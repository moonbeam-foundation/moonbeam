# PR #8271 Analysis: Snowbridge - Message Reward Topups

## PR Summary

**Title:** Snowbridge - Message reward topups

**Link:** https://github.com/paritytech/polkadot-sdk/pull/8271

**Status:** Merged (May 15, 2025)

**Description:**
This PR enables the ability to add tips to Inbound or Outbound messages in Snowbridge when relayer rewards are too low and not profitable to process. The tip is added to the relayer reward when processing a message. If a tip is added to an already-processed message, it goes into `LostTips` storage in the EthereumSystemV2 pallet for future refunding.

## Changes Overview

### Modified Crates
- `snowbridge-pallet-inbound-queue-v2` (minor bump)
- `snowbridge-pallet-outbound-queue-v2` (minor bump)
- `snowbridge-pallet-system-frontend` (major bump)
- `snowbridge-pallet-system-v2` (major bump)
- `snowbridge-core` (minor bump)
- `snowbridge-test-utils` (minor bump)
- `bridge-hub-westend-integration-tests` (patch bump)
- `asset-hub-westend-runtime` (minor bump)
- `bridge-hub-westend-runtime` (minor bump)

### Key Changes
1. **snowbridge-pallet-system-frontend:** Introduces an `add_tip` extrinsic allowing users to specify tip amounts and message nonces. Non-ether assets are swapped for ether, then burnt from the sender's account. An XCM is sent from Asset Hub to Bridge Hub.

2. **snowbridge-pallet-system-v2:** Adds the tip to relevant Inbound/Outbound storage.

3. **snowbridge-core:** Added reward/tip primitives in `primitives/core/src/reward.rs`

### Files Changed
All changes are confined to Snowbridge-specific code:
- Snowbridge pallets: inbound-queue-v2, outbound-queue-v2, system-frontend, system-v2
- Snowbridge primitives and test utilities
- Westend runtime integration tests
- Asset Hub Westend and Bridge Hub Westend runtime configurations

## Moonbeam Impact Analysis

### Current Moonbeam Usage

**Bridge Infrastructure:**
Moonbeam uses traditional Substrate-to-Substrate bridge pallets for the Moonbeam↔Moonriver bridge:
- `pallet_bridge_grandpa` - Track relay chain headers
- `pallet_bridge_parachains` - Track parachain headers
- `pallet_bridge_messages` - Handle cross-chain messages
- `pallet_xcm_bridge` - XCM integration for bridges

**Snowbridge Dependency:**
- Moonbeam has an indirect dependency on `snowbridge-core` through `bridge-hub-common`
- The only use of `bridge-hub-common` in Moonbeam is:
  ```rust
  use bridge_hub_common::xcm_version::XcmVersionOfDestAndRemoteBridge;
  ```
  (Found in both `/runtime/moonbeam/src/bridge_config.rs` and `/runtime/moonriver/src/bridge_config.rs`)

**No Direct Snowbridge Usage:**
- No Snowbridge pallets are configured in any Moonbeam runtime
- `cargo tree` confirms none of the modified Snowbridge pallets are in Moonbeam's dependency tree
- No Snowbridge-related code in runtime configurations

### Breaking Changes

None applicable to Moonbeam. The major version bump for `snowbridge-pallet-system-frontend` and `snowbridge-pallet-system-v2` only affects runtimes that directly use these pallets (Asset Hub Westend, Bridge Hub Westend).

### Migration Requirements

None. The changes are entirely within Snowbridge pallets that Moonbeam does not use.

### Impact Assessment: **INHERITED**

**Rationale:**
1. **No Direct Usage:** Moonbeam does not use any Snowbridge pallets (inbound-queue-v2, outbound-queue-v2, system-frontend, system-v2)
2. **Indirect Dependency Only:** The dependency on `snowbridge-core` comes through `bridge-hub-common`, which is NOT modified by this PR
3. **Isolated Changes:** All changes are confined to Snowbridge-specific pallets and Westend test runtimes
4. **No API Impact:** The `XcmVersionOfDestAndRemoteBridge` utility from `bridge-hub-common` that Moonbeam uses is unaffected
5. **Different Bridge System:** Moonbeam uses standard Substrate bridge pallets for Moonbeam↔Moonriver bridging, while Snowbridge is an Ethereum↔Polkadot bridge system

### Recommendation

**No action required.** This change will be inherited through the Polkadot SDK version upgrade but requires no code changes, configuration updates, or migrations in the Moonbeam codebase.

### Notes

- Snowbridge is primarily used for Ethereum↔Polkadot bridging on Westend/Polkadot
- Moonbeam's bridge infrastructure is architecturally separate and uses different pallets
- The indirect dependency on `snowbridge-core` is minimal and not affected by this PR's changes
