# PR #8314: Add RPCs in the statement store to get the statements and not just the statement data

## Overview

**PR Link:** https://github.com/paritytech/polkadot-sdk/pull/8314

**Audience:** Node Dev, Runtime Dev

**Status:** Merged on May 5, 2025

## Summary

This PR adds new RPC methods to the statement store that return complete statements including proofs and signatures, rather than just the statement data. This allows clients to verify that statements originate from expected accounts without requiring double-signing.

## Changes

### New RPC Methods
- `broadcasts_stmt` - Get full broadcast statements with proofs
- `posted_stmt` - Get full posted statements with proofs
- `posted_clear_stmt` - Get full cleared posted statements with proofs

These complement the existing methods that only returned statement data.

### Rationale
- Statements contain proofs with signatures that verify the statement's origin
- Embedding signatures within encrypted data would require double-signing
- Clients can now reuse topics and channel information instead of duplicating IDs in data fields
- Enables proper verification of statement authenticity

### Technical Context
The statement store is an off-chain feature used primarily for relay chain validator communication. It doesn't require light client support as it cannot be proven by blockchain headers.

## Crate Changes

| Crate | Version Bump | Impact |
|-------|-------------|---------|
| `sc-rpc-api` | Major | Breaking API changes |
| `sc-rpc` | Major | Breaking API changes |
| `sc-statement-store` | Major | New RPC methods added |
| `sp-statement-store` | Major | Primitive changes |

## Impact on Moonbeam

### Direct Impact: **NONE**

**Reasoning:**

1. **No Statement Store Usage**
   - Moonbeam does not directly use statement store functionality
   - Statement store is primarily for relay chain validator communication
   - As a parachain, Moonbeam doesn't require these features

2. **Limited sc-rpc Usage**
   - Moonbeam only imports `sc_rpc::SubscriptionTaskExecutor` (see `/Users/manuelmauro/Workspace/moonbeam/node/service/src/rpc.rs:47`)
   - This is a basic type for RPC subscription management
   - The breaking changes are isolated to statement store RPC methods
   - `SubscriptionTaskExecutor` is unlikely to be affected by statement store additions

3. **No sc-rpc-api Direct Usage**
   - Moonbeam does not directly depend on `sc-rpc-api`
   - It's only a transitive dependency through `sc-rpc`

4. **No sp-statement-store Usage**
   - Moonbeam does not use statement store primitives
   - Only appears in `Cargo.lock` as a transitive dependency

### Compilation Impact: **LOW**

The major version bumps will require updating workspace dependencies, but no code changes are expected in Moonbeam since:
- The breaking changes are specific to statement store APIs
- Moonbeam's limited usage of `sc-rpc` is for basic types not related to statement store

### Testing Requirements: **MINIMAL**

**Recommended Tests:**
- Verify node compilation after dependency update
- Basic smoke test to ensure RPC functionality is unaffected
- No new functional tests required (feature not used)

## Action Items

### Required
- [ ] Update workspace dependencies for `sc-rpc`, `sc-rpc-api`, `sc-statement-store`, `sp-statement-store`
- [ ] Verify compilation succeeds
- [ ] Run basic smoke tests for RPC functionality

### Not Required
- No code changes needed
- No new tests needed
- No runtime changes needed

## Migration Guide

**For Moonbeam:** No migration needed. Simply update dependencies in workspace `Cargo.toml`.

## References

- **PRDoc:** `/Users/manuelmauro/.substrate-mcp/moonbeam/releases/stable2506/pr-docs/pr_8314.prdoc`
- **Moonbeam RPC Usage:** `/Users/manuelmauro/Workspace/moonbeam/node/service/src/rpc.rs`
- **Moonbeam Service Dependencies:** `/Users/manuelmauro/Workspace/moonbeam/node/service/Cargo.toml`

## Risk Assessment

**Risk Level:** **VERY LOW**

**Justification:**
- Changes are isolated to unused statement store functionality
- Minimal surface area for potential issues
- Moonbeam's RPC implementation is independent of statement store
- Breaking changes don't affect commonly used APIs

## Conclusion

PR #8314 adds new statement store RPC methods that are not relevant to Moonbeam's operation as an Ethereum-compatible parachain. While the changes introduce major version bumps in several crates, Moonbeam's minimal usage of these crates means no code changes are required. The upgrade is straightforward dependency version update with very low risk.
