# PR #8327: Update to frame-metadata 22

**Impact**: INHERITED
**Confidence**: High
**Affected Components**: Runtime metadata generation (all three runtimes)

## Changes Detected

PR #8327 updates frame-metadata from v20 to v22, which brings the latest unstable V16 metadata format. The key change is:

- **Removed**: Ability to deprecate entire Call/Error/Event enums
- **Retained**: Ability to deprecate individual enum variants
- **Breaking Change**: Major version bumps for `sp-metadata-ir`, `frame-support`, `frame-support-procedural`, and `sp-api-proc-macro`

The rationale is that deprecating entire enums is unlikely and has no clear place for warnings in client-side tooling, so this simplifies the metadata format.

## Project Impact

**No code changes required** - Moonbeam does not use enum-level deprecation attributes on its custom pallets or anywhere else in the codebase.

### Evidence from Moonbeam Codebase

**Current frame-metadata version**:
- `/Users/manuelmauro/Workspace/moonbeam/Cargo.toml:358` shows `frame-metadata = { version = "20.0.0", default-features = false, features = ["current"] }`
- This will be automatically updated to v22 when upgrading to stable2506

**Deprecation Usage Analysis**:
1. Only one deprecation attribute found in the entire codebase:
   - `/Users/manuelmauro/Workspace/moonbeam/pallets/parachain-staking/src/types.rs:1115`: `#[deprecated(note = "must only be used for backwards compatibility reasons")]`
   - This is on a struct field/function, NOT on an enum

2. **All custom pallet Event enums** have NO deprecation attributes at the enum level:
   - `/Users/manuelmauro/Workspace/moonbeam/pallets/parachain-staking/src/lib.rs:264`: `pub enum Event<T: Config>`
   - `/Users/manuelmauro/Workspace/moonbeam/pallets/crowdloan-rewards/src/lib.rs:766`: `pub enum Event<T: Config>`
   - `/Users/manuelmauro/Workspace/moonbeam/pallets/moonbeam-foreign-assets/src/lib.rs:278`: `pub enum Event<T: Config>`
   - `/Users/manuelmauro/Workspace/moonbeam/pallets/moonbeam-orbiters/src/lib.rs:230`: `pub enum Event<T: Config>`
   - `/Users/manuelmauro/Workspace/moonbeam/pallets/xcm-transactor/src/lib.rs:402`: `pub enum Event<T: Config>`
   - `/Users/manuelmauro/Workspace/moonbeam/pallets/xcm-weight-trader/src/lib.rs:140`: `pub enum Event<T: Config>`
   - `/Users/manuelmauro/Workspace/moonbeam/pallets/ethereum-xcm/src/lib.rs:170`: `pub enum Event<T>`

3. **All custom pallet Error enums** have NO deprecation attributes at the enum level:
   - `/Users/manuelmauro/Workspace/moonbeam/pallets/parachain-staking/src/lib.rs:204`: `pub enum Error<T>`
   - `/Users/manuelmauro/Workspace/moonbeam/pallets/crowdloan-rewards/src/lib.rs:602`: `pub enum Error<T>`
   - `/Users/manuelmauro/Workspace/moonbeam/pallets/moonbeam-foreign-assets/src/lib.rs:252`: `pub enum Error<T>`
   - `/Users/manuelmauro/Workspace/moonbeam/pallets/moonbeam-orbiters/src/lib.rs:206`: `pub enum Error<T>`
   - `/Users/manuelmauro/Workspace/moonbeam/pallets/xcm-transactor/src/lib.rs:370`: `pub enum Error<T>`
   - `/Users/manuelmauro/Workspace/moonbeam/pallets/xcm-weight-trader/src/lib.rs:121`: `pub enum Error<T>`
   - `/Users/manuelmauro/Workspace/moonbeam/pallets/ethereum-xcm/src/lib.rs:163`: `pub enum Error<T>`
   - `/Users/manuelmauro/Workspace/moonbeam/pallets/moonbeam-lazy-migrations/src/lib.rs:60`: `pub enum Error<T>`
   - `/Users/manuelmauro/Workspace/moonbeam/pallets/precompile-benchmarks/src/lib.rs:50`: `pub enum Error<T>`

### Runtime Impact

All three Moonbeam runtimes (moonbase, moonriver, moonbeam) will automatically inherit this change through the Polkadot SDK update:

- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/Cargo.toml:190`: Uses `frame-metadata` workspace dependency
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonriver/Cargo.toml:199`: Uses `frame-metadata` workspace dependency
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbeam/Cargo.toml:198`: Uses `frame-metadata` workspace dependency

All three runtimes also use `frame-metadata-hash-extension` from the upgraded polkadot-sdk branch.

## Evidence & References

### GitHub PR Details
- **PR**: https://github.com/paritytech/polkadot-sdk/pull/8327
- **Title**: Update to frame-metadata 22
- **Audience**: Runtime Dev
- **Crates affected**: sp-metadata-ir, frame-support, frame-support-procedural, sp-api-proc-macro (all major bumps)

### Search Results Summary
```bash
# Deprecation attributes in codebase
grep -r "#\[deprecated" /Users/manuelmauro/Workspace/moonbeam/pallets
# Result: Only 1 match on a struct field, not on enums

# All Event/Error/Call enum declarations checked
# Result: None have #[deprecated] attribute at enum level
```

## Conclusion

This change has **INHERITED** impact only. The metadata format update is automatically applied through the Polkadot SDK dependency upgrade. Since Moonbeam does not use enum-level deprecation attributes anywhere in its custom pallets, no migration or code changes are required. The change is fully backwards compatible for Moonbeam's usage patterns.

The frame-metadata version will be bumped from v20 to v22 in the workspace Cargo.toml as part of the overall stable2506 upgrade process, but this specific PR requires no Moonbeam-specific action.
