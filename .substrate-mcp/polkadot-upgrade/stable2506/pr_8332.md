# PR #8332: parachain informant

**Impact**: INHERITED
**Confidence**: High
**Affected Components**: cumulus-client-service, cumulus-relay-chain-interface, node service initialization

## Changes Detected

This PR adds a parachain informant to provide better debug logging and observability for parachain nodes. The main changes include:

1. **New Crate**: `cumulus-relay-chain-streams` (v0.2.0) - A new crate to make it easier to reuse relay chain event streams
2. **New Metrics**: Added two new parachain metrics:
   - `parachain_block_authorship_duration` - Tracks how long it takes to author blocks
   - `parachain_unincluded_segment_size` - Tracks the size of the unincluded segment
3. **Enhanced Logging**: Improved debug log output for relay chain and parachain block events
4. **Crate Updates**:
   - `cumulus-client-service`: MAJOR bump (breaking changes)
   - `cumulus-relay-chain-interface`: MAJOR bump (breaking changes)
   - `cumulus-client-consensus-common`: minor bump
   - `cumulus-client-pov-recovery`: minor bump
   - `cumulus-relay-chain-inprocess-interface`: minor bump
   - `cumulus-relay-chain-rpc-interface`: minor bump

## Project Impact

**No code changes required** - This is an INHERITED update. The changes are primarily internal improvements to the cumulus client infrastructure that Moonbeam depends on.

### Analysis:

1. **Dependency Usage** (verified in `/Users/manuelmauro/Workspace/moonbeam/node/service/Cargo.toml`):
   - Lines 119-125: Moonbeam uses `cumulus-client-service`, `cumulus-relay-chain-interface`, `cumulus-relay-chain-inprocess-interface`
   - The new `cumulus-relay-chain-streams` crate is now a transitive dependency

2. **Code Integration** (verified in `/Users/manuelmauro/Workspace/moonbeam/node/service/src/lib.rs`):
   - Line 33: Imports `start_relay_chain_tasks` and `StartRelayChainTasksParams` from `cumulus-client-service`
   - Line 41: Uses `cumulus-relay-chain-interface::{OverseerHandle, RelayChainInterface, RelayChainResult}`
   - Line 928-938: Calls `start_relay_chain_tasks(StartRelayChainTasksParams { ... })`

   The function signature and struct fields used by Moonbeam remain compatible. The informant functionality is initialized internally by `start_relay_chain_tasks`.

3. **Cargo.lock Status** (verified in `/Users/manuelmauro/Workspace/moonbeam/Cargo.lock`):
   - Line 3056-3059: `cumulus-relay-chain-streams` v0.2.0 is already present in the lockfile
   - Lines 2583, 2677, 2713: The new crate is included as a dependency of cumulus client crates
   - All dependencies are resolved from `moonbeam-polkadot-stable2506` branch

4. **Compilation Status**: `cargo check` for moonbeam-service proceeds without errors related to these changes

### Benefits to Moonbeam:

1. **Better Observability**: Automatic access to new metrics for monitoring block authorship performance and unincluded segment tracking
2. **Improved Debugging**: Enhanced log output will help diagnose relay chain and parachain block synchronization issues
3. **No Migration Required**: The changes are backwards compatible from the API consumer perspective

## Evidence & References

### Crate Dependencies
```toml
# /Users/manuelmauro/Workspace/moonbeam/node/service/Cargo.toml:113-125
# Cumulus / Nimbus
async-backing-primitives = { workspace = true }
cumulus-client-cli = { workspace = true }
cumulus-client-collator = { workspace = true }
cumulus-client-consensus-common = { workspace = true }
cumulus-client-consensus-proposer = { workspace = true }
cumulus-client-service = { workspace = true }
cumulus-primitives-core = { workspace = true }
cumulus-primitives-parachain-inherent = { workspace = true }
cumulus-client-parachain-inherent = { workspace = true }
cumulus-relay-chain-inprocess-interface = { workspace = true }
cumulus-relay-chain-interface = { workspace = true }
cumulus-relay-chain-minimal-node = { workspace = true }
```

### Code Usage
```rust
// /Users/manuelmauro/Workspace/moonbeam/node/service/src/lib.rs:32-34
use cumulus_client_service::{
	prepare_node_config, start_relay_chain_tasks, CollatorSybilResistance, DARecoveryProfile,
	ParachainHostFunctions, StartRelayChainTasksParams,
};

// /Users/manuelmauro/Workspace/moonbeam/node/service/src/lib.rs:41
use cumulus_relay_chain_interface::{OverseerHandle, RelayChainInterface, RelayChainResult};

// /Users/manuelmauro/Workspace/moonbeam/node/service/src/lib.rs:928-938
start_relay_chain_tasks(StartRelayChainTasksParams {
	client: client.clone(),
	announce_block: announce_block.clone(),
	para_id,
	relay_chain_interface: relay_chain_interface.clone(),
	task_manager: &mut task_manager,
	da_recovery_profile: if collator {
		DARecoveryProfile::Collator
	} else {
		DARecoveryProfile::FullNode
	},
});
```

### Audience
- **Node Operators**: Will benefit from the new metrics `parachain_block_authorship_duration` and `parachain_unincluded_segment_size` for monitoring
- **Node Developers**: Can utilize the new `cumulus-relay-chain-streams` crate if building custom relay chain integrations

## Conclusion

This PR represents infrastructure improvements to the Cumulus client stack that Moonbeam automatically inherits. The changes enhance observability and debugging capabilities without requiring any code modifications in Moonbeam. The node service code remains fully compatible, and the new metrics and logging features will be available once the updated dependencies are deployed.

**Recommended Action**: None required - changes are automatically inherited through dependency updates.
