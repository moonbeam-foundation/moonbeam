# PR #8337 Impact Analysis: Add Staking/Election Related View Functions

**PR:** [paritytech/polkadot-sdk#8337](https://github.com/paritytech/polkadot-sdk/pull/8337)
**Title:** add staking/election related view functions
**Impact Level:** NO IMPACT
**Analysis Date:** 2025-10-22

---

## Summary

PR #8337 adds read-only view functions to `pallet-bags-list` and `pallet-election-provider-multi-block` to assist wallets and staking miners. These changes have **NO IMPACT** on Moonbeam as neither pallet is used in Moonbeam's runtime or core functionality.

---

## PR Overview

### What Changed

- **Affected Pallets:**
  - `pallet-bags-list` (minor bump)
  - `pallet-election-provider-multi-block` (minor bump)

- **Type of Changes:**
  - Added view functions (read-only, non-breaking)
  - Patch version bump indicating no breaking changes

- **Purpose:**
  - Enable wallets to perform rebag operations
  - Allow staking miners to know deposit requirements in advance
  - Related to [polkadot-staking-miner issue #1030](https://github.com/paritytech/polkadot-staking-miner/issues/1030)

---

## Impact on Moonbeam

### Direct Impact: NONE

**Evidence:**

1. **Runtime Analysis:**
   - Searched all three Moonbeam runtimes (moonbase, moonbeam, moonriver)
   - Neither `pallet-bags-list` nor `pallet-election-provider-multi-block` appear in any runtime's `construct_runtime!` macro
   - Confirmed via grep: No matches for `BagsList` or `ElectionProvider` in runtime files

   ```bash
   # Verification commands (all returned no matches):
   rg "BagsList|ElectionProvider" runtime/moonbase/src/lib.rs
   rg "BagsList|ElectionProvider" runtime/moonbeam/src/lib.rs
   rg "BagsList|ElectionProvider" runtime/moonriver/src/lib.rs
   ```

2. **Dependency Analysis:**
   - `pallet-bags-list`: Present in dependency tree ONLY as transitive dependency
     - Path: `westend-runtime` → `moonbeam-relay-encoder` [dev-dependencies]
     - Used only in test/dev environments, not in production runtime

   - `pallet-election-provider-multi-block`: NOT in dependency tree at all
     - Confirmed via: `cargo tree -i pallet-election-provider-multi-block`
     - Result: "package ID specification did not match any packages"

3. **Relay Encoder Analysis:**
   - Moonbeam's relay-encoder (`/runtime/relay-encoder/`) encodes calls for relay chain staking
   - Dependencies in `/runtime/relay-encoder/Cargo.toml`:
     - Includes: `pallet-staking` ✓
     - Does NOT include: `pallet-bags-list` ✗
     - Does NOT include: `pallet-election-provider-multi-block` ✗

   - Available staking calls (from `/primitives/xcm/src/transactor_traits.rs`):
     ```rust
     pub enum AvailableStakeCalls {
         Bond,
         BondExtra,
         Unbond,
         WithdrawUnbonded,
         Validate,
         Nominate,
         Chill,
         SetPayee,
         SetController,
         Rebond,  // Note: This is pallet-staking::rebond, not bags-list::rebag
     }
     ```
   - No bags-list or election-provider functions are exposed

4. **Staking Architecture:**
   - Moonbeam uses custom `pallet-parachain-staking` for collator selection
   - Does NOT use Substrate's standard staking/election system
   - Relay chain staking interaction is ONLY through XCM calls encoded by relay-encoder
   - The view functions added in this PR are not called by any Moonbeam code

### Why No Impact?

1. **Read-Only Functions:** The PR only adds view functions (queries), not extrinsics
2. **Not Used:** Neither pallet is part of Moonbeam's runtime
3. **No Call Path:** Moonbeam has no code that would call these new functions
4. **Test-Only Dependency:** `pallet-bags-list` only exists as a dev dependency through westend-runtime for testing relay-encoder
5. **Architecture Difference:** Moonbeam's parachain staking model is fundamentally different from relay chain staking

---

## Files Analyzed

### Moonbeam Codebase
- `/runtime/moonbase/src/lib.rs` - Runtime configuration
- `/runtime/moonbeam/src/lib.rs` - Runtime configuration
- `/runtime/moonriver/src/lib.rs` - Runtime configuration
- `/runtime/relay-encoder/src/polkadot.rs` - Relay chain call encoding
- `/runtime/relay-encoder/src/kusama.rs` - Relay chain call encoding
- `/runtime/relay-encoder/src/westend.rs` - Relay chain call encoding
- `/runtime/relay-encoder/Cargo.toml` - Relay encoder dependencies
- `/primitives/xcm/src/transactor_traits.rs` - Available XCM staking calls
- `Cargo.lock` - Dependency tree analysis

### PRDoc
- `/Users/manuelmauro/.substrate-mcp/moonbeam/releases/stable2506/pr-docs/pr_8337.prdoc`

---

## Recommendations

### Required Actions: NONE

No action is required for this PR. The changes are:
- Additive (new functions only)
- Non-breaking (patch bump)
- Not used by Moonbeam
- Read-only (view functions)

### Optional Considerations

1. **Future Feature:** If Moonbeam ever wants to expose relay chain staking information to users (e.g., for remote staking via XCM), these view functions could be useful for querying information from the relay chain
2. **Monitoring:** No special monitoring needed as these functions are not used
3. **Testing:** No additional tests required as Moonbeam doesn't use these pallets

---

## Verification Commands

```bash
# Verify pallet-bags-list is not in runtime
rg "pallet.bags.list|BagsList" runtime/*/src/lib.rs

# Verify pallet-election-provider-multi-block is not in runtime
rg "election.provider.multi.block|ElectionProviderMultiBlock" runtime/*/src/lib.rs

# Check dependency tree for pallet-bags-list
cargo tree -i pallet-bags-list

# Check dependency tree for pallet-election-provider-multi-block
cargo tree -i pallet-election-provider-multi-block

# Verify available staking calls in XCM primitives
rg "pub enum AvailableStakeCalls" primitives/xcm/src/transactor_traits.rs -A 15
```

---

## Conclusion

PR #8337 has **NO IMPACT** on Moonbeam. The affected pallets (`pallet-bags-list` and `pallet-election-provider-multi-block`) are not used in Moonbeam's runtime or core functionality. The view functions added are for relay chain staking/election functionality that Moonbeam does not directly interact with.

**Status:** ✅ Safe to merge without any changes to Moonbeam codebase

---

## Additional Context

### Understanding the Architecture

**Moonbeam's Staking Model:**
- Uses `pallet-parachain-staking` for collator selection
- Operates as an Ethereum-compatible parachain
- Different from relay chain's validator/nominator model

**Relay Chain Interaction:**
- Moonbeam users CAN stake on relay chains (Polkadot/Kusama) via XCM
- This is done through `pallet-xcm-transactor` using encoded calls
- Only specific staking calls are supported (listed in `AvailableStakeCalls`)
- Bags-list and election-provider functions are NOT in this list

**Why pallet-bags-list Exists in Dependency Tree:**
- It's part of `westend-runtime` (the relay chain runtime)
- `westend-runtime` is a dev-dependency of `moonbeam-relay-encoder`
- Used for testing that encoded calls match the actual relay runtime
- Never executed on Moonbeam's own runtime

### View Functions Context

The PR adds view functions that would typically be called by:
- Wallet UIs to help users know if they need to rebag
- Staking miners to calculate required deposits
- External tools querying chain state

Since Moonbeam doesn't implement these pallets, there's no scenario where these functions would be called on a Moonbeam chain.
