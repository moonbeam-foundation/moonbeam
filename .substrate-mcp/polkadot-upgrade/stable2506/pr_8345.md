# PR #8345 Impact Analysis: Transaction Metrics for RPC v2

## PR Summary

**Title:** tx/metrics: Add metrics for the RPC v2 `transactionWatch_v1_submitAndWatch`

**Description:** This PR adds observability metrics for the Substrate RPC v2 `transactionWatch_v1_submitAndWatch` endpoint. The metrics track transaction lifecycle events and timing, helping operators monitor transaction progression through the pool with labeled histograms.

**Link:** https://github.com/paritytech/polkadot-sdk/pull/8345

## Changes Overview

### Affected Crates
- `sc-service` (major bump)
- `sc-rpc-spec-v2` (major bump)

### Breaking API Changes

#### sc-rpc-spec-v2
- **New Public Types:** `TransactionMetrics` struct exported from metrics module
- **New Public Method:** `TransactionEvent::is_final()` - Returns true for terminal transaction states
- **Modified Constructor:** `Transaction::new()` now requires an additional `metrics: Option<Metrics>` parameter (previously 3 parameters, now 4)

#### sc-service
- **Modified Function:** `gen_rpc_module()` function signature now includes `metrics: Option<TransactionMetrics>` parameter for RPC v2 metrics initialization

### Technical Details
The PR adds two types of metrics:
1. Simple counters tracking how many events have been seen globally
2. Histogram vectors measuring execution times between transaction state transitions (e.g., submitted → in-block, in-block → finalized)

## Impact on Moonbeam

### Assessment: NO IMPACT

**Rationale:**

1. **No Direct Usage of sc-rpc-spec-v2**
   - Moonbeam does not directly import or use `sc-rpc-spec-v2` anywhere in the codebase
   - The only reference to `sc-rpc-spec-v2` is as a transitive dependency in Cargo.lock

2. **No Usage of Affected sc-service Functions**
   - Moonbeam does not call `gen_rpc_module()` from sc-service
   - Moonbeam implements its own custom RPC module creation via `rpc::create_full()` in `/Users/manuelmauro/Workspace/moonbeam/node/service/src/rpc.rs`
   - Moonbeam only imports basic, unchanged types from sc-service: `TaskManager`, `ChainType`, `Configuration`, `PrometheusConfig`, etc.

3. **Different RPC Architecture**
   - Moonbeam uses Frontier's Ethereum-compatible RPC layer (fc-rpc, fc-rpc-v2-api)
   - The `fc-rpc-v2-api` dependency is for Frontier's Ethereum JSON-RPC v2 API (eth_*, net_*, web3_*), NOT Substrate's RPC spec v2
   - Moonbeam does not expose the Substrate RPC v2 `transactionWatch_v1_submitAndWatch` endpoint

4. **RPC Module Implementation**
   - Moonbeam's RPC setup in `node/service/src/rpc.rs` creates RPC modules using `RpcModule::new()` and manually merges:
     - Ethereum RPC endpoints (Eth, EthFilter, EthPubSub, Net, Web3, TxPool)
     - Custom Moonbeam endpoints (Debug, Trace, DevRpc, MoonbeamFinality)
     - Standard Substrate endpoints (System, TransactionPayment)
   - None of these use the changed sc-rpc-spec-v2 functionality

## Required Actions

**None** - This PR can be integrated as part of the normal Polkadot SDK dependency update without any code changes to Moonbeam.

## Verification

The following searches confirmed no usage of the affected APIs:
- ✓ No references to `gen_rpc_module` in node code
- ✓ No imports from `sc_rpc_spec_v2` or `sc-rpc-spec-v2`
- ✓ No usage of `transactionWatch` or RPC v2 spec endpoints
- ✓ Custom RPC implementation in `/Users/manuelmauro/Workspace/moonbeam/node/service/src/rpc.rs`

## Additional Notes

While this PR marks major version bumps for `sc-service` and `sc-rpc-spec-v2`, the changes are additive (new metrics functionality) rather than removing or modifying existing functionality that Moonbeam depends on. The breaking changes only affect code that:
1. Directly instantiates `Transaction` from sc-rpc-spec-v2
2. Calls `gen_rpc_module()` from sc-service

Neither of these apply to Moonbeam's architecture.
