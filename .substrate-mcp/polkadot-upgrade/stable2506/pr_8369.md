# PR #8369: Enhancements to macros for trusted teleporter scenarios

## Overview

**Title:** Sync xcm related test utils impls with runtimes repo
**GitHub:** https://github.com/paritytech/polkadot-sdk/pull/8369
**Audience:** Runtime Dev

## Summary

This PR synchronizes XCM-related test utility implementations from the Polkadot Fellows runtimes repository back into the main polkadot-sdk. The changes primarily focus on improving test infrastructure for trusted teleporter functionality between relay chains and parachains.

## Key Changes

### Test Utilities Enhanced

1. **Dry-run API Integration**
   - Updated `test_parachain_is_trusted_teleporter` to utilize dry-run API for accurate fee estimation
   - Modified `test_relay_is_trusted_teleporter` with dry-run capability
   - Enhanced `test_parachain_is_trusted_teleporter_for_relay` similarly

2. **Fee Estimation Improvements**
   - Refactored `ToParachainDeliveryHelper` to use `WithdrawAsset`-based worst-case fee estimation instead of `ClearOrigin`

### Macro Improvements

1. **Self-contained Macros**
   - Made test macros self-contained by fully qualifying all internal types using `$crate` paths
   - Removed unused `sender_xcm_config` parameter from public macro APIs

2. **Parameterization**
   - Added support for testing both `transfer_assets` and `limited_teleport_assets` extrinsics
   - Replaced hardcoded use of `limited_teleport_assets` with parameterized testing

3. **Visibility Changes**
   - Changed visibility from `pub` to `pub(crate)` for integration test helper types

### Test Coverage

- Introduced `transfer_assets` tests across all relevant chains
- Added manual weights for transfer_assets extrinsics in Rococo and Westend people chains
- Aligned related chains and crates to consistent structure

## Crates Affected

- **emulated-integration-tests-common**: major bump
- **polkadot-runtime-common**: patch bump

## Impact on Moonbeam

### Direct Impact: NONE

This PR is **test infrastructure only** and has **no impact on Moonbeam production code**.

### Analysis

1. **Test Utilities Not Used**
   - Moonbeam does not use `emulated-integration-tests-common` crate
   - The test macros (`test_parachain_is_trusted_teleporter`, `test_relay_is_trusted_teleporter`) are not present in Moonbeam's codebase
   - `ToParachainDeliveryHelper` is not used in Moonbeam

2. **polkadot-runtime-common Usage**
   - Moonbeam does depend on `polkadot-runtime-common`
   - Only uses `polkadot_runtime_common::xcm_sender::NoPriceForMessageDelivery` in XCM configuration
   - This is used in all three runtimes (moonbeam, moonriver, moonbase) for `PriceForSiblingDelivery`
   - The patch changes to `polkadot-runtime-common` are in test infrastructure and don't affect the `xcm_sender` module

3. **No Runtime Changes Required**
   - The changes are purely test infrastructure improvements
   - No changes to runtime logic, XCM configuration, or production code
   - No migration or upgrade work needed

## Recommendation

**Action Required:** NONE

This PR can be safely ignored for Moonbeam's upgrade planning. The improvements to test infrastructure and macros are valuable for the Polkadot SDK ecosystem but don't require any changes to Moonbeam's codebase.

## Technical Notes

- The dry-run API improvements could be useful reference for future Moonbeam test infrastructure enhancements
- The pattern of making macros self-contained with `$crate` paths is a good practice for macro design
- Moonbeam's XCM tests could potentially benefit from similar dry-run based fee verification in the future

## References

- **Crate Usage in Moonbeam:**
  - `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbeam/src/xcm_config.rs:410`
  - `/Users/manuelmauro/Workspace/moonbeam/runtime/moonriver/src/xcm_config.rs:418`
  - `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/src/xcm_config.rs:392`
