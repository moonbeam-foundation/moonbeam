# PR #8422 Analysis: Staking Async Fixes for XCM and Election Planning

**PR**: https://github.com/paritytech/polkadot-sdk/pull/8422
**Status**: Merged (May 30, 2025)
**Audience**: Runtime Developers
**Impact on Moonbeam**: âšª **NONE** - Not applicable to parachains

---

## Summary

This PR introduces several fixes and improvements to the `pallet-staking-async` ecosystem, which is used for relay chain and asset hub staking. The changes focus on XCM message validation, election planning mechanisms, and developer experience improvements.

## Key Changes

### 1. XCM Message Size Validation
- **Change**: Enables `xcm::validate` to check message sizes before sending
- **Implementation**: Added validation in staking-async runtime configurations
- **Rationale**: The first XCM message is the heaviest; validating it ensures all subsequent messages will pass
- **Component**: New `XCMSender` abstraction for relay-asset hub communication

### 2. Election Planning Improvements
- **Change**: Introduces default `EraElectionPlannerOf` implementation
- **Purpose**: Ensures elections happen on time with educated timing estimates
- **Method**: Uses `ElectionProvider::duration` instead of arbitrary values

### 3. Solution Type Fixes
- Fixed duplicate voters in solution types (also backported in PR #8585)
- Made `PagedRawSolution` unbounded for PoV-free decoding
- Reverted `ErasClaimedRewards` back to `ClaimedRewards`

### 4. Developer Experience
- Reduced unnecessary INFO-level logging
- Improved CLI-friendly type formatting
- Renamed `SessionDuration` to `RelaySessionDuration` for clarity

## Affected Crates

| Crate | Bump Type | Impact |
|-------|-----------|--------|
| `pallet-staking-async-ah-client` | patch | Bug fixes |
| `pallet-staking-async-rc-client` | minor | New features |
| `pallet-staking-async-parachain-runtime` | minor | New features |
| `pallet-staking-async-rc-runtime` | major | Breaking changes |
| `pallet-staking-async` | major | Breaking changes |
| `pallet-election-provider-multi-block` | major | Breaking changes |

## Impact Assessment for Moonbeam

### NO ACTION REQUIRED

**Reasoning:**
1. **No Dependencies**: Moonbeam does not use any of the affected staking-async pallets
2. **Different Architecture**: Moonbeam uses its own custom `pallet-parachain-staking` for collator staking, not relay chain staking mechanisms
3. **Scope**: These changes target relay chain and asset hub staking infrastructure, which is not relevant to parachain operations

### Moonbeam's Staking Architecture

Moonbeam implements staking through:
- **Custom Pallet**: `pallet-parachain-staking` (located in `/pallets/parachain-staking`)
- **Purpose**: Collator selection and delegated proof-of-stake for parachain consensus
- **Independence**: Completely separate from relay chain staking infrastructure

The `pallet-staking-async` ecosystem is designed for:
- Relay chain validator staking
- Asset hub staking coordination
- Cross-chain staking via XCM between relay chains and asset hubs

These use cases do not apply to Moonbeam's parachain collator staking model.

## Technical Details

### XCM Validation Logic
The PR abstracts XCM sending into a reusable `XCMSender` type that handles:
- Message size validation before transmission
- Communication between relay chains and asset hubs
- Version compatibility (handled automatically through wrapping)

### Election Planning
The new `EraElectionPlannerOf` provides:
- Automated election scheduling
- Duration-based planning rather than manual configuration
- Better guarantees for timely elections

## Migration Requirements

**For Moonbeam**: None

**For affected users** (relay chains/asset hubs):
- Major version bumps indicate breaking changes in several crates
- Runtime configurations using these pallets may need updates
- The `SessionDuration` rename to `RelaySessionDuration` requires configuration updates

## Related PRs

- PR #8409: Partial backport of this work
- PR #8585: Backport of duplicate voters fix

## Conclusion

This PR improves the reliability and developer experience of the staking-async system but has zero impact on Moonbeam's operations. Moonbeam's custom parachain staking implementation remains unchanged and unaffected by these relay chain staking improvements.

**Recommendation**: Monitor for informational purposes only. No code changes, testing, or migration work required for Moonbeam.
