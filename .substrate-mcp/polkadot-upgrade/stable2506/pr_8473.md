# PR #8473: Snowbridge: Remove asset location check

## Summary

**PR Title:** Snowbridge: Remove asset location check for compatibility

**PR Link:** https://github.com/paritytech/polkadot-sdk/pull/8473

**Audience:** Runtime Dev

**Impact on Moonbeam:** NO IMPACT

## Description

This PR streamlines token validation in the Snowbridge bridge by removing redundant compatibility checks. The changes make the `TokenIdOf` conversion XCM version-agnostic, producing consistent token IDs across different XCM versions (V4 and V5).

### Key Changes

1. **Removed redundant asset location verification** - The asset location comparison logic was removed from the outbound queue converter since the `ConvertAssetId::convert(&token_id)` check alone is sufficient to verify token registration
2. **Removed `NativeToForeignId` storage mapping** - This storage item is no longer needed
3. **Updated storage to use `xcm::v5::Location`** - Storage now consistently uses XCM v5 location types
4. **Added compatibility tests** - Tests verify PNA (Polkadot Native Asset) compatibility between XCM v4 and v5

### Affected Crates

- `snowbridge-pallet-system`
- `snowbridge-pallet-system-v2`
- `snowbridge-pallet-inbound-queue`
- `snowbridge-pallet-inbound-queue-v2`
- `snowbridge-outbound-queue-primitives`
- `snowbridge-inbound-queue-primitives`
- `snowbridge-test-utils`
- `bridge-hub-westend-runtime`
- `bridge-hub-westend-integration-tests`

All crates receive patch bumps with `validate: false` for pragmatic handling of semver constraints in backports.

## Impact Analysis on Moonbeam

### Direct Impact: NONE

**Snowbridge Usage in Moonbeam:**
- Moonbeam does NOT directly depend on any Snowbridge pallets or primitives
- No usage of `snowbridge-pallet-system`, `snowbridge-pallet-inbound-queue`, or related crates
- No usage of `NativeToForeignId` storage
- No usage of `TokenIdOf` conversion
- No usage of `ConvertAssetId` trait in the context of Snowbridge

### Transitive Dependency

Moonbeam has `snowbridge-core` as a transitive dependency through `bridge-runtime-common`:
```
bridge-runtime-common (used by Moonbeam) -> snowbridge-core
```

**`bridge-runtime-common` Usage in Moonbeam:**
- Used in `moonbeam-runtime` and `moonriver-runtime`
- Provides bridge infrastructure for Moonbeam-Moonriver parachain bridge
- Functions used:
  - `generate_bridge_reject_obsolete_headers_and_messages!` macro
  - `messages_api::outbound_message_details`
  - `messages_api::inbound_message_details`
  - `parachains_benchmarking::prepare_parachain_heads_proof`
  - `messages_benchmarking` utilities

**Why No Impact:**
- PR #8473 changes are isolated to Snowbridge-specific pallets and primitives
- The `snowbridge-core` crate itself was not modified in this PR
- `bridge-runtime-common` provides general bridge infrastructure that is independent of Snowbridge's asset conversion logic
- Moonbeam uses `bridge-runtime-common` for its own parachain bridge, not for Ethereum bridging

## Migration Requirements

**For Moonbeam:** None

While the PR includes runtime storage migrations for chains using Snowbridge, Moonbeam does not use any of the affected Snowbridge pallets, so no migrations are needed.

## Recommendations

1. **No action required** - This PR does not affect Moonbeam's functionality
2. **Monitor dependency updates** - The transitive dependency on `snowbridge-core` through `bridge-runtime-common` will be updated automatically when upgrading to stable2506
3. **Continue monitoring bridge-related PRs** - Focus on changes to `bridge-runtime-common` rather than Snowbridge-specific changes

## Conclusion

PR #8473 is a Snowbridge-specific optimization that removes redundant asset location checks. Since Moonbeam does not use Snowbridge pallets or primitives for its bridge infrastructure, this PR has no impact on the Moonbeam codebase. The changes are isolated to Ethereum-Polkadot bridging functionality that Moonbeam does not utilize.
