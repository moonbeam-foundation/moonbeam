# PR #8504 Impact Analysis

## PR Summary
**Title:** Fix generated address returned by Substrate RPC runtime call
**Link:** https://github.com/paritytech/polkadot-sdk/pull/8504
**Affected Crates:** pallet-revive (major), asset-hub-westend-runtime (patch)

## Description
This PR fixes a critical bug in `pallet-revive` where contract deployment addresses returned by dry-run RPC calls did not match the actual addresses used when transactions were submitted. The issue stemmed from incorrect nonce handling during address derivation - the code didn't account for whether execution was happening in a real transaction context (where nonces are pre-incremented) versus a dry-run simulation (where nonces remain unchanged).

### Technical Changes
- Introduced `NonceAlreadyIncremented` enum to track nonce state during contract instantiation
- Modified `create1` address derivation logic to conditionally adjust nonce based on execution context
- Updated runtime API calls to properly specify execution context (transaction vs dry-run)
- Added test coverage to verify nonce handling in different execution contexts

### Before the Fix
- Dry-run contract deployment returned address derived with nonce N
- Actual transaction deployment created contract at address with nonce N-1
- Result: Inconsistent addresses between simulation and execution

### After the Fix
- Both dry-run and actual deployments produce the same contract address
- Developers can reliably predict contract addresses before submission

## Impact on Moonbeam

### Assessment: NO IMPACT

**Rationale:**

1. **Different Contract System**: Moonbeam uses `pallet-evm` from the Frontier project for Ethereum-compatible smart contracts, not `pallet-revive` which is designed for WASM/PolkaVM contracts.

2. **No Dependency**: Moonbeam does not have `pallet-revive` as a dependency in any of its runtime configurations:
   - Verified absence in Cargo.toml files
   - Verified absence in Cargo.lock
   - Verified absence in construct_runtime! macro

3. **Different Architecture**:
   - Moonbeam implements Ethereum's EVM for contract execution
   - `pallet-revive` implements Substrate's PolkaVM for WASM contracts
   - These are fundamentally different contract execution environments

4. **Address Derivation**: Moonbeam follows Ethereum's CREATE/CREATE2 opcode specifications for contract address derivation, which is handled entirely within pallet-evm and is unaffected by changes to pallet-revive.

## Action Required

**None** - This PR does not affect Moonbeam's codebase or functionality.

## Additional Notes

While this PR demonstrates the importance of correct nonce handling in contract deployment simulations, Moonbeam's EVM implementation already follows Ethereum's well-established patterns for address derivation. The eth_call and eth_estimateGas RPC methods in Moonbeam use pallet-evm's simulation mechanisms, which are separate from pallet-revive's dry-run functionality.

## References

- PRDoc: `/Users/manuelmauro/.substrate-mcp/moonbeam/releases/stable2506/pr-docs/pr_8504.prdoc`
- Codebase verification: No instances of pallet-revive found in Moonbeam repository
- Moonbeam uses: pallet-evm, pallet-ethereum, and related Frontier components
