# PR #8519: Bridge Permissionless Lanes - Emulated Tests Para to Para

**Impact**: INHERITED
**Confidence**: High
**Affected Components**: None (test infrastructure only)

## Changes Detected

This PR adds new emulated integration tests for permissionless bridge lanes between parachains (PenpalA on AssetHub Westend to PenpalB on AssetHub Rococo). It is a continuation of PR #8292 and focuses on testing the opening and closing of bridges between parachains using permissionless lanes.

**Key Changes:**
- Added emulated tests for `open_bridge` XCM message functionality
- Tests bridge opening and closing between two parachains in the Rococo-Westend system
- Fixed XCM calls for PenpalB to AssetHub Rococo
- Pure test infrastructure changes with no runtime or pallet logic modifications

**PR Details from GitHub:**
- Title: "Bridge Permissionless Lanes - Emulated Tests Para to Para"
- Merged by: bkontur on May 21, 2025
- Labels: No crate republishing required, bridges-related
- Focus: Testing permissionless bridge lane functionality in emulated environments

## Project Impact

**No impact on Moonbeam.**

This PR exclusively affects Polkadot SDK's emulated integration test framework and does not modify any runtime pallets, client code, or production logic that Moonbeam depends on. While Moonbeam does implement bridge functionality between Moonbeam and Moonriver, it does not use the emulated integration test infrastructure from Polkadot SDK.

### Analysis Details:

1. **Emulated Test Framework**: Moonbeam does not depend on or use Polkadot SDK's emulated integration tests infrastructure.
   - Search for emulated integration test dependencies: None found
   - Moonbeam uses its own test infrastructure with custom `ExtBuilder` patterns

2. **Bridge Implementation**: Moonbeam has its own bridge implementation:
   - `/Users/manuelmauro/Workspace/moonbeam/runtime/common/src/bridge.rs` - Bridge XCM router and blob dispatcher
   - `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbeam/src/bridge_config.rs` - Moonbeam to Moonriver bridge config
   - `/Users/manuelmauro/Workspace/moonbeam/runtime/moonriver/src/bridge_config.rs` - Moonriver to Moonbeam bridge config

   These bridge configurations use:
   - `pallet_xcm_bridge` with `OpenBridgeOrigin = EnsureNever<Location>` (lines 136-137 in both configs)
   - This means Moonbeam explicitly **disables** permissionless bridge opening
   - Bridges are pre-configured and managed by root, not permissionless

3. **Permissionless Lanes**: The PR tests permissionless bridge lanes between parachains, but Moonbeam's configuration explicitly prevents this:
   ```rust
   // From moonbeam/src/bridge_config.rs:136-137
   type OpenBridgeOrigin = EnsureNever<Location>;
   // We don't want to allow creating bridges.
   ```

   And:
   ```rust
   // From moonbeam/src/bridge_config.rs:148
   type AllowWithoutBridgeDeposit = Everything;
   // Don't require a deposit, since we don't allow opening new bridges.
   ```

4. **Test Infrastructure**:
   - Moonbeam has its own zombienet bridge tests: `/Users/manuelmauro/Workspace/moonbeam/zombienet/integration-tests/bridges/`
   - Bridge test exists: `0001-moonbeam-moonriver-asset-transfer`
   - Uses Moonbeam's custom testing approach, not Polkadot SDK's emulated tests

5. **Dependencies Check**:
   - No usage of `penpal` (test parachain used in emulated tests)
   - No dependencies on emulated integration test crates
   - Uses `bridge-hub-common` for runtime logic (not affected by this PR)
   - Uses `bp-bridge-hub-cumulus` for bridge primitives (not affected by this PR)

## Evidence & References

### Bridge Configuration:

**Moonbeam bridge_config.rs** (lines 136-148):
```rust
type OpenBridgeOrigin = EnsureNever<Location>;
// We don't want to allow creating bridges.
// Converter aligned with `OpenBridgeOrigin`.
type BridgeOriginAccountIdConverter = (
    ParentIsPreset<AccountId>,
    SiblingParachainConvertsVia<Sibling, AccountId>,
);
type BridgeDeposit = BridgeDeposit;
type Currency = Balances;
type RuntimeHoldReason = RuntimeHoldReason;
// Don't require a deposit, since we don't allow opening new bridges.
type AllowWithoutBridgeDeposit = Everything;
```

**Moonriver bridge_config.rs** (lines 136-148):
Identical configuration - also uses `EnsureNever<Location>` for `OpenBridgeOrigin`.

### Codebase Search Results:

```bash
# No usage of emulated test infrastructure
$ rg "emulated.*integration" /Users/manuelmauro/Workspace/moonbeam --glob "**/*.rs"
# No results in Rust code (only found in previous analysis markdown)

# No usage of Penpal test parachain
$ rg "penpal" /Users/manuelmauro/Workspace/moonbeam -i
# No results

# No dependencies on emulated test crates
$ rg "emulated-integration-tests" /Users/manuelmauro/Workspace/moonbeam --glob "**/Cargo.toml"
# No results
```

### Moonbeam's Own Bridge Tests:

Moonbeam maintains its own bridge testing infrastructure:
- Zombienet tests: `/Users/manuelmauro/Workspace/moonbeam/zombienet/integration-tests/bridges/`
- Test case: `0001-moonbeam-moonriver-asset-transfer`
- Uses custom scripts and ZNDSL (zombienet DSL) files
- Independent from Polkadot SDK's emulated test framework

### Bridge Pallet Usage:

Moonbeam uses these bridge pallets (from both runtime configs):
- `pallet_bridge_grandpa` - Track relay chain finality
- `pallet_bridge_parachains` - Track bridged parachain headers
- `pallet_bridge_messages` - Message passing between chains
- `pallet_xcm_bridge` - XCM integration with bridges

All are configured but `OpenBridgeOrigin` is explicitly set to `EnsureNever`, meaning bridges must be pre-configured by governance, not opened permissionlessly.

## Conclusion

PR #8519 is a **pure test infrastructure addition** to Polkadot SDK's emulated integration test suite. It tests permissionless bridge lanes functionality between parachains in an emulated environment (PenpalA â†” PenpalB).

**Key Points:**
1. Moonbeam does not use emulated integration tests from Polkadot SDK
2. Moonbeam's bridge configuration explicitly **disables** permissionless bridge opening
3. Moonbeam uses pre-configured bridges managed by root origin
4. This PR adds no new runtime logic or pallet changes
5. Changes are automatically inherited but have no functional impact

**Action Required**: None - Moonbeam's bridge functionality is unaffected by this test-only change.
