# PR #8528 Impact Analysis: FeeTracker: remove `get_min_fee_factor()`

## Overview
**PR**: https://github.com/paritytech/polkadot-sdk/pull/8528
**Status**: Merged (May 16, 2025)
**Type**: Breaking change - Interface modification
**Audience**: Runtime Dev

## Summary
This PR removes the `get_min_fee_factor()` method from the `FeeTracker` trait and replaces it with a compile-time constant `MIN_FEE_FACTOR = 1`. The change enforces that the minimal fee factor should always be 1, eliminating the need for runtime configuration.

## Changes Made

### Core Changes
- **FeeTracker trait** (`polkadot-runtime-parachains`):
  - Removed method: `fn get_min_fee_factor() -> FixedU128`
  - Added constant: `const MIN_FEE_FACTOR: FixedU128 = FixedU128::from_u32(1)`
  - Updated internal fee calculation logic to use the constant

### Affected Crates (with major version bumps)
1. **cumulus-pallet-parachain-system**: Removed `get_min_fee_factor()` implementation
2. **cumulus-pallet-xcmp-queue**: Removed `get_min_fee_factor()` implementation
3. **pallet-xcm-bridge-hub-router**: Updated benchmarks to use constant instead of method
4. **polkadot-runtime-parachains**: Core trait definition changes

## Impact on Moonbeam

### Assessment: MINIMAL IMPACT âœ“

#### Dependencies Used
Moonbeam uses the following affected pallets:
- `cumulus-pallet-parachain-system` - Used in all three runtimes (moonbase, moonbeam, moonriver)
- `cumulus-pallet-xcmp-queue` - Used in all three runtimes for XCM message handling

#### No Direct Usage
After thorough search of the Moonbeam codebase:
- **No calls to `get_min_fee_factor()`** - Function is not invoked anywhere
- **No FeeTracker trait implementations** - Moonbeam does not implement this trait
- **No custom FeeTracker logic** - Uses standard pallet configurations only

#### Runtime Configurations
All three runtimes use standard configurations for the affected pallets:

**cumulus_pallet_parachain_system::Config**:
```rust
// /Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/src/lib.rs:750
impl cumulus_pallet_parachain_system::Config for Runtime {
    type RuntimeEvent = RuntimeEvent;
    type OnSystemEvent = ();
    type SelfParaId = ParachainInfo;
    type ReservedDmpWeight = ReservedDmpWeight;
    type OutboundXcmpMessageSource = XcmpQueue;
    type XcmpMessageHandler = XcmpQueue;
    // ... standard configuration
}
```

**cumulus_pallet_xcmp_queue::Config**:
```rust
// /Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/src/xcm_config.rs:383
impl cumulus_pallet_xcmp_queue::Config for Runtime {
    type RuntimeEvent = RuntimeEvent;
    type ChannelInfo = ParachainSystem;
    type VersionWrapper = PolkadotXcm;
    type PriceForSiblingDelivery = NoPriceForMessageDelivery<ParaId>;
    // ... standard configuration
}
```

## Required Actions

### 1. Dependency Update
- Update to stable2506 will automatically include the new versions of affected pallets
- No code changes required in Moonbeam codebase

### 2. Testing
**Recommended tests**:
- XCM message delivery functionality (already covered by existing integration tests)
- Verify fee calculation behavior remains unchanged (min fee factor was already 1)
- Run existing parachain system tests

**Test locations**:
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/tests/integration_test.rs`
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbeam/tests/integration_test.rs`
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonriver/tests/integration_test.rs`

### 3. Weight Updates
The affected pallets have existing weight files that may need regeneration:
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/src/weights/cumulus_pallet_parachain_system.rs`
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/src/weights/cumulus_pallet_xcmp_queue.rs`
- (Similar files for moonbeam and moonriver runtimes)

## Risk Assessment

**Risk Level**: LOW

### Why Low Risk?
1. **No API usage**: Moonbeam doesn't call the removed function
2. **No custom implementations**: Uses only standard pallet configurations
3. **Behavioral consistency**: The min fee factor was already 1, this just enforces it
4. **Internal change**: The modification is internal to the pallet implementation

### Potential Considerations
- **Fee behavior**: The minimum fee factor being hardcoded to 1 should not change runtime behavior since this was the expected value
- **Storage**: No storage migrations are needed as the storage values remain compatible
- **Testing**: Existing integration tests should validate that XCM functionality continues to work correctly

## Migration Steps

### Phase 1: Dependency Update
1. Update Polkadot SDK dependencies to stable2506
2. Ensure Cargo.lock reflects the new versions

### Phase 2: Verification
1. Compile all three runtimes
2. Run unit tests: `cargo test -p moonbase-runtime`
3. Run integration tests for XCM functionality
4. Verify no compilation errors related to FeeTracker

### Phase 3: Weight Regeneration (if needed)
If benchmarks were affected:
```bash
./scripts/run-benches-for-runtime.sh moonbase release
```

## Conclusion

This PR has **minimal impact** on Moonbeam. The changes are internal to the cumulus pallets that Moonbeam depends on, and since Moonbeam doesn't use the removed `get_min_fee_factor()` function or implement custom FeeTracker logic, no code changes are required. The update can be safely incorporated as part of the stable2506 upgrade with standard testing procedures.

## Related PRs
- Follows up: https://github.com/paritytech/polkadot-sdk/pull/8477
- Related issue: https://github.com/paritytech/polkadot-sdk/issues/8462
