# PR #8528: FeeTracker: remove `get_min_fee_factor()`

**PR**: [#8528](https://github.com/paritytech/polkadot-sdk/pull/8528)
**Status**: Merged (May 16, 2025)
**Audience**: Runtime Dev

## Summary

This PR removes the `get_min_fee_factor()` function from the FeeTracker trait across multiple pallets. The change is based on the principle that the minimal fee factor should always be 1, eliminating the need for a configurable getter function.

## Context

### Related Work
- **Related Issue**: [#8462](https://github.com/paritytech/polkadot-sdk/issues/8462) - "Refactor `pallet-xcm-bridge-router` to use FeeTracker/PriceForDelivery mechanism"
- **Predecessor PR**: [#8477](https://github.com/paritytech/polkadot-sdk/pull/8477) - "FeeTracker deduplications"

### Background
PR #8477 refactored the FeeTracker trait to make it more reusable and remove duplicate implementations across the codebase. This PR (#8528) is a follow-up that further simplifies the API by removing the `get_min_fee_factor()` method, establishing that the minimal fee factor is always a constant value of 1.

## Technical Changes

### Affected Crates

| Crate | Bump | Used by Moonbeam? |
|-------|------|-------------------|
| `pallet-xcm-bridge-hub-router` | major | No |
| `cumulus-pallet-parachain-system` | major | **Yes** |
| `cumulus-pallet-xcmp-queue` | major | **Yes** |
| `polkadot-runtime-parachains` | major | Inherited |
| `polkadot-runtime-common` | patch | Inherited |

### Key Changes
1. **Removed Method**: The `get_min_fee_factor()` function has been removed from the FeeTracker trait
2. **Simplified Assumption**: Code now assumes minimal fee factor is always 1
3. **API Breaking Change**: This is a breaking change for any code that directly calls `get_min_fee_factor()`

## Impact on Moonbeam

### Direct Usage Analysis
**Result**: ‚úÖ **NO CUSTOM IMPLEMENTATION FOUND**

Search results indicate:
- Moonbeam does **not** use `pallet-xcm-bridge-hub-router` (the primary pallet affected)
- Moonbeam does **not** have custom implementations of `get_min_fee_factor()`
- Moonbeam does **not** have custom FeeTracker implementations

### Indirect Dependencies
Moonbeam uses the following affected pallets:
- `cumulus-pallet-parachain-system` - Core parachain functionality
- `cumulus-pallet-xcmp-queue` - Cross-chain message queue

These pallets are used in all three Moonbeam runtimes:
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbeam/src/lib.rs`
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonriver/src/lib.rs`
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/src/lib.rs`

However, the changes are **internal** to these pallets and do not expose new configuration requirements to downstream users.

## Migration Requirements

### For Moonbeam: **INHERITED - NO ACTION REQUIRED**

**Rationale**:
1. Moonbeam does not directly implement or extend the FeeTracker trait
2. The changes are internal to the Cumulus pallets
3. No configuration changes are required in runtime files
4. The affected pallets (ParachainSystem, XcmpQueue) are used as-is from Cumulus

### General Migration Guide
For projects that DO use `get_min_fee_factor()`:
```rust
// Before (PR #8477 and earlier):
let min_factor = FeeTracker::get_min_fee_factor();

// After (PR #8528):
let min_factor = 1; // Always 1, hardcoded
```

## Testing Recommendations

### Regression Testing
Since Moonbeam uses the affected pallets, verify:
1. **XCM Message Processing**: Test XCMP queue message handling
2. **Fee Calculations**: Verify that cross-chain message fees are calculated correctly
3. **Parachain System**: Ensure block validation and inherent processing work as expected

### Test Commands
```bash
# Run parachain-specific tests
cargo test -p moonbase-runtime

# Run XCM integration tests
cd test
pnpm moonwall test dev_moonbase -d "test-xcm"
```

## Risk Assessment

**Risk Level**: üü¢ **LOW**

**Justification**:
- No custom implementations affected
- Changes are internal to upstream pallets
- Simplification reduces complexity (removes configurable behavior)
- Well-tested in Polkadot SDK before merge

## Dependencies Analysis

### Cargo.toml References
The affected pallets are referenced in:
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbeam/Cargo.toml`
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonriver/Cargo.toml`
- `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/Cargo.toml`

These will be automatically updated when upgrading to stable2506.

## Recommendations

### Priority: **INHERITED**

**Action Items**:
1. ‚úÖ No code changes required in Moonbeam codebase
2. ‚úÖ No configuration updates needed
3. ‚ö†Ô∏è Run integration tests for XCM and parachain functionality after upgrade
4. ‚ÑπÔ∏è Monitor for any unexpected behavior in fee calculations during testnet deployment

### Monitoring
After deployment, monitor:
- Cross-chain message fees
- XCMP queue performance
- Any warnings or errors related to FeeTracker

## Additional Notes

### Design Decision
The removal of `get_min_fee_factor()` reflects a simplification in the fee tracking design. By establishing that the minimal fee factor is always 1, the code becomes more predictable and easier to reason about. This is part of a broader effort to standardize fee calculation across bridges and cross-chain messaging.

### Related PRs to Watch
- PR #8477: FeeTracker deduplications (prerequisite)
- Issue #8462: Ongoing work to refactor bridge router with FeeTracker

## Conclusion

**Overall Assessment**: This PR represents a code simplification that removes unnecessary configurability. For Moonbeam, this is a transparent change inherited from upstream Cumulus pallets. No action is required beyond standard integration testing during the stable2506 upgrade process.

**Sentiment**: **INHERITED** - Changes are internal to dependencies, no Moonbeam-specific work needed.
