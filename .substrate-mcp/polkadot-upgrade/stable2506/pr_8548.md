# PR #8548: client/net: Use litep2p as the default network backend

**Impact**: INHERITED
**Confidence**: High
**Affected Components**: Node networking layer, client service

## Changes Detected

PR #8548 makes litep2p the default network backend for substrate-based chains, replacing libp2p as the default. This is a client-level change that affects networking infrastructure:

- **Default Network Backend**: litep2p is now enabled by default instead of libp2p
- **Performance Improvements**:
  - ~2x reduction in CPU usage
  - Faster DHT record discovery (2.5 minutes vs 10 minutes)
  - More stable peer connections and sync times
  - Strengthened websocket transport stability
  - Improved connectivity with Smoldot light client

## Project Impact

**Moonbeam will automatically inherit this change** as it uses Polkadot SDK's network infrastructure without custom modifications.

### Evidence from Codebase Analysis

1. **Standard Network Backend Usage**: Moonbeam uses the generic `NetworkBackend` trait and `sc_network::NetworkWorker` without specifying a particular backend:

   ```rust
   // /Users/manuelmauro/Workspace/moonbeam/node/service/src/lib.rs:66
   use sc_network::{config::FullNetworkConfiguration, NetworkBackend, NetworkBlock};

   // /Users/manuelmauro/Workspace/moonbeam/node/service/src/lib.rs:1110
   start_node_impl::<RuntimeApi, Customizations, sc_network::NetworkWorker<_, _>>(...)
   ```

2. **Multiple Service Types Use Default Backend**:
   - **Parachain mode** (`/Users/manuelmauro/Workspace/moonbeam/node/service/src/lib.rs:659-674`): Uses generic `Net: NetworkBackend<Block, Hash>` parameter
   - **Dev mode** (`/Users/manuelmauro/Workspace/moonbeam/node/service/src/lib.rs:1126-1138`): Uses generic `Net: NetworkBackend<Block, Hash>` parameter
   - **Lazy loading mode** (`/Users/manuelmauro/Workspace/moonbeam/node/service/src/lazy_loading/mod.rs:375-387`): Uses generic `Net: NetworkBackend<Block, Hash>` parameter

3. **Network Configuration**: Moonbeam uses standard `FullNetworkConfiguration` and `build_network` functions:

   ```rust
   // /Users/manuelmauro/Workspace/moonbeam/node/service/src/lib.rs:713-716
   let net_config = FullNetworkConfiguration::<_, _, Net>::new(
       &parachain_config.network,
       prometheus_registry.clone(),
   );
   ```

4. **No Custom Network Backend**: The codebase search found no custom network backend implementations or explicit litep2p/libp2p selection. Moonbeam delegates all network backend selection to Polkadot SDK.

5. **Dependency Management**: `sc-network` is imported from Polkadot SDK via workspace dependencies:

   ```toml
   # /Users/manuelmauro/Workspace/moonbeam/Cargo.toml
   sc-network = { git = "https://github.com/moonbeam-foundation/polkadot-sdk", branch = "moonbeam-polkadot-stable2506" }
   ```

### Benefits for Moonbeam

Since this is an automatic inheritance:
- **Reduced CPU Usage**: ~50% reduction in network-related CPU consumption
- **Faster Peer Discovery**: Improved validator/collator peer discovery times
- **Better Stability**: More stable peer connections for Moonbeam collators
- **No Code Changes Required**: The change is transparent to Moonbeam's implementation

## Evidence & References

**Code References:**
- Network backend usage: `/Users/manuelmauro/Workspace/moonbeam/node/service/src/lib.rs:66, 674, 1110, 1138`
- Network configuration: `/Users/manuelmauro/Workspace/moonbeam/node/service/src/lib.rs:713-716`
- CLI command network worker: `/Users/manuelmauro/Workspace/moonbeam/node/cli/src/command.rs:801, 816, 831, 871`
- Lazy loading network backend: `/Users/manuelmauro/Workspace/moonbeam/node/service/src/lazy_loading/mod.rs:387`

**Dependency Chain:**
```
Moonbeam → sc-network (workspace) → Polkadot SDK stable2506 → litep2p (default)
```

**Verification Commands:**
```bash
# Search for NetworkBackend usage
rg "NetworkBackend" /Users/manuelmauro/Workspace/moonbeam/node/service/src/

# Search for explicit network backend configuration
rg "litep2p|libp2p|network.*backend" /Users/manuelmauro/Workspace/moonbeam/node/

# Check sc-network dependency
grep "sc-network" /Users/manuelmauro/Workspace/moonbeam/Cargo.toml
```

## Conclusion

This PR requires **no action** from the Moonbeam team. The change from libp2p to litep2p as the default network backend will be automatically inherited when upgrading to Polkadot SDK stable2506. Moonbeam will benefit from improved networking performance without any code modifications.

The change is transparent because Moonbeam correctly uses the generic `NetworkBackend` trait abstraction provided by Polkadot SDK, allowing the underlying implementation to be swapped without breaking changes.
