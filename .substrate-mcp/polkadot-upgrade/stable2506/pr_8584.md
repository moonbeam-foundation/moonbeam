# PR #8584: Remove all XCM dependencies from `pallet-revive`

## Overview

**PR:** https://github.com/paritytech/polkadot-sdk/pull/8584
**Status:** Merged (June 2, 2025)
**Audience:** Runtime Developers
**Breaking Change:** Yes (Major version bump)

## Summary

This PR removes all Cross-Consensus Messaging (XCM) dependencies from `pallet-revive` to avoid cyclic dependencies in the Polkadot SDK architecture. The change relocates unstable XCM APIs (`xcm_execute` and `xcm_send`) from pallet-revive to the XCM precompile in `pallet-xcm`, where they belong architecturally.

## Changes

### Removed Components
- All XCM-related dependencies from `pallet-revive`
- `mock-network` testing crate (used for testing XCM APIs)
- `CallFilter` configuration from pallet-revive's Config trait
- Fixture contracts previously used for XCM testing

### Relocated/Refactored
- `xcm_execute` and `xcm_send` APIs moved to XCM precompile in `pallet-xcm`
- Test logic migrated to use test precompiles instead of fixture contracts
- Error code discriminants adjusted to maintain backward compatibility

### Affected Crates
All received major version bumps:
- `asset-hub-westend-runtime`
- `penpal-runtime`
- `pallet-revive`
- `pallet-revive-uapi`
- `polkadot-sdk`

## Technical Context

### What is pallet-revive?
`pallet-revive` is a new smart contract execution environment in the Polkadot SDK that aims to provide WASM-based smart contracts with improved performance and features compared to the legacy `pallet-contracts`. It's part of the ongoing effort to modernize the contracts execution layer.

### Why Remove XCM Dependencies?
The inclusion of XCM functionality directly in pallet-revive created cyclic dependency issues:
1. pallet-revive needed XCM pallets for cross-chain functionality
2. XCM pallets potentially needed contract execution capabilities
3. This circular relationship caused compilation and maintenance issues

By moving XCM-related contract APIs to the XCM precompile in `pallet-xcm`, the dependency graph becomes cleaner:
- pallet-revive focuses on contract execution
- pallet-xcm handles XCM concerns
- Contracts can still access XCM functionality through the precompile interface

## Impact on Moonbeam

**Impact Level: NONE - Not Applicable**

### Analysis
Moonbeam does not use `pallet-revive` in any of its runtimes:
- Moonbeam runtime: No pallet-revive dependency
- Moonriver runtime: No pallet-revive dependency
- Moonbase runtime: No pallet-revive dependency

Moonbeam uses `pallet-evm` (from the Frontier project) for Ethereum smart contract execution, not the Substrate-native contract pallets.

### Why This Doesn't Affect Moonbeam
1. **Different Architecture**: Moonbeam is Ethereum-compatible and uses pallet-evm for smart contract execution
2. **No Migration Path**: pallet-revive is for WASM-based Substrate contracts, not EVM contracts
3. **No Dependencies**: None of Moonbeam's code or dependencies reference pallet-revive

## Recommendations

### For This Upgrade Cycle
- **Action Required:** None
- **Testing Required:** None
- **Code Changes:** None

### Future Considerations
- Monitor the evolution of pallet-revive as it may offer insights into contract execution optimization
- If Moonbeam ever considers adding WASM contract support alongside EVM, pallet-revive could be evaluated
- Keep aware of XCM precompile patterns as they may inform Moonbeam's own precompile development

## Related PRs

This PR is part of the broader pallet-revive development and XCM refactoring efforts in the Polkadot SDK. Other related changes in stable2506 may include:
- XCM precompile enhancements in pallet-xcm
- Further pallet-revive API stabilization
- Contract execution performance improvements

## References

- **PR Discussion:** https://github.com/paritytech/polkadot-sdk/pull/8584
- **PRDoc:** `/Users/manuelmauro/.substrate-mcp/moonbeam/releases/stable2506/pr-docs/pr_8584.prdoc`
- **Polkadot SDK Contracts Documentation:** https://docs.substrate.io/build/smart-contracts/

## Conclusion

While this is a significant architectural change in the Polkadot SDK's contract execution layer, it has **no impact on Moonbeam**. The PR represents good software engineering practice by eliminating cyclic dependencies and properly separating concerns between contract execution and cross-chain messaging. Moonbeam teams can safely ignore this change in the stable2506 upgrade process.
