# PR #8662: [pallet-revive] update dry-run logic

**Impact**: INHERITED
**Confidence**: High
**Affected Components**: None (indirect dependency only)

## Changes Detected

PR #8662 updates the dry-run logic in `pallet-revive`, which is Polkadot SDK's WASM-based smart contract pallet:

1. **Reverted PR #8504**: Rolled back previous changes related to generated addresses
2. **Added `prepare_dry_run` function**: New function that runs before `bare_call` and `bare_instantiate` during dry-run execution
3. **Unified execution logic**: Ensures dry-run and actual execution follow the same code path, with setup code simulating transaction extension pre-dispatch behavior
4. **Motivation**: Improves consistency for use cases like prestate tracing where tracking nonce changes is important

### Technical Details
- **Crate**: `pallet-revive` (major bump)
- **Audience**: Runtime Developers
- **API Changes**: Modified dry-run execution methods for contract interactions
- **Breaking**: Potentially breaking for chains that use pallet-revive's dry-run functionality

## Project Impact

**No direct impact on Moonbeam.**

### Why No Impact?

1. **Moonbeam uses pallet-evm, not pallet-revive**:
   - Moonbeam is an Ethereum-compatible parachain using Frontier's `pallet-evm`
   - `pallet-revive` is a WASM-based smart contract pallet for Polkadot SDK
   - These are completely different smart contract execution environments

2. **pallet-revive is only a transitive dependency**:
   - `pallet-revive` appears in Moonbeam's `Cargo.lock` but not in any `Cargo.toml` files
   - It's pulled in as a dependency of `pallet-assets` from the Polkadot SDK
   - Moonbeam has removed `pallet-assets` from all three production runtimes

3. **Limited usage to XCM mock tests only**:
   - `pallet-assets` is only used in XCM mock test runtimes:
     - `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbase/tests/xcm_mock/statemint_like.rs:140`
     - `/Users/manuelmauro/Workspace/moonbeam/runtime/moonbeam/tests/xcm_mock/statemint_like.rs:142`
     - `/Users/manuelmauro/Workspace/moonbeam/runtime/moonriver/tests/xcm_mock/statemine_like.rs:142`
   - These mock runtimes simulate Asset Hub behavior for XCM testing
   - No dry-run functionality is used in these tests

4. **No pallet-revive API usage in Moonbeam code**:
   - Search for `use.*pallet_revive`, `pallet_revive::`, `prepare_dry_run`, `bare_call`, `bare_instantiate` found zero matches in Moonbeam source files (excluding target directory)
   - The pallet is never imported or called by any Moonbeam code

## Evidence & References

### Runtime Configuration Evidence
```rust
// runtime/moonbeam/src/lib.rs:1474
// [Removed] Assets: pallet_assets::{Pallet, Call, Storage, Event<T>} = 104,

// runtime/moonriver/src/lib.rs:1478
// [Removed] Assets: pallet_assets::{Pallet, Call, Storage, Event<T>} = 104,

// runtime/moonbase/src/lib.rs:1442
// [Removed] Assets: pallet_assets::{Pallet, Call, Storage, Event<T>} = 29,
```

All three production runtimes have explicitly removed pallet-assets from their `construct_runtime!` macros.

### Dependency Chain
```
Polkadot SDK (stable2506)
  └─ pallet-assets
      └─ pallet-revive (transitive dependency)
          └─ Updated in PR #8662
```

Moonbeam only uses pallet-assets in XCM mock tests:
```rust
// runtime/moonbase/tests/xcm_mock/statemint_like.rs:609
Assets: pallet_assets,
```

### Cargo.lock Evidence
```toml
[[package]]
name = "pallet-revive"
version = "0.7.0"
source = "git+https://github.com/moonbeam-foundation/polkadot-sdk?branch=moonbeam-polkadot-stable2506#4f1bceaa883a82b84df411b9081dcc7b09ab7a7e"
```

Present in lockfile but not referenced in any Moonbeam Cargo.toml files.

### Grep Results Summary
- `pallet-revive` in Cargo.toml files: **0 matches**
- `pallet_revive` imports in source files: **0 matches**
- `prepare_dry_run` in codebase: **0 matches**
- `pallet-assets` in production runtimes: **0 matches** (removed)
- `pallet-assets` in XCM mock tests: **3 matches** (test-only)

## Recommendations

### Immediate Actions
**None Required** - This PR has zero impact on Moonbeam's functionality.

### Upgrade Considerations
- The change will be automatically inherited through the Polkadot SDK stable2506 dependency update
- No code changes, configuration updates, or migrations needed
- XCM mock tests will continue to work as they don't use dry-run functionality

### Testing
**No additional testing required**. The change is:
1. Isolated to pallet-revive internal implementation
2. Not used by any Moonbeam code paths
3. Only present as a transitive dependency through test-only pallet-assets usage

## Conclusion

PR #8662 is a **major** change to `pallet-revive`'s dry-run logic, but it has **zero impact** on Moonbeam because:

1. Moonbeam uses a completely different smart contract execution environment (`pallet-evm` from Frontier, not `pallet-revive`)
2. `pallet-revive` is only present as a deep transitive dependency through `pallet-assets`
3. `pallet-assets` itself is only used in XCM mock test runtimes to simulate Asset Hub
4. No Moonbeam code calls any `pallet-revive` APIs or dry-run functionality

The impact is classified as **INHERITED** because the change is automatically included in the stable2506 upgrade but requires no action, configuration, or code changes from the Moonbeam team. The update will pass through transparently via dependency resolution.

### Related PRs
For context on Moonbeam's smart contract architecture and why pallet-revive is not used, see:
- PR #7762 analysis: ERC20 Asset Transactor (documents Moonbeam's use of pallet-evm vs pallet-revive)
