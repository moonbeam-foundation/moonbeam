# PR #8708: Add Collator Peer ID to ParachainInherentData

## Overview
- **Title**: feat: add collator peer ID to ParachainInherentData
- **PR Link**: https://github.com/paritytech/polkadot-sdk/pull/8708
- **Audience**: Runtime Dev
- **Status**: Merged

## Summary
This PR introduces an optional `collator_peer_id` field to `ParachainInherentData` as part of the collator protocol revamp initiative. The field currently remains unused and defaults to `None`, but is added proactively to avoid creating another inherent data version in the future.

## Changes
- **Affected Crate**: `cumulus-primitives-parachain-inherent` (major bump)
- **Supporting Crates**:
  - `cumulus-client-parachain-inherent` (patch)
  - `cumulus-pallet-parachain-system` (patch)
  - `parachains-runtimes-test-utils` (patch)
  - `xcm-emulator` (patch)

## Impact on Moonbeam

### Severity: MEDIUM

### Affected Areas

#### 1. Runtime Tests
**Location**: `/Users/manuelmauro/Workspace/moonbeam/runtime/{moonbase,moonbeam,moonriver}/tests/common/mod.rs`

**Issue**: Direct struct construction of `ParachainInherentData` will be affected by the new field.

**Current Code** (line 411-416 in moonbase/tests/common/mod.rs):
```rust
let parachain_inherent_data = ParachainInherentData {
    validation_data: vfp,
    relay_chain_state: relay_chain_state,
    downward_messages: Default::default(),
    horizontal_messages: Default::default(),
};
```

**Required Action**: Add the new optional `collator_peer_id` field to the struct construction:
```rust
let parachain_inherent_data = ParachainInherentData {
    validation_data: vfp,
    relay_chain_state: relay_chain_state,
    downward_messages: Default::default(),
    horizontal_messages: Default::default(),
    collator_peer_id: None, // New field
};
```

#### 2. TypeScript API
**Locations**:
- `/Users/manuelmauro/Workspace/moonbeam/typescript-api/src/moonbase/interfaces/`
- `/Users/manuelmauro/Workspace/moonbeam/typescript-api/src/moonbeam/interfaces/`
- `/Users/manuelmauro/Workspace/moonbeam/typescript-api/src/moonriver/interfaces/`

**Issue**: TypeScript type definitions will need to be regenerated to reflect the new field in `ParachainInherentData`.

**Required Action**: Regenerate TypeScript bindings after updating to stable2506.

#### 3. Test Utilities
**Location**: `/Users/manuelmauro/Workspace/moonbeam/test/suites/dev/common/test-block/test-block-mocked-relay.ts`

**Issue**: May use `ParachainInherentData` for mocking relay chain data.

**Required Action**: Review and update if direct struct construction is used.

## Migration Path

### Step 1: Update Runtime Test Files
Update all three runtime test files to include the new `collator_peer_id` field when constructing `ParachainInherentData`:

```bash
# Files to update:
- runtime/moonbase/tests/common/mod.rs
- runtime/moonbeam/tests/common/mod.rs
- runtime/moonriver/tests/common/mod.rs
```

### Step 2: Regenerate TypeScript Bindings
After updating Polkadot SDK dependencies:
```bash
cd typescript-api
pnpm run build
```

### Step 3: Test
Run the affected tests to ensure compatibility:
```bash
cargo test -p moonbase-runtime
cargo test -p moonbeam-runtime
cargo test -p moonriver-runtime
```

## Compatibility Notes

- **Backward Compatible**: The new field is optional and defaults to `None`
- **Breaking Change**: Only for code that directly constructs `ParachainInherentData` structs
- **Runtime Impact**: None - field is currently unused
- **Future Work**: The field will be populated in future updates as part of the collator protocol revamp

## Recommendations

1. **Immediate**: Update test files to include `collator_peer_id: None` in all `ParachainInherentData` struct constructions
2. **Before Merge**: Regenerate TypeScript bindings
3. **Post-Update**: Run full test suite to verify no regressions
4. **Monitor**: Track follow-up PRs that will actually utilize the `collator_peer_id` field

## Related Work

- Issue #7749: Collator protocol revamp
- PR #8299: Original inherent data version change
- Future work will populate the `collator_peer_id` field and implement UMP signal transmission
