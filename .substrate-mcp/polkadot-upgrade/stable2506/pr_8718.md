# PR #8718 Analysis: Record ED as Part of the Storage Deposit

## Overview

**PR:** [#8718 - Record ed as part of the storage deposit](https://github.com/paritytech/polkadot-sdk/pull/8718)
**Status:** Merged (June 2, 2025)
**Author:** @athei
**Affected Crate:** pallet-revive (patch bump)
**Audience:** Runtime Dev

## Summary

This PR fixes an issue where the existential deposit (ED) was not being properly accounted for in gas dry-run calculations and transaction receipts for smart contracts in `pallet-revive`.

## Problem Statement

The issue ([paritytech/contract-issues#38](https://github.com/paritytech/contract-issues/issues/38)) identified a critical gap in gas estimation:

- In EVM transactions, both transferred amounts and gas fees are included in total cost calculations
- In Substrate transactions using `pallet-revive`, the existential deposit required to create new accounts was NOT reflected in gas calculations
- This meant developers couldn't accurately determine total transaction costs from gas estimates
- Transaction receipts didn't show the actual balance changes occurring on-chain

The existential deposit is a minimum balance required to keep an account alive on Substrate chains. When a transaction creates a new account, the ED must be transferred, but this cost was previously hidden from gas calculations.

## Solution

The fix records the ED transfer as part of the storage deposit accounting, making this hidden cost visible in:
- Gas estimates during dry-runs
- Transaction receipts
- Storage deposit calculations

This was implemented by adding charge recording in the `Stack::transfer` function whenever a new account is brought into existence.

## Impact on Moonbeam

**Impact Level: NONE - Not Applicable**

### Why This Doesn't Affect Moonbeam

1. **Different Contract System:** Moonbeam uses `pallet-evm` (from the Frontier framework) for Ethereum compatibility, NOT `pallet-revive`

2. **Architecture Difference:**
   - `pallet-revive`: Substrate-native smart contract pallet for RISC-V/eBPF contracts
   - `pallet-evm`: Ethereum Virtual Machine implementation for Solidity contracts
   - Moonbeam's architecture is built entirely around EVM compatibility

3. **No Code Dependencies:** Verification shows zero references to `pallet-revive` or `pallet-contracts` in Moonbeam's runtime configurations

4. **EVM Gas Model:** Moonbeam uses Ethereum's gas model which already has its own mechanisms for handling account creation costs (e.g., CREATE opcode gas costs)

## Technical Details

**Crate Changes:**
- `pallet-revive`: patch bump

**Change Type:** Bug fix for contract gas estimation

**Breaking Changes:** None

**Migration Required:** No

## Verification

Checked Moonbeam's runtime dependencies:
```bash
# No pallet-revive in Moonbeam runtime
grep -r "pallet-revive\|pallet_revive" runtime/ → No matches
grep -r "pallet-contracts" runtime/ → No matches

# Confirmed Moonbeam uses pallet-evm
grep -r "pallet-evm" runtime/moonbeam/Cargo.toml → 30+ matches
```

## Recommendation

**Action Required: NONE**

This PR can be safely ignored for Moonbeam as it only affects `pallet-revive`, which is not used in the Moonbeam runtime. No testing, migration, or code changes are needed.

## Related Context

For reference, Moonbeam's smart contract architecture relies on:
- `pallet-evm`: Core EVM implementation
- `pallet-ethereum`: Ethereum transaction format support
- Multiple EVM precompiles: Custom Substrate functionality exposed to EVM contracts
- Frontier RPC: Ethereum-compatible RPC endpoints

All of these components handle gas and cost calculations through Ethereum's native gas model, which is independent of the Substrate storage deposit system that `pallet-revive` uses.

---

**Analysis Date:** 2025-10-22
**Moonbeam Branch:** master (d67d222bb3)
**SDK Release:** stable2506
