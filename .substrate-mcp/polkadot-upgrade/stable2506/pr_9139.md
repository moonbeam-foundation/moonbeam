# PR #9139: Expose More Constants for pallet-xcm

## Metadata

- **PR**: [paritytech/polkadot-sdk#9139](https://github.com/paritytech/polkadot-sdk/pull/9139)
- **Title**: Expose more constants for pallet-xcm
- **Status**: Merged (July 9, 2025, commit `83afbee`)
- **Backport**: Successfully backported to stable2506
- **Crate**: `pallet-xcm`
- **Bump**: patch
- **Audience**: Runtime Dev, Runtime User

## Summary

This PR exposes additional configuration constants from `pallet-xcm` in the runtime metadata, making them publicly queryable via RPC. The newly exposed constants follow the same pattern as the existing `AdvertisedXcmVersion` constant.

### Newly Exposed Constants

The PR exposes three additional constants that were previously internal to the pallet configuration:

1. **`UniversalLocation`** - The universal location of the chain within the global consensus system
2. **`MaxLockers`** - Maximum number of remote asset locks that can be placed on the local chain
3. **`MaxRemoteLockConsumers`** - Maximum number of consumers of a remote lock

## Current Moonbeam Configuration

All three Moonbeam runtimes (Moonbase, Moonriver, Moonbeam) currently configure these values in their XCM configuration:

### UniversalLocation

**Location**: `runtime/*/src/xcm_config.rs`

```rust
pub UniversalLocation: InteriorLocation =
    [GlobalConsensus(RelayNetwork::get()), Parachain(ParachainInfo::parachain_id().into())].into();
```

- **Moonbase**: `[GlobalConsensus(Westend), Parachain(1000)]`
- **Moonriver**: `[GlobalConsensus(Kusama), Parachain(2023)]`
- **Moonbeam**: `[GlobalConsensus(Polkadot), Parachain(2004)]`

This value is used for:
- XCM origin conversion
- Global consensus location resolution
- Bridge configuration
- XCM barrier configuration (line 203 in xcm_config.rs)

### MaxLockers

**Location**: `runtime/*/src/xcm_config.rs` (line 369 in moonbase)

```rust
type MaxLockers = ConstU32<8>;
```

**Value**: `8` for all runtimes

This constant limits the number of remote locks that can be placed on local assets. Currently set conservatively low as remote locking features are not heavily used.

### MaxRemoteLockConsumers

**Location**: `runtime/*/src/xcm_config.rs` (line 370 in moonbase)

```rust
type MaxRemoteLockConsumers = ConstU32<0>;
```

**Value**: `0` for all runtimes

Currently disabled (set to 0) as Moonbeam does not support consuming remote locks. This is consistent with the `TrustedLockers = ()` configuration on line 367.

## Impact Analysis

### Breaking Changes
**None** - This is a patch-level change that only exposes existing configuration values.

### API Changes
The runtime metadata will include three new constants under `pallet_xcm`:
- `polkadotXcm.universalLocation`
- `polkadotXcm.maxLockers`
- `polkadotXcm.maxRemoteLockConsumers`

### Benefits
1. **Transparency**: External tools and dApps can query these values programmatically
2. **Discoverability**: Developers can discover XCM capabilities without reading source code
3. **Validation**: Client-side applications can validate XCM operations against these limits
4. **Documentation**: Auto-generated documentation will include these constants

### TypeScript API Impact
After regenerating TypeScript bindings (`pnpm build`), these constants will be available in:
- `typescript-api/src/moonbase/interfaces/augment-api-consts.ts`
- `typescript-api/src/moonriver/interfaces/augment-api-consts.ts`
- `typescript-api/src/moonbeam/interfaces/augment-api-consts.ts`

Example usage:
```typescript
const universalLocation = api.consts.polkadotXcm.universalLocation;
const maxLockers = api.consts.polkadotXcm.maxLockers;
const maxRemoteLockConsumers = api.consts.polkadotXcm.maxRemoteLockConsumers;
```

## Migration Requirements

### Runtime Migration
**None required** - No storage changes or runtime logic modifications.

### Code Changes
**None required** - Moonbeam's existing configuration is compatible.

### Action Items
1. **Regenerate TypeScript bindings** after upgrading to stable2506
   ```bash
   pnpm build
   ```
2. **Optional**: Update documentation to reference the now-queryable constants
3. **Optional**: Consider exposing these constants in developer tooling or dashboards

## Recommendations

### Short Term
- No immediate action required
- Constants will automatically be exposed when upgrading to stable2506
- TypeScript bindings should be regenerated as part of the normal upgrade process

### Long Term
Consider whether current values remain appropriate:
1. **MaxLockers (8)**: Currently conservative. If Moonbeam plans to support more remote locking scenarios (e.g., for cross-chain DeFi), this may need to be increased.
2. **MaxRemoteLockConsumers (0)**: Currently disabled. If cross-chain locking features become important, revisit this configuration.

## Testing Recommendations

### RPC Tests
Verify the constants are queryable:
```typescript
// Test that constants are accessible
const universalLocation = await api.consts.polkadotXcm.universalLocation;
expect(universalLocation).toBeDefined();

// Test that values match runtime configuration
const maxLockers = await api.consts.polkadotXcm.maxLockers.toNumber();
expect(maxLockers).toBe(8);

const maxRemoteLockConsumers = await api.consts.polkadotXcm.maxRemoteLockConsumers.toNumber();
expect(maxRemoteLockConsumers).toBe(0);
```

### Integration Tests
No specific integration tests required, but consider adding constants verification to existing XCM test suites.

## Related Files

### Moonbeam Codebase
- `/runtime/moonbase/src/xcm_config.rs` (lines 93-94, 369-370)
- `/runtime/moonriver/src/xcm_config.rs` (corresponding lines)
- `/runtime/moonbeam/src/xcm_config.rs` (corresponding lines)

### TypeScript API (after regeneration)
- `/typescript-api/src/moonbase/interfaces/augment-api-consts.ts`
- `/typescript-api/src/moonriver/interfaces/augment-api-consts.ts`
- `/typescript-api/src/moonbeam/interfaces/augment-api-consts.ts`

## Risk Assessment

**Risk Level**: Very Low

- No runtime logic changes
- No storage migrations
- No behavioral changes
- Pure metadata enhancement
- Successfully backported and merged

## Conclusion

PR #9139 is a low-impact improvement that enhances XCM configuration transparency. The change is purely additive, exposing existing configuration values through the runtime metadata. Moonbeam's current configuration is compatible and requires no code changes. The main action item is to regenerate TypeScript bindings as part of the stable2506 upgrade process.

The exposed constants will be useful for:
- Developer tooling that needs to understand XCM capabilities
- Documentation generation
- Client-side validation of XCM operations
- Cross-chain application development

No immediate action is required, and the change can be adopted as part of the normal Polkadot SDK upgrade cycle.
